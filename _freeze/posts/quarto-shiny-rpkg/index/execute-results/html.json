{
  "hash": "dffa3eb35584bf4cc6609f3251a1717c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Quarto Shiny Apps in R Packages\" \nsubtitle: \"Modules, launching and deployment\"\nauthor: \"Martin Frigaard\"\ndate: \"2025-02-06\"\ncategories: [Quarto, Shiny, Packages]\nimage: \"img/quarto.png\"\ntoc: true\ntoc-depth: 5\ntoc-title: 'Contents'\ntoc-location: \"left\"\n# code-block-border-left: true\ncode-block-bg: \"#f8f8f8\"\ncode-block-border-left: \"#e8e8e8\"\ncode-fold: show\ncode-summary: 'show/hide'\ncallout-icon: false\ndraft: false\n\nfreeze: true\n\nexecute:\n  echo: true\n  message: false\n  warning: false\n  eval: false\n\n---\n\n\n\n\n\nThis post was prompted by a new chapter I've been working on for Shiny App-Packages. I've recently been building a Shiny application in a Quarto document[^quarto-interactivity], and noticed quite a few deviations from the standard app-package practices that deserve some attention.\n\nI'll cover various dashboard/html layout options, including modules in a Quarto document, and how to create a standalone function to launch your Quarto + Shiny app from an app-package.\n\n[^quarto-interactivity]: Shiny is covered in the [Interactivity section](https://quarto.org/docs/interactive/shiny/) of the Quarto documentation. \n\n## Set up \n\nThe Quarto document (`index.qmd`) is placed inside the `inst/` folder with a [`_quarto.yml` project file](https://quarto.org/docs/projects/quarto-projects.html#project-metadata): \n\n\n```{.default}\n└── inst\n     └── quarto\n          ├── _quarto.yml\n          └── index.qmd\n```\n\n### [`_quarto.yml`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\n`_quarto.yml` contains metadata on the format, style, and rendering options for the dashboard. \n\n```yml\ntitle: \"Quarto Movies App\"\n\nformat:\n  html:\n    embed-resources: true\n```\n\nThis file includes options for the entire Quarto project (i.e., all `.qmd` files in the folder). In our case it's simply the dashboard file: `index.qmd`.\n\n### [`index.qmd`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\nThe `index.qmd` file contains the `title` of our application and the `format` of the document in the YAML frontmatter. \n\n\n\n```{.default}\n---\ntitle: \"Movies App\"\nformat: html\nserver: shiny\n---\n```\n\n\n### [`www/`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\nTo include resources (like images or stylesheets), we'll also  add a `www/` folder:\n\n\n```{.default}\n└── inst\n     └── quarto\n          ├── _quarto.yml\n          ├── index.qmd\n          └── www/\n              └── quarto.png\n```\n\n### [`context: setup`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\nThe first code chunk in `index.qmd` should include a `context: setup` option and  load the necessary packages. If we want the dashboard to have access to the resources in `www/`, we need to include the [`addResourcePath()` function](https://shiny.posit.co/r/reference/shiny/0.12.0/addresourcepath.html) and pass the path with the installed version of our application. \n\n\n\n\n\n````{.default}\n```{r}\n#| context: setup\n# pkgs -------\nlibrary(sap)\nlibrary(thematic)\nlibrary(ragg)\n# resources --------\naddResourcePath(\n    prefix = 'quarto',\n    directoryPath = system.file('www', package = 'sap'))\n```\n````\n\n\n## Dashboards\n\nDashboard layouts are covered extensively in the Quarto documentation[^quarto-dashs] and elsewhere[^youtube], and I've included example layouts in the [code repo](https://github.com/mjfrigaard/quarto-dash-r). Key things to remember about Quarto dashboard layouts:\n\n### [`format: dashboard`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\n1. Dashboard layouts are configured using a combination of YAML fields and markdown headings. By default, the `orientation` field is set to `rows`, but multiple code chunks will add new columns:\n    \n    ```yml\n    format: \n      dashboard:\n        orientation: columns\n    ```\n    \n2. Level 1 headers create pages (with titles)\n\n    ```markdown\n    # Page 1\n    ```\n\n3. Level 2 and 3 headers create columns and rows (with height and width options)\n\n    ```markdown\n    ## Row {height=20%}\n\n    ### Column {width=35%}\n    ```\n\n4. Tabsets can be created `{.tabset}`:\n\n    ```markdown\n    ### Column {.tabset}\n    ```\n\n5. Inside the columns and rows, cards provide a flexible, grid-based structure for presenting different types of content. Cards are automatically created with text or a code chunk, and they can be labeled with a `title`. Cards can also be included using `{.card}` inside a div (`:::`):\n\n    ```markdown\n    #| title: Cost per week\n    ```\n\n    ```markdown\n    ::: {.card title=\"Cost per week\"}\n\n    :::\n    ```\n\n6. To customize the navigation bar in a Quarto dashboard, we can incorporate elements such as a `logo` and `nav-buttons`.\n\n    ```yml\n    format:\n      dashboard:\n        nav-buttons:\n          - text: About\n            href: https://quarto.org/\n          - icon: github\n            href: https://github.com/mjfrigaard/quarto-dash-r\n          - icon: wikipedia\n            target: _blank\n            href: https://en.wikipedia.org/wiki/RStudio#Reproducible_analyses_with_vignettes\n    ```\n    \n<!-- {{< include _navbar.qmd >}} -->\n\n::: {.column-margin}\n\nView various layouts in the [GitHub repository.](https://github.com/mjfrigaard/quarto-dash-r) for this post.\n\n:::\n\nBelow is an example dashboard layout with most of the features mentioned above. Note that the standard code chunk options are also available (i.e., code echo/folding):\n\n![Quarto layout options page 1 (click to enlarge)](img/layout_p1.png)\n\n![Quarto layout options page 2 (click to enlarge)](img/layout_p2.png)\n\nView the code used for the layout above (and others) in the GitHub repository.[^layouts]\n\n[^layouts]: The [`.qmd` files ending in `layout`](https://github.com/search?q=repo%3Amjfrigaard%2Fquarto-dash-r+path%3A%22layout.qmd%22&type=code) are examples of various dashboard layouts.  \n\n## Reactivity \n\nQuarto documents can be converted into Shiny's apps using the `server` option in the YAML header. In our `index.qmd` file, we'll set `server` to `shiny`:\n\n### [`server: shiny`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\n```yaml\n---\ntitle: \"Movies App\"\nformat: html\nserver: shiny\n---\n```\n\n\n\n\n````{.default}\n```{r}\n#| context: server\n```\n````\n\n\n\n\n## Modules \n\nIf you're developing a Quarto + Shiny application using modules (and you should[^shiny-mods-1] be[^shiny-mods-2]), the module functions can be placed in the code blocks like regular Shiny code.\n\nThe code below is used to implement the UI functions from the `mod_var_input.R` and `mod_scatter_display_ui.R` modules: \n\n\n\n````{.default}\n```{r}\n#| panel: input\nmod_var_input_ui(\"vars\")\n```\n\n```{r}\n#| panel: center\nmod_scatter_display_ui(\"plot\")\n```\n````\n\n\nThe `panel: input` creates a '*div with class `.panel-input`* and `panel: center` will '*leave some horizontal margin around its content*.'[^input-panel]\n\n[^input-panel]: Read more about [Input Panel layouts](https://quarto.org/docs/interactive/layout.html#input-panel)\n\nWe can also include regular shiny code in code chunks: \n\n\n\n````{.default}\n```{r}\n#| panel: fill\ntags$br()\ntags$em(\n  \"Built using \",\n  tags$a(\n    img(\n      src = \"www/quarto.png\",\n      height = 25,\n      width = 90,\n      style = \"margin:10px 10px\"\n    ),\n    href = \"https://quarto.org/docs/interactive/shiny/\"\n  ),\n  \"and data from the \",\n  tags$a(\"Building web applications with Shiny\", \n    href = \"https://rstudio-education.github.io/shiny-course/\"),\n  \"tutorial.\"\n)\n```\n````\n\n\n`panel: fill` will '*fill all available spac*e' in the dashboard.[^sidebar-layout]\n\n[^sidebar-layout]: Read more about [Sidebar Panel layouts](https://quarto.org/docs/interactive/layout.html#sidebar-panel).\n\n[^shiny-mods-1]: See the [Modularizing Shiny app code](https://shiny.posit.co/r/articles/improve/modules/) in the Shiny documentation.\n\n[^shiny-mods-2]: See the [Shiny modules chapter](https://mastering-shiny.org/scaling-modules.html) of Mastering Shiny.\n\n\n### [`context: server`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\nThe `server: shiny` in the YAML frontmatter ensures the document will render the UI inputs (i.e., the contents of `mod_var_input_ui()`). To differentiate the `server` (running on the back-end) code from user inputs and outputs, we need to add the module server functions in code blocks with the `context: server` option: \n\n\n\n````{.default}\n```{r}\n#| context: server\n\nselected_vars <- mod_var_input_server(\"vars\")\n\nmod_scatter_display_server(\"plot\", var_inputs = selected_vars)\n```\n````\n\n\n## Styling\n\n[SASS (Syntactically Awesome Style Sheets)](https://en.wikipedia.org/wiki/Sass_(style_sheet_language)) or [CSS (Cascading Style Sheets)](https://en.wikipedia.org/wiki/CSS) can be powerful tools for customizing a Quarto dashboard's appearance. Unlike standard CSS, SCSS introduces features like variables, nesting, and mixins, which help keep the code organized and modular. \n\n### [`styles.scss`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\nA dedicated `.scss` file keeps styles organized and separated from content, improving readability and maintainability. \n\n\n```{.default}\n└── inst\n     └── quarto\n          ├── _quarto.yml\n          ├── index.qmd\n          └── www\n              ├── quarto.png\n              └── styles.scss\n```\n\nWe will set some colors defaults in `www/styles.scss`:\n\n```scss\n/*-- scss:defaults --*/\n\n// colors\n$body-bg: #070d35;\n$body-color: #FFFFFF;\n\n$link-color: #2ee3a4;\n$hover-color: lighten($link-color, 40%);\n\n$code-block-bg-alpha: -.8;\n\n/*-- scss:rules --*/\n\n```\n\n### [`thematic`]{style=\"font-size: 1.10em; font-weight: bold;\"}\n\nFor a broader, simplified approach to styling, we can install/use the [`thematic`](https://rstudio.github.io/thematic/) package:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ninstall.packages(\"thematic\")\n```\n:::\n\n\nWe can add `thematic_set_theme()` to the `context: setup` code chunk in `index.qmd`:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nthematic::thematic_set_theme(\n  theme = thematic::thematic_theme(\n    bg = \"#070d35\", \n    fg = \"#FFFFFF\", \n    accent = \"#2ee3a4\"))\n```\n:::\n\n\nThis also requires the `shiny.useragg` [option](https://rstudio.github.io/thematic/articles/fonts.html?q=shinyuseragg#shiny-rmd):\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\noptions(shiny.useragg = TRUE)\n```\n:::\n\n\n\n## Launching\n\nTo launch our Quarto dashboard with a standalone app function, we can use `quarto_preview()` with `system.file()`:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlaunch_app <- function() {\n  quarto::quarto_preview(\n    system.file(\"quarto\", \"index.qmd\", package = \"sap\" ), \n    render = \"all\")\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlaunch_app()\n```\n:::\n\n\n![Quarto App (click to enlarge)](img/quarto_app.png){width='100%' fig-align='center'}\n\n\n## Recap\n\nIf you're interested in learning more, check out the [Quarto apps section](https://mjfrigaard.github.io/shiny-app-pkgs/resources.html#sec-resources-inst-quarto) of Shiny App-Packages and the [Quarto documentation](). Albert Rapp has a great video on [building interactive apps with Quarto & Shiny](https://youtu.be/06H8k1nzZQ0?si=vGKuE6VX1LdfDMP7) and Isabella Velásquez also does a fantastic job covering [python Quarto dashboards](https://youtu.be/uLGe9zuuNl0?si=8bC7qG3AvFDcmj2x).\n\n[^quarto-dashs]: [Quarto dashboards.](https://quarto.org/docs/dashboards/)\n\n[^youtube]: Mine Çetinkaya-Rundel has an excellent three part tutorial on Posit's YouTube channel ([part 1](https://youtu.be/HW7QbqI4fH0?si=WuBui8y9uRjOVQzD), [part 2](https://www.youtube.com/watch?v=KdsQgwaY950), [part 3](https://www.youtube.com/watch?v=NigWSB-jG4Y&t=112s)).\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}