<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Frigaard">
<meta name="dcterms.date" content="2023-07-04">

<title>@mjfrigaard - Shiny system tests with shinytest2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title"><span class="citation" data-cites="mjfrigaard">@mjfrigaard</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../series.html"> 
<span class="menu-text">Series</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../code.html"> 
<span class="menu-text">Code</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mjfrigaard"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mjfrigaard"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#set-up" id="toc-set-up" class="nav-link active" data-scroll-target="#set-up">Set up</a>
  <ul>
  <li><a href="#chromium" id="toc-chromium" class="nav-link" data-scroll-target="#chromium">Chromium</a></li>
  <li><a href="#chromote" id="toc-chromote" class="nav-link" data-scroll-target="#chromote"><span style="font-size: 1.20em"><code>chromote</code></span></a></li>
  </ul></li>
  <li><a href="#app-package-contents" id="toc-app-package-contents" class="nav-link" data-scroll-target="#app-package-contents">App-package contents</a>
  <ul>
  <li><a href="#modules-apps" id="toc-modules-apps" class="nav-link" data-scroll-target="#modules-apps">Modules &amp; apps</a>
  <ul>
  <li><a href="#dataset-module" id="toc-dataset-module" class="nav-link" data-scroll-target="#dataset-module"><span style="font-size: 1.15em"><code>dataset</code></span> module</a>
  <ul class="collapse">
  <li><a href="#datasetapp" id="toc-datasetapp" class="nav-link" data-scroll-target="#datasetapp"><span style="font-size: 1.10em"><code>datasetApp()</code></span></a></li>
  <li><a href="#reactive-values-vals" id="toc-reactive-values-vals" class="nav-link" data-scroll-target="#reactive-values-vals">Reactive values (<span style="font-size: 1.15em"><code>vals</code></span>)</a></li>
  </ul></li>
  <li><a href="#selectvar-module" id="toc-selectvar-module" class="nav-link" data-scroll-target="#selectvar-module"><span style="font-size: 1.15em"><code>selectVar</code></span> module</a>
  <ul class="collapse">
  <li><a href="#selectvarapp" id="toc-selectvarapp" class="nav-link" data-scroll-target="#selectvarapp"><span style="font-size: 1.10em"><code>selectVarApp()</code></span></a></li>
  <li><a href="#reactive-values-vals-1" id="toc-reactive-values-vals-1" class="nav-link" data-scroll-target="#reactive-values-vals-1">Reactive values (<span style="font-size: 1.15em"><code>vals</code></span>)</a></li>
  </ul></li>
  <li><a href="#selectdatavar-module" id="toc-selectdatavar-module" class="nav-link" data-scroll-target="#selectdatavar-module"><span style="font-size: 1.10em"><code>selectDataVar</code></span> module</a>
  <ul class="collapse">
  <li><a href="#selectdatavarapp" id="toc-selectdatavarapp" class="nav-link" data-scroll-target="#selectdatavarapp"><span style="font-size: 1.15em"><code>selectDataVarApp()</code></span></a></li>
  </ul></li>
  <li><a href="#histogram-module" id="toc-histogram-module" class="nav-link" data-scroll-target="#histogram-module"><span style="font-size: 1.10em"><code>histogram</code></span> module</a>
  <ul class="collapse">
  <li><a href="#histogramapp" id="toc-histogramapp" class="nav-link" data-scroll-target="#histogramapp"><span style="font-size: 1.15em"><code>histogramApp()</code></span></a></li>
  <li><a href="#reactive-values-vals-2" id="toc-reactive-values-vals-2" class="nav-link" data-scroll-target="#reactive-values-vals-2">Reactive values (<span style="font-size: 1.15em"><code>vals</code></span>)</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  <li><a href="#recording-tests" id="toc-recording-tests" class="nav-link" data-scroll-target="#recording-tests">Recording tests</a>
  <ul>
  <li><a href="#in-chromium" id="toc-in-chromium" class="nav-link" data-scroll-target="#in-chromium">In Chromium</a>
  <ul>
  <li><a href="#expectations" id="toc-expectations" class="nav-link" data-scroll-target="#expectations">Expectations</a></li>
  <li><a href="#events" id="toc-events" class="nav-link" data-scroll-target="#events">Events</a></li>
  <li><a href="#code" id="toc-code" class="nav-link" data-scroll-target="#code">Code</a></li>
  <li><a href="#expect-shiny-values" id="toc-expect-shiny-values" class="nav-link" data-scroll-target="#expect-shiny-values">Expect Shiny values</a></li>
  <li><a href="#save-test-and-exit" id="toc-save-test-and-exit" class="nav-link" data-scroll-target="#save-test-and-exit">Save test and exit</a></li>
  </ul></li>
  <li><a href="#in-console" id="toc-in-console" class="nav-link" data-scroll-target="#in-console">In Console</a></li>
  </ul></li>
  <li><a href="#test-contents" id="toc-test-contents" class="nav-link" data-scroll-target="#test-contents">Test contents</a>
  <ul>
  <li><a href="#appdriver" id="toc-appdriver" class="nav-link" data-scroll-target="#appdriver"><span style="font-size: 1.15em"><code>AppDriver</code></span></a></li>
  <li><a href="#set_inputs" id="toc-set_inputs" class="nav-link" data-scroll-target="#set_inputs"><span style="font-size: 1.15em"><code>set_inputs()</code></span></a></li>
  <li><a href="#expect_values" id="toc-expect_values" class="nav-link" data-scroll-target="#expect_values"><span style="font-size: 1.15em"><code>expect_values()</code></span></a></li>
  </ul></li>
  <li><a href="#test-results" id="toc-test-results" class="nav-link" data-scroll-target="#test-results">Test results</a>
  <ul>
  <li><a href="#snaps" id="toc-snaps" class="nav-link" data-scroll-target="#snaps"><span style="font-size: 1.15em"><code>_snaps</code></span></a>
  <ul>
  <li><a href="#png" id="toc-png" class="nav-link" data-scroll-target="#png"><span style="font-size: 1.20em"><code>.png</code></span></a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json"><span style="font-size: 1.20em"><code>.json</code></span></a></li>
  <li><a href="#namespaces" id="toc-namespaces" class="nav-link" data-scroll-target="#namespaces">Namespaces</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#writing-tests" id="toc-writing-tests" class="nav-link" data-scroll-target="#writing-tests">Writing tests</a>
  <ul>
  <li><a href="#setting-inputs" id="toc-setting-inputs" class="nav-link" data-scroll-target="#setting-inputs">Setting inputs</a></li>
  <li><a href="#checking-inputs" id="toc-checking-inputs" class="nav-link" data-scroll-target="#checking-inputs">Checking inputs</a></li>
  <li><a href="#running-tests" id="toc-running-tests" class="nav-link" data-scroll-target="#running-tests">Running tests</a></li>
  </ul></li>
  <li><a href="#exporting-test-values" id="toc-exporting-test-values" class="nav-link" data-scroll-target="#exporting-test-values">Exporting test values</a>
  <ul>
  <li><a href="#exporttestvalues" id="toc-exporttestvalues" class="nav-link" data-scroll-target="#exporttestvalues"><span style="font-size: 1.20em"><code>exportTestValues()</code></span></a></li>
  <li><a href="#using-system.file" id="toc-using-system.file" class="nav-link" data-scroll-target="#using-system.file">Using <span style="font-size: 1.20em"><code>system.file()</code></span></a></li>
  <li><a href="#get_values" id="toc-get_values" class="nav-link" data-scroll-target="#get_values"><span style="font-size: 1.20em"><code>get_values()</code></span></a></li>
  <li><a href="#exported-expectations" id="toc-exported-expectations" class="nav-link" data-scroll-target="#exported-expectations"><span style="font-size: 1.20em"><code>export</code></span>ed expectations</a></li>
  </ul></li>
  <li><a href="#testing-complex-outputs" id="toc-testing-complex-outputs" class="nav-link" data-scroll-target="#testing-complex-outputs">Testing complex outputs</a>
  <ul>
  <li><a href="#verify-initial-input" id="toc-verify-initial-input" class="nav-link" data-scroll-target="#verify-initial-input">Verify initial <span style="font-size: 1.20em"><code>input</code></span></a></li>
  <li><a href="#set-and-verify-export" id="toc-set-and-verify-export" class="nav-link" data-scroll-target="#set-and-verify-export">Set and verify <span style="font-size: 1.20em"><code>export</code></span></a></li>
  <li><a href="#verify-plot-with-vdiffr" id="toc-verify-plot-with-vdiffr" class="nav-link" data-scroll-target="#verify-plot-with-vdiffr">Verify plot with <span style="font-size: 1.20em"><code>vdiffr</code></span></a></li>
  <li><a href="#set_-get_-expect_" id="toc-set_-get_-expect_" class="nav-link" data-scroll-target="#set_-get_-expect_"><span style="font-size: 1.10em"><code>set_</code>, <code>get_</code>, <code>expect_</code></span></a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  <li><a href="#recap" id="toc-recap" class="nav-link" data-scroll-target="#recap">Recap</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Shiny system tests with <code>shinytest2</code></h1>
<p class="subtitle lead">Part 4 (series): recording tests and snapshots</p>
  <div class="quarto-categories">
    <div class="quarto-category">shiny</div>
    <div class="quarto-category">testing</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Martin Frigaard </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<details open="" class="code-fold">
<summary>packages</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vdiffr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This is the fourth post in a <a href="https://mjfrigaard.github.io/series.html#testing-shiny-applications">series on testing</a> shiny applications. My previous posts have covered <a href="https://mjfrigaard.github.io/posts/test-shiny-p1/">unit testing utility functions</a> and <a href="https://mjfrigaard.github.io/posts/test-shiny-p3/">testing module server functions with <code>testServer()</code></a>. In this post, I’ll be covering testing shiny applications using <code>testthat</code> and <code>shinytest2</code>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="image.svg" class="img-fluid" style="width:70.0%"></p>
</div></div><div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ALERT!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div style="font-size: 1.10em; font-weight: bold; color: #696969;">
<p>This post is currently under development. Thank you for your patience.</p>
</div>
</div>
</div>
</div>
<section id="set-up" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="set-up">Set up</h2>
<p><a href="https://rstudio.github.io/shinytest2/index.html"><code>shinytest2</code></a> requires a few steps to get up and running, so I’ve included my start up steps below (in hopes that someone might find them useful).</p>
<section id="chromium" class="level3">
<h3 class="anchored" data-anchor-id="chromium">Chromium</h3>
<p>First make sure you have <a href="https://www.chromium.org/chromium-projects/">Chromium headless browser</a> installed. Chromium is the browser used to test and debug shiny apps with <code>shinytest2</code>.</p>
<p>If you’re using macOS, you can install Chromium using <a href="https://formulae.brew.sh/cask/chromium">homebrew</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install <span class="at">--cask</span> chromium</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>show/hide output</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> Downloading https://download-chromium.appspot.com/dl/Mac<span class="pp">?</span>type=snapshots</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> Downloading from https://commondatastorage.googleapis.com/chromium-browser-s</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">######################################################################### 100.0%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> No checksum defined for cask <span class="st">'chromium'</span>, skipping verification.</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> Installing Cask chromium</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> Moving App <span class="st">'Chromium.app'</span> to <span class="st">'/Applications/Chromium.app'</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">==</span><span class="op">&gt;</span> Linking Binary <span class="st">'chromium.wrapper.sh'</span> to <span class="st">'/usr/local/bin/chromium'</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">🍺</span>  chromium was successfully installed!</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="chromote" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="chromote"><span style="font-size: 1.20em"><code>chromote</code></span></h3>
<p>The <a href="https://rstudio.github.io/chromote/index.html"><code>chromote</code> package</a> allows R to open Chromium. I had to make sure R knew where to find the Chromium application (<a href="https://rstudio.github.io/chromote/#specifying-which-browser-to-use">this section helps</a>) by passing the path to the app to <code>Sys.setenv()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"rstudio/chromote"</span>, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">force =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chromote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can use <code>find_chrome()</code> to find your chrome app:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>chromote<span class="sc">::</span><span class="fu">find_chrome</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>You can also locate the path to Chromium using by holding command <kbd>⌘</kbd> and clicking on the application icon</em></p>
<p>Then set the <code>CHROMOTE_CHROME</code> environment variable to the <code>Chromium</code> path (<strong>make sure it’s not the path to <code>Chrome.app</code></strong>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">CHROMOTE_CHROME =</span> <span class="st">"/Applications/Chromium.app/Contents/MacOS/Chromium"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Verify the Chromium app/<code>chromote</code> install with <code>ChromoteSession$new()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> ChromoteSession<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>b<span class="sc">$</span><span class="fu">view</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="page-columns page-full">
<div id="fig-chromium" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-chromium-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-chromium" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-chromium" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-chromium-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="chromium.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-chromium">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-chromium-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Chromium
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-chromium-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Chromium headless browser
</figcaption>
</figure>
</div>
</div>
<p>Great! Going through this step means <code>shinytest2</code>’s test recorder will (<em>should</em>) deploy when I’m recording tests.</p>
</section>
</section>
<section id="app-package-contents" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="app-package-contents">App-package contents</h2>
<p>I’ve created <a href="https://github.com/mjfrigaard/msst2ap"><code>msst2ap</code></a> (i.e., <strong>M</strong>astering <strong>S</strong>hiny <strong>s</strong>hiny<strong>t</strong>est<strong>2</strong> <strong>a</strong>pp-<strong>p</strong>ackage) with <a href="https://r-pkgs.org/"><code>devtools</code> and <code>usethis</code></a>. It somewhat resembles an application using the <a href="https://engineering-shiny.org/"><code>golem</code> framework</a>, but with fewer opinions. You can download <code>msst2ap</code> <a href="https://github.com/mjfrigaard/msst2ap/archive/refs/heads/main.zip">here</a> or install it using the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"mjfrigaard/msst2ap"</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">force =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(msst2ap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The applications in <code>msst2ap</code> can be run with the their standalone app functions.</p>
<section id="modules-apps" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="modules-apps">Modules &amp; apps</h3>
<p>The modules in <code>msst2ap</code> are from the <a href="https://mastering-shiny.org/scaling-modules.html">Modules chapter of Mastering Shiny</a>, with a few minor adjustments. These modules create namespaces for their inputs and outputs with the <code>shiny::NS()</code> function, which appends a second <code>id</code> string to each <code>inputId</code>/<code>outputId</code>.</p>
<p>Each standalone app also includes the output from <code>shiny::reactiveValuesToList()</code>:</p>
<ul>
<li><p>In the <code>ui</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for printing reactive values in application modules</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">verbatimTextOutput</span>(<span class="st">"vals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>In the <code>server</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for printing reactive values in application modules</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>vals <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactiveValuesToList</span>(input,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">all.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(x, <span class="at">width =</span> <span class="dv">30</span>, <span class="at">max.levels =</span> <span class="cn">NULL</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>}, <span class="at">width =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<section id="dataset-module" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="dataset-module"><span style="font-size: 1.15em"><code>dataset</code></span> module</h4>
<p>The <code>dataset</code> module displays the objects in the <code>datasets</code> package in a <code>selectInput()</code> according to a filter argument (i.e., <code>is.data.frame</code>, <code>is.matrix</code>, etc.).</p>
<p><code>datasetServer()</code> returns the selected object as a reactive value. Read more <a href="https://mastering-shiny.org/scaling-modules.html#getting-started-ui-input-server-output">here</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>datasetInput() &amp; datasetServer()</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>datasetInput <span class="ot">&lt;-</span> <span class="cf">function</span>(id, <span class="at">filter =</span> <span class="cn">NULL</span>) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">&lt;-</span> <span class="fu">ls</span>(<span class="st">"package:datasets"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filter)) {</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(names, get, <span class="st">"package:datasets"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    names <span class="ot">&lt;-</span> names[<span class="fu">vapply</span>(data, filter, <span class="fu">logical</span>(<span class="dv">1</span>))]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">selectInput</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">NS</span>(id, <span class="st">"dataset"</span>),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pick a dataset"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> names)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>datasetServer <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">reactive</span>(<span class="fu">get</span>(input<span class="sc">$</span>dataset, <span class="st">"package:datasets"</span>))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="datasetapp" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="datasetapp"><span style="font-size: 1.10em"><code>datasetApp()</code></span></h5>
<div class="cell">
<details class="code-fold">
<summary>datasetApp()</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>datasetApp <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">filter =</span> <span class="cn">NULL</span>) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  ui <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">fluidPage</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datasetInput</span>(<span class="st">"dataset"</span>, <span class="at">filter =</span> is.data.frame),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">tableOutput</span>(<span class="st">"data"</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for printing reactive values in application modules</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">verbatimTextOutput</span>(<span class="st">"vals"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"dataset"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>data <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderTable</span>(<span class="fu">head</span>(<span class="fu">data</span>()))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for printing reactive values in application modules</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>vals <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactiveValuesToList</span>(input,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                              <span class="at">all.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(x, <span class="at">width =</span> <span class="dv">30</span>, <span class="at">max.levels =</span> <span class="cn">NULL</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">width =</span> <span class="dv">30</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">shinyApp</span>(ui, server)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="page-columns page-full">
<div id="fig-datasetApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-datasetApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div id="fig-datasetApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-datasetApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="datasetApp.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-datasetApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-datasetApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>datasetApp()</code>
</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-datasetApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: <code>datasetApp()</code> in <code>msst2ap</code>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="reactive-values-vals" class="level5">
<h5 class="anchored" data-anchor-id="reactive-values-vals">Reactive values (<span style="font-size: 1.15em"><code>vals</code></span>)</h5>
<p>Below the table output in <code>datasetApp()</code>, the reactive values displays the <code>inputId</code> from <code>datasetInput()</code> and the namespace value from the shared <code>id</code> argument with <code>datasetServer()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="selectvar-module" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="selectvar-module"><span style="font-size: 1.15em"><code>selectVar</code></span> module</h4>
<p>The <code>selectVar</code> module <a href="https://mastering-shiny.org/scaling-modules.html#case-study-selecting-a-numeric-variable">selects a numeric variable</a> the <code>data()</code> object returned from <code>datasetServer()</code>.</p>
<p>It has a single utility function (<code>find_vars()</code>) which is used to filter the columns (variables):</p>
<div class="cell">
<details class="code-fold">
<summary>show/hide selectVarInput() &amp; selectVarServer()</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>selectVarInput <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">selectInput</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">NS</span>(id, <span class="st">"var"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Variable"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> <span class="cn">NULL</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>selectVarServer <span class="ot">&lt;-</span> <span class="cf">function</span>(id, data, <span class="at">filter =</span> is.numeric) {</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(shiny<span class="sc">::</span><span class="fu">is.reactive</span>(data))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="sc">!</span>shiny<span class="sc">::</span><span class="fu">is.reactive</span>(filter))</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">updateSelectInput</span>(</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        session, <span class="st">"var"</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">find_vars</span>(<span class="fu">data</span>(), filter))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">data</span>())</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">reactive</span>({</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (input<span class="sc">$</span>var <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">data</span>())) {</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data</span>()[input<span class="sc">$</span>var]</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>          <span class="cn">NULL</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>      }) <span class="sc">|&gt;</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(input<span class="sc">$</span>var)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I’ve made a few small changes to <code>selectVarServer()</code>:</p>
<ul>
<li><p>In the original version, <code>input$var</code> is returned as a vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reactive</span>(<span class="fu">data</span>()[[input<span class="sc">$</span>var]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>I’ve added some validation and return <code>input$var</code> as a single column from <code>data()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">reactive</span>({</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>var <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">data</span>())) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data</span>()[input<span class="sc">$</span>var]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        <span class="cn">NULL</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  }) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>The <code>find_vars()</code> function is also below:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide find_vars()</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>find_vars <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">filter =</span> is.vector) {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.data.frame</span>(data))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.function</span>(filter))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(data)[<span class="fu">vapply</span>(data, filter, <span class="fu">logical</span>(<span class="dv">1</span>))]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></li>
</ul>
<section id="selectvarapp" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="selectvarapp"><span style="font-size: 1.10em"><code>selectVarApp()</code></span></h5>
<p>The <code>selectVarApp()</code> extends the <code>dataset</code> module by collecting the returned reactive value, passing it to <code>find_vars()</code>, and returning a single column.</p>
<div class="cell">
<details class="code-fold">
<summary>show/hide selectVarApp()</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>selectVarApp <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">filter =</span> is.numeric) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  ui <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">fluidPage</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">datasetInput</span>(<span class="st">"data"</span>, is.data.frame),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">selectVarInput</span>(<span class="st">"var"</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>            shiny<span class="sc">::</span><span class="fu">tableOutput</span>(<span class="st">"out"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>            shiny<span class="sc">::</span><span class="fu">verbatimTextOutput</span>(<span class="st">"vals"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">selectVarServer</span>(<span class="st">"var"</span>, data, <span class="at">filter =</span> filter)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderTable</span>(<span class="fu">head</span>(<span class="fu">var</span>()))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>vals <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactiveValuesToList</span>(input,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">all.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(x)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">shinyApp</span>(ui, server)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="page-columns page-full">
<div id="fig-selectVarApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div id="fig-selectVarApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="selectVarApp.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-selectVarApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>selectVarApp()</code>
</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: <code>selectVarApp()</code> in <code>msst2ap</code>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="reactive-values-vals-1" class="level5">
<h5 class="anchored" data-anchor-id="reactive-values-vals-1">Reactive values (<span style="font-size: 1.15em"><code>vals</code></span>)</h5>
<p>The reactive values in <code>selectVarApp()</code> are displayed below the table:</p>
<div>

</div>
</section>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<section id="variables" class="level5 quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<h5 class="anchored" data-anchor-id="variables">Variables</h5>
<ul>
<li><p>the 1st <code>var</code> is from the <code>inputId</code> in <code>selectVarInput()</code></p>
<pre><code>$`-var` </code></pre></li>
<li><p>the 2nd <code>var</code> is the shared namespace <code>id</code> from the <code>selectVar</code> module</p>
<pre><code>$`var-var` </code></pre></li>
</ul>
</section>
<section id="data" class="level5 quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<h5 class="anchored" data-anchor-id="data">Data</h5>
<ul>
<li><p><code>dataset</code> is from the <code>inputId</code> in <code>datasetInput()</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">-dataset</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>data</code> is the shared namespace <code>id</code> from the <code>dataset</code> module</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
</div>
</div>
</section>
<section id="selectdatavar-module" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="selectdatavar-module"><span style="font-size: 1.10em"><code>selectDataVar</code></span> module</h4>
<p><code>selectDataVar</code> is from the <a href="https://mastering-shiny.org/scaling-modules.html#modules-inside-of-modules">Modules inside of modules</a> section, so true to form, both the <code>dataset</code> and <code>selectVar</code> modules are called inside of the UI and Server modules:</p>
<div class="cell">
<details class="code-fold">
<summary>selectDataVarUI() &amp; selectDataVarServer()</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>selectDataVarUI <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">tagList</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datasetInput</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">NS</span>(id, <span class="st">"data"</span>), </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">filter =</span> is.data.frame),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selectVarInput</span>(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">NS</span>(id, <span class="st">"var"</span>))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>selectDataVarServer <span class="ot">&lt;-</span> <span class="cf">function</span>(id, <span class="at">filter =</span> is.numeric) {</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">selectVarServer</span>(<span class="st">"var"</span>, data, <span class="at">filter =</span> filter)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    var</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="selectdatavarapp" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="selectdatavarapp"><span style="font-size: 1.15em"><code>selectDataVarApp()</code></span></h5>
<p>The <code>selectDataVarApp()</code> places the inputs in the <code>sidebarPanel()</code> and the outputs in the <code>mainPanel()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>selectDataVarApp()</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>selectDataVarApp <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">filter =</span> is.numeric) {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  ui <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">fluidPage</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">sidebarLayout</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">sidebarPanel</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectDataVarUI</span>(<span class="st">"var"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">mainPanel</span>(</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">tableOutput</span>(<span class="st">"out"</span>),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">verbatimTextOutput</span>(<span class="st">"vals"</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">selectDataVarServer</span>(<span class="st">"var"</span>, filter)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderTable</span>(<span class="fu">head</span>(<span class="fu">var</span>()))</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>vals <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactiveValuesToList</span>(input,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">all.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(x)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">shinyApp</span>(ui, server)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="page-columns page-full">
<div id="fig-selectDataVarApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-selectDataVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div id="fig-selectDataVarApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-selectDataVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="selectDataVarApp.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-selectDataVarApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-selectDataVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>selectDataVarApp()</code>
</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-selectDataVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: <code>selectDataVarApp()</code> in <code>msst2ap</code>
</figcaption>
</figure>
</div>
</div>
<p>The reactive values from <code>selectDataVarApp()</code> reflect the nested module structure:</p>
<div>

</div>
</section>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<section id="variables-1" class="level5 quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<h5 class="anchored" data-anchor-id="variables-1">Variables</h5>
<ul>
<li><p>The first <code>var</code> belongs to the <code>inputId</code> in <code>selectVarInput()</code>,</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">-var</span><span class="st">`</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>the 2nd <code>var</code> is the shared namespace <code>id</code> from the <code>selectVar</code> module,</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">-var-var</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>the 3rd <code>var</code> is the call to the <code>selectVar</code> module <em>inside</em> <code>selectDataVar</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">var-var-var</span><span class="st">`</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Ozone"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="data-1" class="level5 quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<h5 class="anchored" data-anchor-id="data-1">Data</h5>
<ul>
<li><p><code>dataset</code> belongs to the <code>inputId</code> in <code>datasetInput()</code>,</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">-dataset</span><span class="st">`</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>data</code> is the shared namespace <code>id</code> from the <code>dataset</code> module,</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">-data-dataset</span><span class="st">`</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><code>var</code> is the call to the <code>dataset</code> module <em>inside</em> <code>selectDataVar</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">var-data-dataset</span><span class="st">`</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"airquality"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
</div>
</div>
</section>
<section id="histogram-module" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="histogram-module"><span style="font-size: 1.10em"><code>histogram</code></span> module</h4>
<p>The final modules and application I’ll use from Mastering Shiny are from the <a href="https://mastering-shiny.org/scaling-modules.html#case-study-histogram">Case study: histogram</a> section. This application uses the existing <code>dataset</code> and <code>selectVar</code> modules to pass a single variable to the render a histogram:</p>
<div class="cell">
<details class="code-fold">
<summary>show/hide histogramOutput() &amp; histogramServer()</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>histogramOutput <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">tagList</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">numericInput</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">NS</span>(id, <span class="st">"bins"</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="st">"bins"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">value =</span> <span class="dv">10</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">step =</span> <span class="dv">1</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">plotOutput</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">NS</span>(id, <span class="st">"hist"</span>))</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>histogramServer <span class="ot">&lt;-</span> <span class="cf">function</span>(id, x, <span class="at">title =</span> <span class="fu">reactive</span>(<span class="st">"Histogram"</span>)) {</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(shiny<span class="sc">::</span><span class="fu">is.reactive</span>(x))</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(shiny<span class="sc">::</span><span class="fu">is.reactive</span>(title))</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>hist <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPlot</span>({</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">x</span>())</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        main <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">title</span>(), <span class="st">" ["</span>, input<span class="sc">$</span>bins, <span class="st">"]"</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hist</span>(purrr<span class="sc">::</span><span class="fu">as_vector</span>(<span class="fu">x</span>()),</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks =</span> input<span class="sc">$</span>bins,</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">main =</span> main</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">res =</span> <span class="dv">96</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>data <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">x</span>())</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">head</span>(<span class="fu">x</span>()))</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I’ve made some changes to the <code>histogramServer()</code> function (to accomodate the changes to the <code>selectVar</code> module).</p>
<ul>
<li><p>The original <code>renderPlot()</code> call in <code>histogramServer()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>hist <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req</span>(<span class="fu">is.numeric</span>(<span class="fu">x</span>()))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">title</span>(), <span class="st">" ["</span>, input<span class="sc">$</span>bins, <span class="st">"]"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(<span class="fu">x</span>(), <span class="at">breaks =</span> input<span class="sc">$</span>bins, <span class="at">main =</span> main)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">res =</span> <span class="dv">96</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>The updated <code>renderPlot()</code> call in <code>histogramServer()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>hist <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPlot</span>({</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">x</span>())</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    main <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">title</span>(), <span class="st">" [bins ="</span>, input<span class="sc">$</span>bins, <span class="st">"]"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(purrr<span class="sc">::</span><span class="fu">as_vector</span>(<span class="fu">x</span>()),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> input<span class="sc">$</span>bins,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> main)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">res =</span> <span class="dv">96</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>As you can see, <code>req()</code> is verifying <code>x()</code> exists, but doesn’t check it’s class with <code>is.numeric()</code>.</p></li>
<li><p><code>x()</code> is also passed to <code>purrr::as_vector()</code> before it’s plotted with <code>hist()</code></p></li>
</ul></li>
</ul>
<section id="histogramapp" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="histogramapp"><span style="font-size: 1.15em"><code>histogramApp()</code></span></h5>
<div class="cell">
<details class="code-fold">
<summary>histogramApp()</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>histogramApp <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  ui <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">fluidPage</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">sidebarLayout</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">sidebarPanel</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">datasetInput</span>(<span class="st">"data"</span>, is.data.frame),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectVarInput</span>(<span class="st">"var"</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">mainPanel</span>(</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">histogramOutput</span>(<span class="st">"hist"</span>),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">verbatimTextOutput</span>(<span class="st">"vals"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">selectVarServer</span>(<span class="st">"var"</span>, data)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">histogramServer</span>(<span class="st">"hist"</span>, x)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>vals <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactiveValuesToList</span>(input,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>                              <span class="at">all.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(x)</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">shinyApp</span>(ui, server)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="page-columns page-full">
<div id="fig-histogramApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div id="fig-dataStrApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-dataStrApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="histogramApp.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-histogramApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-dataStrApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>histogramApp()</code>
</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: <code>histogramApp()</code> in <code>msst2ap</code>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="reactive-values-vals-2" class="level5">
<h5 class="anchored" data-anchor-id="reactive-values-vals-2">Reactive values (<span style="font-size: 1.15em"><code>vals</code></span>)</h5>
<p>The displayed reactive values in <code>histogramApp()</code> are described below:</p>
<div>

</div>
</section>
<div class="quarto-layout-panel" data-layout-ncol="3">
<div class="quarto-layout-row">
<section id="plot" class="level5 quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<h5 class="anchored" data-anchor-id="plot">Plot</h5>
<ul>
<li><p>The <code>inputId</code> from <code>histogramOutput()</code> and the shared namespace <code>id</code></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="variables-2" class="level5 quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<h5 class="anchored" data-anchor-id="variables-2">Variables</h5>
<ul>
<li><p>The <code>inputId</code> from <code>selectVarInput()</code> and the shared namespace <code>id</code></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">var-var</span><span class="st">`</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Ozone"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="data-2" class="level5 quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<h5 class="anchored" data-anchor-id="data-2">Data</h5>
<ul>
<li><p>The <code>inputId</code> from <code>datasetInput()</code> and the shared namespace <code>id</code></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"airquality"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
</div>
</div>
<p>## Using <span style="font-size: 1.20em"><code>shinytest2</code></span></p>
<p><code>shinytest2</code> is extremely <a href="https://rstudio.github.io/shinytest2/index.html">well documentation</a>. I highly recommended the <a href="https://rstudio.github.io/shinytest2/articles/shinytest2.html">Get Started vignette</a>. In the next sections, I’ll cover some examples for what I’ve included in the <code>msst2ap</code>.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why <code>shinytest2</code>?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div style="font-size: 1.10em; color: #696969;">
<p><strong>What happened to <code>shinytest</code>?</strong></p>
<p><code>shinytest2</code> replaced <code>shinytest</code> on 2022-04-27. If you’ve previously written tests with <code>shinytest</code>–or are curious how <code>shinytest2</code> if different–I recommend going through the <a href="https://cran.r-project.org/web/packages/shinytest2/vignettes/z-migration.html#:~:text">Migrating from <code>shinytest</code></a> vignette.</p>
</div>
</div>
</div>
</div>
<p>Run <code>shinytest2::use_shinytest2()</code> to create the initial files for <code>shinytest2</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>shinytest2<span class="sc">::</span><span class="fu">use_shinytest2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>show/hide output from use_shinytest2()</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ot">! </span><span class="ex">Runner</span> already found: tests/testthat.R</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> Adding <span class="st">'shinytest2::load_app_env()'</span> to <span class="st">'tests/testthat/setup-shinytest2.R'</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> Adding <span class="st">'*_.new.png'</span> to <span class="st">'.gitignore'</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> Adding <span class="st">'_\\.new\\.png$'</span> to <span class="st">'.Rbuildignore'</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> Setting active project to <span class="st">'/projects/msst2ap'</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> Adding <span class="st">'shinytest2'</span> to Suggests field in DESCRIPTION</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="ex">•</span> Use <span class="kw">`</span><span class="ex">requireNamespace</span><span class="er">(</span><span class="st">"shinytest2"</span><span class="ex">,</span> quietly = TRUE<span class="kw">)`</span> to test if package is installed</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="ex">•</span> Then directly refer to functions with <span class="kw">`</span><span class="fu">shinytest2::fun()</span><span class="kw">`</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> Setting active project to <span class="st">'&lt;no active project&gt;'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p><code>use_shinytest2()</code> adds the <code>setup-shinytest2.R</code> script to my <code>tests/testthat/</code> folder:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tests/testthat/</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> _snaps/</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> setup-shinytest2.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<p>The <code>setup-shinytest2.R</code> file contains a single call to <code>shinytest2::load_app_env()</code>, which “<em>Executes all <code>./R</code> files and <code>global.R</code> into the current environment</em>”</p>
</section>
</section>
</section>
<section id="recording-tests" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="recording-tests">Recording tests</h2>
<p>New tests with <a href="https://rstudio.github.io/shinytest2/index.html"><code>shinytest2</code></a> can be created by launching the test event recorder, which allows us interact with our application, observe it’s behavior, and record inputs, reactive values, and outputs. To record a test, run <code>shinytest2::record_test()</code>.</p>
<p>The first argument in <code>record_test()</code> is the path to application. If you’ve stored your application in an <code>app.R</code> file, <code>record_test()</code> will automatically load that application.</p>
<ul>
<li><p>If you encounter a message telling you <a href="https://github.com/rstudio/shinytest2/issues/331">Chromium is disconnected</a>, try installing the development version of <code>chromote</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run this in the console to make sure you have dev version of chromote</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"rstudio/chromote"</span>, <span class="at">force =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chromote)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<p>In <code>msst2ap</code>, the application in <code>app.R</code> is the <code>histogramApp()</code>, so the test recorder will automatically open with this application if I run <code>record_test()</code> (without providing the path to a <code>shiny</code> app).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>shinytest2<span class="sc">::</span><span class="fu">record_test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="in-chromium" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="in-chromium">In Chromium</h3>
<div class="page-columns page-full">
<div id="fig-record_test_histogramApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-record_test_histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-record_test_histogramApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-record_test_histogramApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-record_test_histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="record_test_histogramApp.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-record_test_histogramApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-record_test_histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) shinytest2::record_test()
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-record_test_histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: <code>record_test()</code> with application in <code>app.R</code>
</figcaption>
</figure>
</div>
</div>
<p>The <code>app</code> argument can also be a “<em>path to a Shiny application</em>”. For example, I have ‘development’ versions of each application in <code>msst2ap</code> in <a href="https://github.com/mjfrigaard/msst2ap/tree/main/inst/dev"><code>inst/dev/</code></a>:</p>
<div class="cell">
<details class="code-fold">
<summary>show/hide contents of msst2ap/inst/dev</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">inst/dev</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> datasetApp</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── DESCRIPTION</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── R</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   │   └── modules.R</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── README.md</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── app.R</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> histogramApp</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── DESCRIPTION</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── R</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   │   └── modules.R</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── README.md</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── app.R</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> selectDataVarApp</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── DESCRIPTION</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── R</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   │   └── modules.R</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── README.md</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── app.R</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> selectVarApp</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> DESCRIPTION</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> R</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── modules.R</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> README.md</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> app.R</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="ex">9</span> directories, 16 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I can pass the path to each application to the <code>app</code> argument in <code>record_test()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>shinytest2<span class="sc">::</span><span class="fu">record_test</span>(<span class="at">app =</span> <span class="st">"inst/dev/histogramApp/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This opens Chromium with our shiny app:</p>
<div class="page-columns page-full">
<div id="fig-record_test_datasetApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-record_test_datasetApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-record_test_datasetApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-record_test_datasetApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-record_test_datasetApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="record_test_histogramApp.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-record_test_datasetApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-record_test_datasetApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) record_test(“inst/dev/histogramApp/”)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-record_test_datasetApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: <code>record_test()</code> with app in <code>inst/dev/histogramApp/</code> folder
</figcaption>
</figure>
</div>
</div>
<p>The test event recorder displays the <code>shiny</code> app, but also includes a window for recording each application ‘event.’</p>
<section id="expectations" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="expectations">Expectations</h4>
<p>I’ll start by recording a test for <code>histogramApp()</code>. On the right-hand side of the Chromium headless browser, you’ll see the <strong><code>shinytest2</code> expectations</strong> window:</p>
<div class="page-columns page-full">
<div id="fig-shinytest2-expectations" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-shinytest2-expectations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-shinytest2-expectations" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-expectations" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-expectations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="shinytest2-expectations.png" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-shinytest2-expectations">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-expectations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>shinytest2</code> expectations
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-shinytest2-expectations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: <code>shinytest2</code> expectations in <code>record_test()</code>
</figcaption>
</figure>
</div>
</div>
<p>The initial value in the <strong>Code</strong> window displays the dimensions of the application in Chromium (<code>app$set_window_size(width = , height = )</code>).</p>
</section>
<section id="events" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="events">Events</h4>
<p>When I interact with the application (i.e., make changes to the inputs), each change is an ‘event’ that is recorded in the test:</p>
<div class="page-columns page-full">
<div id="fig-chromium" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-chromium-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-chromium" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-change-values-shinytest2" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-change-values-shinytest2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="shinytest2-change-inputs.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-chromium">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-change-values-shinytest2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) change inputs
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-chromium-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Changing app inputs
</figcaption>
</figure>
</div>
</div>
</section>
<section id="code" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="code">Code</h4>
<p>All events are recorded as code in the <strong>Code</strong> section of <strong><code>shinytest2</code> expectations</strong>:</p>
<div class="page-columns page-full">
<div id="fig-shinytest2-code-expectations" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-shinytest2-code-expectations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-shinytest2-code-expectations" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-shinytest2-expectations-code" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-shinytest2-expectations-code-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="shinytest2-expectations-code.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-shinytest2-code-expectations">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-shinytest2-expectations-code-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) shinytest2 code expectations
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-shinytest2-code-expectations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Recorded code for each event
</figcaption>
</figure>
</div>
</div>
</section>
<section id="expect-shiny-values" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="expect-shiny-values">Expect Shiny values</h4>
<p>When I’ve finished interacting with the application, I click on the <strong>Expect Shiny values</strong> button at the top of <strong><code>shinytest2</code> expectations</strong>. This will add <code>app$expect_values()</code> to the <strong>Code</strong> section:</p>
<div class="page-columns page-full">
<div id="fig-expect-shiny-values" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-expect-shiny-values-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-expect-shiny-values" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-expect-shiny-values" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-expect-shiny-values-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="shinytest2-expect-shiny-values.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-expect-shiny-values">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-expect-shiny-values-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) expect-shiny-values
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-expect-shiny-values-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: <strong>Expect Shiny values</strong> in <code>shinytest2</code> expectations
</figcaption>
</figure>
</div>
</div>
</section>
<section id="save-test-and-exit" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="save-test-and-exit">Save test and exit</h4>
<p>Finally, to save the test, enter a <strong>Test name</strong> and click <strong>Save test and exit</strong></p>
<div class="page-columns page-full">
<div id="fig-name-save-exit" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-name-save-exit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-name-save-exit" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-shinytest2-name-save" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-shinytest2-name-save-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="shinytest2-name-save.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-body-outset-right" style="width:100.0%" data-ref-parent="fig-name-save-exit">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-shinytest2-name-save-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) name-save-exit
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-name-save-exit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Name, save and exit <code>record_test()</code>
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="in-console" class="level3">
<h3 class="anchored" data-anchor-id="in-console">In Console</h3>
<p>Back in the <strong>Console</strong>, the <code>shinytest2</code> test recorder is performing the following actions behind the scenes:</p>
<ul>
<li><p>The Chromium headless browser opens with the <code>histogramApp()</code> and <code>shiny</code> is loaded</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Listening</span> on http://127.0.0.1:7418</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">{shiny}</span> R stderr <span class="at">-----------</span> Loading required package: shiny</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p><span style="font-size: 1.20em"><strong><code>Warning</code></strong></span>: The first warning is a caused by the call to <code>shiny::loadSupport()</code>. It’s a <a href="https://github.com/rstudio/shinytest2/issues/264#issuecomment-1251422788">known issue</a>, so we can assume the developers are working on it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning</span> message:</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="ex">In</span> shiny::loadSupport<span class="er">(</span><span class="ex">app_dir,</span> renv = renv, globalrenv = globalrenv<span class="kw">)</span> <span class="bu">:</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Loading</span> R/ subdirectory for Shiny application, but this directory appears to</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">contain</span> an R package. Sourcing files in R/ may cause unexpected behavior.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>We are told the application is being run in <a href="https://rstudio.github.io/shinytest2/reference/AppDriver.html#test-mode"><code>test mode</code></a>, which ‘<em>lets the <code>AppDriver</code> retrieve values</em>’ from the app</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">{shiny}</span> R stderr <span class="at">-----------</span> Running application in test mode.</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">{shiny}</span> R stdout <span class="at">-----------</span> ℹ Loading msst2ap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p><span style="font-size: 1.20em"><strong><code>Warning</code></strong></span>: The <code>tests/testthat.R</code> file (i.e., the ‘test runner’) was overwritten and tests are now run with <code>shinytest2::test_app()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> Overwriting test runner tests/testthat.R with <span class="kw">`</span><span class="fu">shinytest2::test_app()</span><span class="kw">`</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="ex">call</span> to ensure proper a testing environment.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>When I clicked “<strong>Save test and exit</strong>”, the changes made to <code>tests/testthat.R</code> and <code>tests/testthat/test-shinytest2.R</code> are saved:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">•</span> Saving test runner: tests/testthat.R</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="ex">•</span> Saving test file: tests/testthat/test-shinytest2.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>A call to <code>shinytest2::load_app_env()</code> is added to <code>setup-shinytest2.R</code> and the test file (<code>tests/testthat/test-shinytest2.R</code>) is opened:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> Adding <span class="st">'shinytest2::load_app_env()'</span> to <span class="st">'tests/testthat/setup-shinytest2.R'</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="ex">•</span> Modify <span class="st">'/projects/msst2ap/tests/testthat/test-shinytest2.R'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>The new test is saved in the <code>tests/testthat/test-shinytest2.R</code> file and automatically run.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="ex">•</span> Running recorded test: tests/testthat/test-shinytest2.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
</section>
<section id="test-contents" class="level2">
<h2 class="anchored" data-anchor-id="test-contents">Test contents</h2>
<p>The contents of the test file generated from the test recorder are below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"{shinytest2} recording: histogramApp"</span>, {</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">name =</span> <span class="st">"histogramApp"</span>, <span class="at">height =</span> <span class="dv">657</span>, <span class="at">width =</span> <span class="dv">1069</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"privileges"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">11</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">12</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">13</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">14</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">15</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The new test file is automatically run when I exit the test recorder (as noted above), but I can also do this by clicking on <strong>Run Test</strong> or by using <code>test_file()</code> from <code>testthat</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_file</span>(<span class="st">"tests/testthat/test-shinytest2.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled" title="WARNING">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
WARNING
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div style="font-size: 1.10em; color: #000000;">
<p>Because <code>msst2ap</code> is a package, running tests with <code>shinytest2</code> will produce the warning below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="run_tests_out.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption><code>shiny::loadSupport()</code> warning</figcaption>
</figure>
</div>
<p>As noted above, this warning is <a href="https://github.com/rstudio/shinytest2/issues/264#issuecomment-1251422788">known by the <code>shinytest2</code> package authors</a> and is being addressed in a future release.</p>
</div>
</div>
</div>
</div>
<p>Now that I know the first <code>shinytest2</code> test is passing, I’ll dive into each line in the test.</p>
<section id="appdriver" class="level3">
<h3 class="anchored" data-anchor-id="appdriver"><span style="font-size: 1.15em"><code>AppDriver</code></span></h3>
<p><code>shinytest2</code> uses the <a href="https://rstudio.github.io/shinytest2/reference/AppDriver.html"><code>AppDriver</code></a> to create “<em>a full simulation of a Shiny app</em>”. When recording tests, this will be the first argument (along with the <code>name</code> of the <code>.png</code> and <code>.json</code> snapshot <code>testthat</code> files, and the <code>height</code> and <code>width</code> of the <a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html"><code>ChromoteSession</code></a>).</p>
<ul>
<li><p>The example from the test above is below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a> app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">name =</span> <span class="st">"histogramApp"</span>, <span class="at">height =</span> <span class="dv">657</span>, <span class="at">width =</span> <span class="dv">1069</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="set_inputs" class="level3">
<h3 class="anchored" data-anchor-id="set_inputs"><span style="font-size: 1.15em"><code>set_inputs()</code></span></h3>
<p>When recording <code>shinytest2</code> tests, every change to the applications inputs will result in a call to <code>app$set_inputs()</code>. This function is similar to the <code>testServer()</code> call to <code>session$setInputs()</code> (i.e., the inputs are provided as “<em>name-value pairs</em>”, i.e., <code>inputId</code> = <code>"value"</code>).</p>
<ul>
<li><p>In the <code>histogramApp()</code>, these are provided with the appended namespaces:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"privileges"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">11</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">12</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">13</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">14</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="expect_values" class="level3">
<h3 class="anchored" data-anchor-id="expect_values"><span style="font-size: 1.15em"><code>expect_values()</code></span></h3>
<p><a href="https://rstudio.github.io/shinytest2/articles/in-depth.html#making-expectations">The documentation</a> on <code>expect_values()</code> is definitely worth reading. <code>expect_values()</code> is added to the test file when <strong>Expect Shiny values</strong> is clicked in the test recorder and “<em>creates a list of values and compares them to the current values of the application</em>.”</p>
<ul>
<li><p><code>expect_values()</code> = “<em>Expect all <code>input</code>, <code>output</code>, and <code>export</code> values are consistent</em>”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">expect_values</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
</section>
<section id="test-results" class="level2">
<h2 class="anchored" data-anchor-id="test-results">Test results</h2>
<p>The results from running the new test file (<code>test-shinytest2.R</code>) are below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="ex">•</span> Running recorded test: tests/testthat/test-shinytest2.R</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> <span class="kw">|</span> <span class="ex">F</span> W S  OK <span class="kw">|</span> <span class="ex">Context</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="ex">✔</span> <span class="kw">|</span>   <span class="ex">2</span>     1 <span class="kw">|</span> <span class="ex">shinytest2</span> <span class="pp">[</span><span class="ss">6.3s</span><span class="pp">]</span>                                             </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="ex">──────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning</span> <span class="er">(</span><span class="ex">test-shinytest2.R:12:3</span><span class="kw">)</span><span class="bu">:</span> {shinytest2} recording: histogramApp</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Adding</span> new file snapshot: <span class="st">'tests/testthat/_snaps/histogramApp-001_.png'</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning</span> <span class="er">(</span><span class="ex">test-shinytest2.R:12:3</span><span class="kw">)</span><span class="bu">:</span> {shinytest2} recording: histogramApp</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Adding</span> new file snapshot: <span class="st">'tests/testthat/_snaps/histogramApp-001.json'</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="ex">──────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="ex">══</span> Results ═══════════════════════════════════════════════════════════════════</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Duration:</span> 6.7 s</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">2</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 1 ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Two warnings are displayed because the test adds two new files to the <code>tests/testthat/_snaps/</code> folder:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tests/testthat/_snaps/</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> shinytest2</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> histogramApp-001.json</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> histogramApp-001_.png</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span> directories, 2 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These are the files new test runs will be compared against (i.e., our ‘baseline’ snapshots). I’ll briefly cover their contents below:</p>
<section id="snaps" class="level3">
<h3 class="anchored" data-anchor-id="snaps"><span style="font-size: 1.15em"><code>_snaps</code></span></h3>
<p><code>expect_values()</code> generates two snapshot files in the <code>tests/testthat/_snaps/</code> folder: one <code>.png</code> and one <code>.json</code> file:</p>
<section id="png" class="level4">
<h4 class="anchored" data-anchor-id="png"><span style="font-size: 1.20em"><code>.png</code></span></h4>
<p>The image saved in <code>tests/testthat/_snaps/histogramApp-001_.png</code> is below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="histogramApp-001_.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>The image is a little grainy and hard to see, but it shows the changed dataset and variable values (<strong><code>attitude</code></strong> and <strong><code>privileges</code></strong>).</p>
</section>
<section id="json" class="level4">
<h4 class="anchored" data-anchor-id="json"><span style="font-size: 1.20em"><code>.json</code></span></h4>
<p>The <code>.json</code> file saved in <code>tests/testthat/_snaps/histogramApp-001.json</code> contains the snapshot <code>input</code>s, <code>output</code>s, and <code>export</code>s:</p>
<ul>
<li><p>The inputs show the three changed values (<code>"data-dataset"</code>, <code>"var-var"</code>, and <code>"hist-bins"</code>).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide snapshot inputs</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"input"</span><span class="ex">:</span> {</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data-dataset"</span><span class="ex">:</span> <span class="st">"attitude"</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hist-bins"</span><span class="ex">:</span> 15,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"var-var"</span><span class="ex">:</span> <span class="st">"privileges"</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">},</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></li>
</ul>
<p>The two outputs are stored in <code>"hist-hist"</code> and <code>"vals"</code>:</p>
<ul>
<li><p><code>"hist-hist"</code> holds the updated image (stored in the <code>image data hash</code>), along with various other characteristics of the plot:</p>
<div class="cell">
<details class="code-fold">
<summary>show/hide snapshot outputs</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>  <span class="st">"output"</span><span class="ex">:</span> {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hist-hist"</span><span class="ex">:</span> {</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"src"</span><span class="ex">:</span> <span class="st">"[image data hash: fde4089afc06a814d75c627b823d0806]"</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span><span class="ex">:</span> 682.6640625,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span><span class="ex">:</span> 400,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"alt"</span><span class="ex">:</span> <span class="st">"Plot object"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"coordmap"</span><span class="ex">:</span> {</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"panels"</span><span class="ex">:</span> [</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>          <span class="kw">{</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"domain"</span><span class="ex">:</span> {</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">"left"</span><span class="ex">:</span> 27.8,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">"right"</span><span class="ex">:</span> 87.2,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">"bottom"</span><span class="ex">:</span> <span class="at">-0.24,</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">"top"</span><span class="ex">:</span> 6.24</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>            <span class="ex">},</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"range"</span><span class="ex">:</span> {</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">"left"</span><span class="ex">:</span> 78.79664956011726,</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">"right"</span><span class="ex">:</span> 642.3048029692084,</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">"bottom"</span><span class="ex">:</span> 301.08,</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">"top"</span><span class="ex">:</span> 77.71999999999998</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>            <span class="ex">},</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"log"</span><span class="ex">:</span> {</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>              <span class="st">"x"</span><span class="ex">:</span> null,</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">"y"</span><span class="ex">:</span> null</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>            <span class="ex">},</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mapping"</span><span class="ex">:</span> {</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">}</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>          <span class="er">}</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>        <span class="ex">],</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dims"</span><span class="ex">:</span> {</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>          <span class="st">"width"</span><span class="ex">:</span> 682.6640625,</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>          <span class="st">"height"</span><span class="ex">:</span> 400</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>        <span class="er">}</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>      <span class="er">}</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span><span class="ex">,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></li>
<li><p><code>"vals"</code> contains the reactive values from <code>reactiveValuesToList()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide snapshot outputs</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>    <span class="st">"vals"</span><span class="ex">:</span> <span class="st">"$</span><span class="kw">`</span><span class="ex">hist-bins</span><span class="kw">`</span><span class="st">\n[1] 15\n\n$</span><span class="kw">`</span><span class="ex">var-var</span><span class="kw">`</span><span class="st">\n[1] </span><span class="dt">\"</span><span class="st">privileges</span><span class="dt">\"</span><span class="st">\n\n$</span><span class="kw">`</span><span class="ex">data-dataset</span><span class="kw">`</span><span class="st">\n[1] </span><span class="dt">\"</span><span class="st">attitude</span><span class="dt">\"</span><span class="st">\n"</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">}</span><span class="ex">,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></li>
<li><p>I didn’t export any values in this test, so <code>"export"</code> is empty:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide snapshot outputs</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>  <span class="st">"export"</span><span class="ex">:</span> {</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">}</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><em>I’ll cover this in a later test.</em></li>
</ul></li>
</ul>
</section>
<section id="namespaces" class="level4">
<h4 class="anchored" data-anchor-id="namespaces">Namespaces</h4>
<p>The contents of the <code>.json</code> snapshot should look <em>somewhat</em> familiar for the three modules contained in <code>histogramApp()</code>:</p>
<ul>
<li><p>For example, the <code>inputId</code> for <code>"dataset"</code> in the <code>datasetInput/Server</code> module communicates between the UI and server using the shared <code>id</code> argument <code>"data"</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in datasetInput()</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">selectInput</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">NS</span>(id, <span class="st">"dataset"</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pick a dataset"</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">choices =</span> names)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co"># in histogramApp()</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">sidebarPanel</span>(</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">datasetInput</span>(<span class="st">"data"</span>, is.data.frame)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>This creates the <code>$`data-dataset`</code> output we see the <code>verbatimTextOutput()</code> at the bottom of the application:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span><span class="kw">`</span><span class="ex">data-dataset</span><span class="kw">`</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[1]</span> <span class="st">"attitude"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>In the <code>.json</code> snapshot, this <code>inputId</code> is represented in the following <code>"input"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"input"</span><span class="ex">:</span> {</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data-dataset"</span><span class="ex">:</span> <span class="st">"attitude"</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">},</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<p>Namespaces and <code>inputId</code>s will come up again if you start writing your own tests, which I’ll cover below.</p>
</section>
</section>
</section>
<section id="writing-tests" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="writing-tests">Writing tests</h2>
<p>The great thing about testing with <code>shinytest2</code> is the ability to interact with the <code>AppDriver</code> as you write tests. I’ll demo writing a test for the <code>datasetApp()</code> by adapting the contents of <code>test-shinytest2.R</code> into a new <code>test-shinytest2-datasetApp.R</code> file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tests/testthat/</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> _snaps/</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── shinytest2/</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       ├── histogramApp-001.json</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── histogramApp-001_.png</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> setup-shinytest2.R</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> test-shinytest2-datasetApp.R <span class="op">&lt;</span>- new test file!</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> test-shinytest2.R</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span> directories, 5 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the new test <code>test-shinytest2-datasetApp.R</code> file, I’ll start with a call to <code>testthat::test_that(),</code> then create a new <code>app</code> object with the Chromium headless browser.</p>
<p>The namespaced standalone app function can be used to create a <code>ds_app</code> object, then <code>ds_app</code> is passed to the first argument of <code>AppDriver$new()</code> (I’ve adjusted the <code>height</code> and <code>weight</code> to fit the <code>datasetApp()</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"{shinytest2}: datasetApp"</span>, {</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  ds_app <span class="ot">&lt;-</span> msst2ap<span class="sc">::</span><span class="fu">datasetApp</span>()</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> ds_app, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <strong>Console</strong>, I can use <code>app$view()</code> to open the Chromium browser:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">view</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="page-columns page-full">
<div id="fig-app_view" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-app_view-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-app_view" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_view" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_view-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="app_view.png" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-app_view">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_view-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app_view-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: View application with <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
<p>Chromium displays the same app I see when I run <code>msst2ap::datasetApp()</code> in the console, but the headless browser has some additional developer tools (<a href="https://www.browserstack.com/guide/difference-between-chrome-and-chromium">read more</a>).</p>
<section id="setting-inputs" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="setting-inputs">Setting inputs</h3>
<p>If I continue to adapt each line in <code>test-shinytest2.R</code> to the <code>datasetApp()</code>, I see that next lines set the <code>inputId</code>s for <code>dataset-dataset</code> to the <code>attitude</code> dataset with <code>app$set_input()</code> (<em>Note that this uses the module notation above (i.e., <code>"id-inputId"</code></em>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"{shinytest2}: datasetApp"</span>, {</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  ds_app <span class="ot">&lt;-</span> msst2ap<span class="sc">::</span><span class="fu">datasetApp</span>()</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> ds_app, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you can see both windows, you’ll see the application values change in the Chromium browser:</p>
<div class="page-columns page-full">
<div id="fig-set_inputs" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-set_inputs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-set_inputs" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_set_inputs" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_set_inputs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="app_set_inputs.png" class="img-fluid figure-img column-page-right" data-ref-parent="fig-set_inputs">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_set_inputs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>app$set_inputs()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-set_inputs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Set application inputs with <code>app$set_inputs()</code>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="checking-inputs" class="level3">
<h3 class="anchored" data-anchor-id="checking-inputs">Checking inputs</h3>
<p>In the previous test, I used the <code>expect_values()</code> to capture a list of all the app values (<code>input</code>, <code>output</code>, <code>export</code>). I can also capture these values in a list <em>inside</em> the test by including a call to <code>app$get_values()</code> and assigning the output to <code>app_values</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: datasetApp"</span>, {</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  ds_app <span class="ot">&lt;-</span> msst2ap<span class="sc">::</span><span class="fu">datasetApp</span>()</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> ds_app, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>app_values</code> has a similar structure to the <code>.json</code> snapshot covered above (i.e., with <code>input</code>, <code>output</code>, and <code>export</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(app_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="ex">List</span> of 3</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">$</span> input :List of 1</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">..$</span> dataset-dataset: chr <span class="st">"attitude"</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">$</span> output:List of 2</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">..$</span> data: chr <span class="st">"&lt;table  class = 'table shiny-table table- "</span><span class="kw">|</span> <span class="ex">__truncated__</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">..$</span> vals: chr <span class="st">"$</span><span class="kw">`</span><span class="ex">dataset-dataset</span><span class="kw">`</span><span class="st">\n[1] </span><span class="dt">\"</span><span class="st">attitude</span><span class="dt">\"</span><span class="st">\n"</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">$</span> export: Named list<span class="er">(</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I can narrow the scope of the test by using <code>app_values</code> to verify only the <code>input</code> that was changed with <code>app$set_inputs()</code>::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: datasetApp"</span>, {</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  ds_app <span class="ot">&lt;-</span> msst2ap<span class="sc">::</span><span class="fu">datasetApp</span>()</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> ds_app, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_values<span class="sc">$</span>input<span class="sc">$</span><span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span>,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="st">"attitude"</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At the end of the test, I’ll add a call <a href="https://rstudio.github.io/shinytest2/articles/zzz-faq.html#should-i-manually-shut-down-my-appdriver"><code>app$stop()</code></a> to close the Chromium app.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: datasetApp"</span>, {</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  ds_app <span class="ot">&lt;-</span> msst2ap<span class="sc">::</span><span class="fu">datasetApp</span>()</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> ds_app, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_values<span class="sc">$</span>input<span class="sc">$</span><span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="st">"attitude"</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">stop</span>()</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="running-tests" class="level3">
<h3 class="anchored" data-anchor-id="running-tests">Running tests</h3>
<p>I’ll save the <code>test-shinytest2-datasetApp.R</code> file and run the test with <code>testthat::test_file()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_file</span>(<span class="st">"tests/testthat/test-shinytest2-datasetApp.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled" title="WARNING">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
WARNING
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div style="font-size: 1.10em; color: #000000;">
<p>If you encounter the error message below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">0</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 0 ]</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span> : Chromote: timed out waiting for response to command Target.createTarget</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">0</span> <span class="kw">|</span> <span class="ex">SKIP</span> 1 <span class="kw">|</span> <span class="ex">PASS</span> 0 ]</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="ex">──</span> Skipped tests <span class="er">(</span><span class="ex">1</span><span class="kw">)</span> <span class="ex">───────────────────────────────────────────────────────────</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="ex">•</span> <span class="kw">`</span><span class="ex">shinytest2::AppDriver</span><span class="kw">`</span> can not be initialized as {chromote} can not be </span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">started</span> <span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="bu">:</span> test-shinytest2-selectVarApp.R:4:3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Try installing and loading <code>chromote</code> and <code>shinytest2</code> again (this seemed to work for me).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"rstudio/chromote"</span>, </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">force =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chromote)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shinytest2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<p>In the initial run of the test for <code>datasetApp()</code>, no snapshot files are generated because the test didn’t include a call to <code>app$export_values()</code>.</p>
<p>I see this initial test passes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">0</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 1 ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exporting-test-values" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="exporting-test-values">Exporting test values</h2>
<p>The <code>shinytest2</code> documentation <a href="https://rstudio.github.io/shinytest2/articles/in-depth.html#exported-values">repeatedly</a> <a href="https://rstudio.github.io/shinytest2/articles/robust.html#exported-values">recommends</a> exporting test values from shiny applications with <code>shiny::exportTestValues()</code>.</p>
<section id="exporttestvalues" class="level3">
<h3 class="anchored" data-anchor-id="exporttestvalues"><span style="font-size: 1.20em"><code>exportTestValues()</code></span></h3>
<p>I’ll demonstrate exporting test values from <code>selectVarApp()</code> by adding the following to the <code>server</code> function in <code>inst/dev/app.R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">selectVarServer</span>(<span class="st">"var"</span>, data, <span class="at">filter =</span> filter)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>out <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderTable</span>(<span class="fu">head</span>(<span class="fu">var</span>()))</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>vals <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactiveValuesToList</span>(input,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">all.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(x)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">exportTestValues</span>(</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">var =</span> <span class="fu">var</span>(),</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">data</span>()</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-system.file" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="using-system.file">Using <span style="font-size: 1.20em"><code>system.file()</code></span></h3>
<p>After loading, documenting and installing the package, I’ll create a <code>test-shinytest2-selectVarApp.R</code> test file and add the initial contents to create the <code>AppDriver</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: selectVarApp"</span>, {</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>,</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">package =</span> <span class="st">"msst2ap"</span>),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">600</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that to test the development version of <code>selectVarApp()</code>, I pass a call to <code>system.file()</code> to the <code>app_dir</code> argument (this is a similar folder structure to apps built with <a href="https://thinkr-open.github.io/golem/articles/a_start.html"><code>golem</code></a> and <a href="https://leprechaun.opifex.org/#/guide/build"><code>leprechaun</code></a> frameworks)</p>
<p>After entering <code>app$view()</code> in the <strong>Console</strong>, the application opens in the Chromium headless browser again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">view</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="page-columns page-full">
<div id="fig-app_view_selectVarApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-app_view_selectVarApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_view_selectVarApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="app_view_selectVarApp.png" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-app_view_selectVarApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_view_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app_view_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: View <code>selectVarApp()</code> application with <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
<p>In the test file, I’ll use <code>app$set_values()</code> to change the <code>$`data-dataset`</code> and <code>$`var-var`</code> inputs:</p>
<ul>
<li><p>Change <code>$`data-dataset`</code> to <code>mtcars</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: selectVarApp"</span>, {</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">package =</span> <span class="st">"msst2ap"</span>),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">600</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<div class="page-columns page-full">
<div id="fig-app_view_set_data_selectVarApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_set_data_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-app_view_set_data_selectVarApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_view_set_data_selectVarApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_set_data_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="app_view_set_data_selectVarApp.png" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-app_view_set_data_selectVarApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_view_set_data_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Set <code>data-dataset</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app_view_set_data_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: View <code>selectVarApp()</code> after setting <code>data-dataset</code> with <code>app$set_inputs()</code>
</figcaption>
</figure>
</div>
</div>
<ul>
<li><p>Change <code>$`var-var`</code> to <code>wt</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: selectVarApp"</span>, {</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">package =</span> <span class="st">"msst2ap"</span>),</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">600</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"wt"</span>)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<div class="page-columns page-full">
<div id="fig-app_view_set_var_selectVarApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_set_var_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-app_view_set_var_selectVarApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_view_set_var_selectVarApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_set_var_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="app_view_set_var_selectVarApp.png" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-app_view_set_var_selectVarApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_view_set_var_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Set <code>var-var</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app_view_set_var_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: View <code>selectVarApp()</code> after setting <code>var-var</code> with <code>app$set_inputs()</code>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="get_values" class="level3">
<h3 class="anchored" data-anchor-id="get_values"><span style="font-size: 1.20em"><code>get_values()</code></span></h3>
<p>I’ll use <code>app$get_values()</code> to store the exported <code>input</code>, <code>output</code>, and <code>export</code> test values in <code>app_values</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: selectVarApp"</span>, {</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">package =</span> <span class="st">"msst2ap"</span>),</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">600</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"wt"</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>app_values</code> is a list (similar to the <code>.json</code> snapshot file), but now we’ve explicitly <code>export</code>ed values from the server in <code>selectVarApp()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(app_values<span class="sc">$</span>export)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[1]</span> <span class="st">"data"</span> <span class="st">"var"</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exported-expectations" class="level3">
<h3 class="anchored" data-anchor-id="exported-expectations"><span style="font-size: 1.20em"><code>export</code></span>ed expectations</h3>
<p>I can use <code>app_values</code> to verify the structure of each exported object:</p>
<ul>
<li><code>data</code> should be a <code>data.frame()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> <span class="fu">is.data.frame</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>var</code> should be a single column <code>data.frame()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> <span class="fu">ncol</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>var) <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, I end the test with a call to <code>app$stop()</code>. The completed test for <code>selectVarApp()</code> is below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: selectVarApp"</span>, {</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">package =</span> <span class="st">"msst2ap"</span>),</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">600</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"wt"</span>)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> <span class="fu">is.data.frame</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>data))</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> <span class="fu">ncol</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>var) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">stop</span>()</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I can run the test with <code>testthat::test_file()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_file</span>(<span class="at">path =</span> <span class="st">"tests/testthat/test-shinytest2-selectVarApp.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results are below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">0</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 2 ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="testing-complex-outputs" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="testing-complex-outputs">Testing complex outputs</h2>
<p>I’ve created an adapted version of the <code>histogramApp()</code> in the <code>inst/dev/gghistApp/</code> folder (view contents <a href="https://github.com/mjfrigaard/msst2ap/tree/main/inst/dev/gghistApp#gghistapp">here</a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="ex">inst/dev/gghistApp/</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>            <span class="ex">├──</span> DESCRIPTION</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>            <span class="ex">├──</span> R/</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>            <span class="ex">│</span>   └── modules.R</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>            <span class="ex">├──</span> README.md</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>            <span class="ex">└──</span> app.R</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span> directories, 4 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>gghistApp()</code> renders a <code>ggplot2</code> graph, which makes it easier to demonstrate <a href="https://rstudio.github.io/shinytest2/articles/robust.html#example">this example of checking a plot</a> from the <code>shinytest2</code> package website.</p>
<div class="page-columns page-full">
<div id="fig-sbs_histogramApp_gghistApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-sbs_histogramApp_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row column-page-inset-right">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-sbs_histogramApp_gghistApp" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sbs_histogramApp" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-sbs_histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sbs_histogramApp.png" class="img-fluid figure-img" data-ref-parent="fig-sbs_histogramApp_gghistApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sbs_histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>histogramApp()</code>
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-sbs_histogramApp_gghistApp" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sbs_gghistApp" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-sbs_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="sbs_gghistApp.png" class="img-fluid figure-img" data-ref-parent="fig-sbs_histogramApp_gghistApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sbs_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) <code>gghistApp()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sbs_histogramApp_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: <code>histogramApp()</code> vs.&nbsp;<code>gghistApp()</code>
</figcaption>
</figure>
</div>
</div>
<p>The <code>gghistApp()</code> is similar to <code>histogramApp()</code>, but instead of using <code>hist()</code> to generate the plot, a reactive <code>plot_obj()</code> is passed to <code>shiny::renderPlot()</code> (like the example above).</p>
<p>Due to the structure of the modules in the application, the <code>exportTestValues()</code> function is placed in the <code>gghistServer()</code> function:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide gghistServer()</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>gghistServer <span class="ot">&lt;-</span> <span class="cf">function</span>(id, x, <span class="at">title =</span> <span class="fu">reactive</span>(<span class="st">"Histogram"</span>)) {</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(shiny<span class="sc">::</span><span class="fu">is.reactive</span>(x))</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(shiny<span class="sc">::</span><span class="fu">is.reactive</span>(title))</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create plot object</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    plot_obj <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactive</span>({</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>                  shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">x</span>())</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>                  purrr<span class="sc">::</span><span class="fu">as_vector</span>(<span class="fu">x</span>())</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>                  })</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># render plot object</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>hist <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPlot</span>({</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">req</span>(<span class="fu">x</span>())</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">mapping =</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="fu">plot_obj</span>())) <span class="sc">+</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> input<span class="sc">$</span>bins) <span class="sc">+</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">paste0</span>(<span class="fu">title</span>(), <span class="st">" [bins = "</span>, input<span class="sc">$</span>bins, <span class="st">"]"</span>),</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="fu">names</span>(<span class="fu">x</span>())) <span class="sc">+</span></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">res =</span> <span class="dv">124</span>) <span class="sc">|&gt;</span></span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">c</span>(<span class="fu">x</span>(), input<span class="sc">$</span>bins),</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># export app values</span></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">exportTestValues</span>(</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">x</span>(),</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot_obj =</span> <span class="fu">plot_obj</span>()</span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><p><code>gghistServer()</code> is replaces <code>histogramServer()</code> in the standalone app function (<code>gghistApp()</code>):</p>
<div class="cell">
<details class="code-fold">
<summary>show/hide gghistApp()</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>gghistApp <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  ui <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">fluidPage</span>(</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">sidebarLayout</span>(</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">sidebarPanel</span>(</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">datasetInput</span>(<span class="st">"data"</span>, is.data.frame),</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">selectVarInput</span>(<span class="st">"var"</span>),</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">mainPanel</span>(</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">histogramOutput</span>(<span class="st">"hist"</span>),</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">verbatimTextOutput</span>(<span class="st">"vals"</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">selectVarServer</span>(<span class="st">"var"</span>, data)</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gghistServer</span>(<span class="st">"hist"</span>, x)</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>vals <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactiveValuesToList</span>(input,</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>                          <span class="at">all.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(x, <span class="at">width =</span> <span class="dv">30</span>, <span class="at">max.levels =</span> <span class="cn">NULL</span>)</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">width =</span> <span class="dv">30</span>)</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">shinyApp</span>(ui, server)</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></li>
</ul>
<p>In the <code>test-shinytest2-gghistApp.R</code> test file, I’ll verify the <a href="https://vdiffr.r-lib.org/"><code>vdiffr</code> package</a> is installed with <code>testthat::skip_if_not_installed()</code>, then create the <code>AppDriver</code> object with a call to <code>system.file()</code> and set the <code>height</code> and <code>width</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">"{shinytest2}: gghistApp"</span>, {</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skip_if_not_installed</span>(<span class="st">"vdiffr"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"gghistApp"</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">package =</span> <span class="st">"msst2ap"</span>),</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">height =</span> <span class="dv">750</span>, <span class="at">width =</span> <span class="dv">1200</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View the application in the Chromium browser by running <code>app$view()</code> in the <strong>Console</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">view</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="page-columns page-full">
<div id="fig-app_view_gghistApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-app_view_gghistApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_view_gghistApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="app_view_gghistApp.png" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-app_view_gghistApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_view_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app_view_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: View <code>gghistApp()</code> application with <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
<p>I’ll replicate the <a href="https://rstudio.github.io/shinytest2/articles/robust.html#example">example</a> from the website using the <code>gghistApp()</code>:</p>
<section id="verify-initial-input" class="level3">
<h3 class="anchored" data-anchor-id="verify-initial-input">Verify initial <span style="font-size: 1.20em"><code>input</code></span></h3>
<ul>
<li><p>The first expectations in the example test the default <code>input</code> values with <strong><code>app$get_value(input = )</code></strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify initial data</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  app_init_data <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">"data-dataset"</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_init_data,</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="st">"BOD"</span>)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify initial variable</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  app_init_var <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">"var-var"</span>)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_init_var,</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="st">"Time"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="set-and-verify-export" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="set-and-verify-export">Set and verify <span style="font-size: 1.20em"><code>export</code></span></h3>
<ul>
<li><p>Next, we check the exported values after changing the inputs with <code>app$set_values()</code> and <strong><code>app$get_value(export = )</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify exported `x()` data</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  app_exp_x_01 <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">export =</span> <span class="st">"hist-x"</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_exp_x_01, </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> mtcars[<span class="dv">1</span>])</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify exported `plot_obj()` data</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"wt"</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  app_exp_plot_obj_01 <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">export =</span> <span class="st">"hist-plot_obj"</span>)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_exp_plot_obj_01,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> purrr<span class="sc">::</span><span class="fu">as_vector</span>(app_exp_plot_obj_01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>The <code>bins</code> are also set to a new value with <code>app$set_inputs()</code> <em>after</em> verifying the exported values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify `hist-bins` changes</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">15</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  app_set_bins_01 <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">"hist-bins"</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_set_bins_01,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<div class="page-columns page-full">
<div id="fig-app_view_set_inputs_gghistApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_set_inputs_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-app_view_set_inputs_gghistApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_view_set_inputs_gghistApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_set_inputs_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="app_view_set_inputs_gghistApp.png" class="img-fluid figure-img column-page-inset-right" style="width:100.0%" data-ref-parent="fig-app_view_set_inputs_gghistApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_view_set_inputs_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>set_inputs()</code> and <code>get_value()</code> in <code>gghistApp()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app_view_set_inputs_gghistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Set <code>input</code>s and get <code>export</code>ed values in <code>gghistApp()</code>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="verify-plot-with-vdiffr" class="level3">
<h3 class="anchored" data-anchor-id="verify-plot-with-vdiffr">Verify plot with <span style="font-size: 1.20em"><code>vdiffr</code></span></h3>
<ul>
<li><p>Now we verify the plot with the exported <code>plot_obj</code> (in the <code>hist</code> module) with <code>expect_doppelganger()</code> from the <code>vdiffr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify `hist-plot_obj` changes</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  plot_obj_15 <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">export =</span> <span class="st">"hist-plot_obj"</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  vdiffr<span class="sc">::</span><span class="fu">expect_doppelganger</span>(</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"hist-plot_obj-15"</span>,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fig =</span> plot_obj_15)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><em>I saved the test file and ran the test to confirm the snapshot file was created in <code>tests/testthat/_snaps/</code></em>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">1</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 6 ]</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="ex">──</span> Warning <span class="er">(</span><span class="ex">_test-shinytest2-gghistApp.R:45:3</span><span class="kw">)</span><span class="bu">:</span> {shinytest2}: gghistApp ───</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Adding</span> new file snapshot: <span class="st">'tests/testthat/_snaps/hist-plot-obj-15.svg'</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">1</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 6 ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="set_-get_-expect_" class="level3">
<h3 class="anchored" data-anchor-id="set_-get_-expect_"><span style="font-size: 1.10em"><code>set_</code>, <code>get_</code>, <code>expect_</code></span></h3>
<p>The process above is repeated with new values passed to <strong><code>app$set_inputs()</code></strong> and verified with <strong><code>app$get_value(export = )</code></strong>:</p>
<ul>
<li><p>The <code>x()</code>, <code>plot_obj()</code> and <code>hist-bins</code> are updated again with new values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Update `data` to USArrests</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"USArrests"</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  app_exp_x_02 <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">export =</span> <span class="st">"hist-x"</span>)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_exp_x_02,</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> USArrests[<span class="dv">1</span>])</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Update `var` to UrbanPop</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"UrbanPop"</span>)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  app_exp_plot_obj_02 <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">export =</span> <span class="st">"hist-plot_obj"</span>)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_exp_plot_obj_02,</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> purrr<span class="sc">::</span><span class="fu">as_vector</span>(app_exp_plot_obj_02))</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Update `bins` to 12</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">12</span>)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>  app_set_bins_02 <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">"hist-bins"</span>)</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_set_bins_02,</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>The new plot is verified again with <code>expect_doppelganger()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Verify updates to `hist-plot_obj`</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  plot_obj_12 <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">export =</span> <span class="st">"hist-plot_obj"</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  vdiffr<span class="sc">::</span><span class="fu">expect_doppelganger</span>(</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"hist-plot_obj-12"</span>,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fig =</span> plot_obj_12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><em>This initial run of this test will show a warning again as the snapshot file is saved to <code>tests/testthat/_snaps/</code></em>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">1</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 10 ]</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="ex">──</span> Warning <span class="er">(</span><span class="ex">_test-shinytest2-gghistApp.R:77:3</span><span class="kw">)</span><span class="bu">:</span> {shinytest2}: gghistApp ───</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Adding</span> new file snapshot: <span class="st">'tests/testthat/_snaps/hist-plot-obj-12.svg'</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">1</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 10 ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<p>The final results of the <code>test-shinytest2-gghistApp.R</code> are below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_file</span>(<span class="st">"tests/testthat/_test-shinytest2-gghistApp.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">0</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 5 ]</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">wt1</span>   wt2   wt3   wt4   wt5   wt6   wt7   wt8   wt9  wt10  wt11  wt12  wt13 </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="ex">2.620</span> 2.875 2.320 3.215 3.440 3.460 3.570 3.190 3.150 3.440 3.440 4.070 3.730 </span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">wt14</span>  wt15  wt16  wt17  wt18  wt19  wt20  wt21  wt22  wt23  wt24  wt25  wt26 </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="ex">3.780</span> 5.250 5.424 5.345 2.200 1.615 1.835 2.465 3.520 3.435 3.840 3.845 1.935 </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">wt27</span>  wt28  wt29  wt30  wt31  wt32 </span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="ex">2.140</span> 1.513 3.170 2.770 3.570 2.780 </span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">0</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 9 ] </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a> <span class="ex">UrbanPop1</span>  UrbanPop2  UrbanPop3  UrbanPop4  UrbanPop5  UrbanPop6  UrbanPop7 </span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">58</span>         48         80         50         91         78         77 </span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">UrbanPop8</span>  UrbanPop9 UrbanPop10 UrbanPop11 UrbanPop12 UrbanPop13 UrbanPop14 </span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">72</span>         80         60         83         54         83         65 </span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="ex">UrbanPop15</span> UrbanPop16 UrbanPop17 UrbanPop18 UrbanPop19 UrbanPop20 UrbanPop21 </span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">57</span>         66         52         66         51         67         85 </span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="ex">UrbanPop22</span> UrbanPop23 UrbanPop24 UrbanPop25 UrbanPop26 UrbanPop27 UrbanPop28 </span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">74</span>         66         44         70         53         62         81 </span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="ex">UrbanPop29</span> UrbanPop30 UrbanPop31 UrbanPop32 UrbanPop33 UrbanPop34 UrbanPop35 </span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>        <span class="ex">56</span>         89         70         86         45         44         75 </span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a><span class="ex">UrbanPop36</span> UrbanPop37 UrbanPop38 UrbanPop39 UrbanPop40 UrbanPop41 UrbanPop42 </span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>        <span class="ex">68</span>         67         72         87         48         45         59 </span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a><span class="ex">UrbanPop43</span> UrbanPop44 UrbanPop45 UrbanPop46 UrbanPop47 UrbanPop48 UrbanPop49 </span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>        <span class="ex">80</span>         80         32         63         73         39         66 </span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a><span class="ex">UrbanPop50</span> </span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>        <span class="ex">60</span> </span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> FAIL 0 <span class="er">|</span> <span class="er">WARN</span> <span class="ex">0</span> <span class="kw">|</span> <span class="ex">SKIP</span> 0 <span class="kw">|</span> <span class="ex">PASS</span> 10 ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The vector in each <code>plot_obj()</code> test is printed with <code>expect_doppelganger()</code>, but this doesn’t interfere with the results.</p>
<p>I can run <code>devtools::test()</code> to run all the tests in <code>msst2ap</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="recap" class="level2">
<h2 class="anchored" data-anchor-id="recap">Recap</h2>
<p>This post has covered creating tests with <code>testthat</code> and <code>shinytest2</code> for an app-package containing a shiny application (with modules!). As you can see, the test recorder makes it easier to test specific app behaviors, and the <code>AppDriver</code> makes it possible to build a set of test expectations iteratively. Other items to consider when writing <code>shinytest2</code> tests include:</p>
<ol type="1">
<li><p><strong>Define What to Test</strong>: Since Shiny apps are interactive, so <code>shinytest2</code> tests should simulate user interaction as much as possible. The tests should focus on key user interactions and the output they should generate. <code>shinytest2</code> provides functions for simulating user clicks, inputs, and other interactions. Not every interaction needs to be tested, but crucial ones and those that handle complex logic should be.</p></li>
<li><p><strong>Organize Your Tests &amp; Use Descriptive Test Names</strong>: Organize your tests into separate files based on what they are testing. Each test should have a descriptive name that clarifies what the test is for. Organizing your test files with unambiguous names will make it easier to manage multiple tests, and it will make it easier to understand what’s going wrong when a test fails.</p></li>
<li><p><strong>Create snapshots for expected outputs</strong>: Use snapshot files to verify that an app’s output matches the expected results. <code>AppDriver$expect_values()</code> generates <code>.json</code> and <code>.png</code> snapshot files for the application. The .json file contains <code>input</code>, <code>output</code>, and <code>export</code> values, and the .png file is a <em>debug</em> screenshot, which records how the app looked when the values where captured. These files can then be compared to a baseline snapshot.</p></li>
<li><p><strong>Export app values</strong>: While snapshot files are great for detecting changes, it’s important to remember that “<em>differences in the captured screenshot will never cause test failures.</em>” Manually inspecting the snapshot .png files during test development can also be time-consuming and tedious. Wherever possible, export app values and compare them against expected reference values.</p></li>
</ol>
<p>In general, <code>shinytest2</code> is designed for end-to-end testing of shiny applications. These tests can capture the state of a shiny app (input, output, and exported values) during user interactions and compare them with a previous state (i.e., snapshots), which is useful for regression testing.</p>
<p><code>shinytest2</code> tests can also simulate user interaction in a way that <code>shiny::testServer()</code> tests can’t, such as waiting for reactive outputs to update after the input changes, clicking on action buttons, etc. <code>shinytest2</code> can also be resource-intensive, so it’s recommended to write these tests after you’ve completed the standard <code>testthat</code> unit tests and <code>testServer()</code> tests.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>