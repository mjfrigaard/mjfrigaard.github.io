<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Frigaard">
<meta name="dcterms.date" content="2023-07-04">

<title>@mjfrigaard - Shiny system tests with shinytest2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title"><span class="citation" data-cites="mjfrigaard">@mjfrigaard</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../series.html"> 
<span class="menu-text">Series</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../code.html"> 
<span class="menu-text">Code</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mjfrigaard"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mjfrigaard"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#app-packages" id="toc-app-packages" class="nav-link active" data-scroll-target="#app-packages">App-Packages</a>
  <ul>
  <li><a href="#using-system.file" id="toc-using-system.file" class="nav-link" data-scroll-target="#using-system.file">Using <span style="font-size: 1.10em; font-weight: bold;"><code>system.file()</code></span></a></li>
  <li><a href="#setting-inputs" id="toc-setting-inputs" class="nav-link" data-scroll-target="#setting-inputs">Setting inputs</a></li>
  <li><a href="#checking-inputs" id="toc-checking-inputs" class="nav-link" data-scroll-target="#checking-inputs">Checking inputs</a></li>
  </ul></li>
  <li><a href="#exporting-test-values" id="toc-exporting-test-values" class="nav-link" data-scroll-target="#exporting-test-values">Exporting test values</a>
  <ul>
  <li><a href="#getting-values" id="toc-getting-values" class="nav-link" data-scroll-target="#getting-values">Getting values</a></li>
  <li><a href="#expectations" id="toc-expectations" class="nav-link" data-scroll-target="#expectations">Expectations</a></li>
  </ul></li>
  <li><a href="#testing-complex-outputs" id="toc-testing-complex-outputs" class="nav-link" data-scroll-target="#testing-complex-outputs">Testing complex outputs</a>
  <ul>
  <li><a href="#testing-reactive-values" id="toc-testing-reactive-values" class="nav-link" data-scroll-target="#testing-reactive-values">Testing reactive values</a></li>
  <li><a href="#using-app-logs" id="toc-using-app-logs" class="nav-link" data-scroll-target="#using-app-logs">Using app logs</a></li>
  <li><a href="#verify-initial-inputs" id="toc-verify-initial-inputs" class="nav-link" data-scroll-target="#verify-initial-inputs">Verify initial <span style="font-size: 1.10em; font-weight: bold;"><code>input</code></span>s</a></li>
  <li><a href="#set-and-verify-export" id="toc-set-and-verify-export" class="nav-link" data-scroll-target="#set-and-verify-export">Set and verify <span style="font-size: 1.10em; font-weight: bold;"><code>export</code></span></a></li>
  <li><a href="#verify-exports" id="toc-verify-exports" class="nav-link" data-scroll-target="#verify-exports">Verify <span style="font-size: 1.10em; font-weight: bold;"><code>export</code></span>s</a></li>
  <li><a href="#verify-plot-with-vdiffr" id="toc-verify-plot-with-vdiffr" class="nav-link" data-scroll-target="#verify-plot-with-vdiffr">Verify plot with <span style="font-size: 1.10em; font-weight: bold;"><code>vdiffr</code></span></a></li>
  <li><a href="#set-get-expect" id="toc-set-get-expect" class="nav-link" data-scroll-target="#set-get-expect">Set, get, expect</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  <li><a href="#recap" id="toc-recap" class="nav-link" data-scroll-target="#recap">Recap</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Shiny system tests with <code>shinytest2</code></h1>
<p class="subtitle lead">Part 4 (series): writing efficient system tests</p>
  <div class="quarto-categories">
    <div class="quarto-category">shiny</div>
    <div class="quarto-category">testing</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Martin Frigaard </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This is the fourth post in a <a href="https://mjfrigaard.github.io/series.html#testing-shiny-applications">series on testing</a> Shiny applications. The previous posts have covered using <a href="https://mjfrigaard.github.io/posts/p1-tests-unit-tests/">BDD in unit tests</a>, testing apps <a href="https://mjfrigaard.github.io/posts/p2-tests-nonpkg-unit-tests/">outside of an R package</a> structure, and <a href="https://mjfrigaard.github.io/posts/p3-test-shiny-module-tests/">testing module server functions</a>. In this post, we’ll be covering testing Shiny applications using <code>testthat</code> and <code>shinytest2</code>.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="img/image.svg" class="img-fluid" style="width:70.0%"></p>
</div></div><section id="app-packages" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="app-packages">App-Packages</h2>
<p>In the previous post, we stored the modules and applications from the <a href="https://mastering-shiny.org/scaling-modules.html">Shiny modules chapter</a> of Mastering Shiny in the <a href="https://github.com/mjfrigaard/sapkgs/tree/mstsap"><code>mstsap</code></a> branch of <code>sapkgs</code>, which you can install using the code below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"remotes"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://github.com/mjfrigaard/sapkgs"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"mstsap"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <a href="https://github.com/mjfrigaard/sapkgs/tree/msst2ap"><code>msst2ap</code></a> branch of <code>sapkgs</code> contains <code>shinytest2</code> tests for the Shiny apps in <code>mstsap</code> (hence the name: <strong>M</strong>astering <strong>S</strong>hiny <strong>s</strong>hiny<strong>t</strong>est<strong>2</strong> <strong>a</strong>pp-<strong>p</strong>ackage).</p>
<p>You can install <code>msst2ap</code> using the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"remotes"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://github.com/mjfrigaard/sapkgs"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref =</span> <span class="st">"msst2ap"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The beauty of R packages is that we can use the modules we developed in the previous <code>mstsap</code> branch as a dependency for <code>msst2ap</code> by adding this package to the <code>Depends</code> field of the <code>DESCRIPTION</code> file (this will automatically attach the <code>mstsap</code> to the search list when <code>msst2ap</code> is loaded).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ℹ Loading msst2ap</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Loading required package: mstsap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I’ve stored development versions of the applications in the <a href="https://github.com/mjfrigaard/sapkgs/tree/mstsap/inst/dev"><code>inst/dev/</code> folder</a> of <code>mstsap</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>inst/</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  └── dev/</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>      ├── datasetApp/</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      │   ├── DESCRIPTION</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      │   ├── app.R</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      │   └── modules.R</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      ├── selectDataVarApp/</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      │   ├── DESCRIPTION</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      │   ├── README.md</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      │   ├── app.R</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      │   └── modules.R</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      └── selectVarApp/</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>          ├── DESCRIPTION</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>          ├── README.md</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>          ├── app.R</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>          ├── modules.R</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>          └── utils.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="using-system.file" class="level3">
<h3 class="anchored" data-anchor-id="using-system.file">Using <span style="font-size: 1.10em; font-weight: bold;"><code>system.file()</code></span></h3>
<p>The apps stored in the <code>inst/dev/</code> directory of <code>mstsap</code> can be passed to the <code>app_dir</code> argument of <code>AppDriver$new()</code> with <code>system.file()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::datasetApp"</span>, {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"datasetApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> app_pth, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">view</span>()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="img/app_view_datasetApp.png" class="img-fluid" style="width:100.0%"></p>
<p>The first things we’ll check with our test is the window size we’ve provided and the <code>system.file()</code> path to the <code>datasetApp</code> in <code>mstsap</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::datasetApp"</span>, {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"datasetApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> app_pth, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app<span class="sc">$</span><span class="fu">get_window_size</span>(), </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">800</span>L, <span class="at">height =</span> <span class="dv">600</span>L))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app<span class="sc">$</span><span class="fu">get_dir</span>(),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> app_pth)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="setting-inputs" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="setting-inputs">Setting inputs</h3>
<p>Next we’ll change <code>dataset-dataset</code> input from <code>ability.cov</code> to <code>attitude</code> using <code>app$set_inputs()</code> (<em>Note that this uses the module notation above (i.e., <code>"id-inputId"</code></em>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::datasetApp"</span>, {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"datasetApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> app_pth, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># previous tests omitted</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you can see both windows, you’ll see the application values change in the Chromium browser:</p>
<div class="page-columns page-full">
<div id="fig-set_inputs" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-set_inputs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-set_inputs" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_set_inputs" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_set_inputs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="img/app_set_inputs.png" class="img-fluid figure-img column-page-right" data-ref-parent="fig-set_inputs">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_set_inputs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>app$set_inputs()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-set_inputs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Set application inputs with <code>app$set_inputs()</code>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="checking-inputs" class="level3">
<h3 class="anchored" data-anchor-id="checking-inputs">Checking inputs</h3>
<p>In the previous test, we used the <code>expect_values()</code> to capture a list of all the app values (<code>input</code>, <code>output</code>, <code>export</code>). We can also capture these values in a list <em>inside</em> the test by including a call to <code>app$get_values()</code> and assigning the output to <code>app_values</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::datasetApp"</span>, {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"datasetApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> app_pth, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># previous tests omitted</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>app_values</code> has a similar structure to the <code>.json</code> snapshot covered above (i.e., with <code>input</code>, <code>output</code>, and <code>export</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(app_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb11"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>List of 3</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> $ input :List of 1</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  ..$ dataset-dataset: chr "attitude"</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a> $ output:List of 2</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  ..$ data: chr "&lt;table  class = 'table shiny-table table- spacing-s' style = 'width:auto;'&gt;\n&lt;thead&gt; &lt;tr"..</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  ..$ vals: chr "$`dataset-dataset`\n[1] \"attitude\"\n"</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a> $ export: Named list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can use <code>waldo::compare()</code> to verify the <code>input</code> in <code>app_values</code> to verify the value that we changed with <code>app$set_inputs()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>waldo<span class="sc">::</span><span class="fu">compare</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> app_values<span class="sc">$</span>input<span class="sc">$</span><span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="st">"attitude"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>✔ No differences</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>waldo::compare()</code> can easily be adapted to a new test expectation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::datasetApp"</span>, {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"datasetApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> app_pth, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># previous tests omitted</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_values<span class="sc">$</span>input<span class="sc">$</span><span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="st">"attitude"</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At the end of the test, I’ll add a call <a href="https://rstudio.github.io/shinytest2/articles/zzz-faq.html#should-i-manually-shut-down-my-appdriver"><code>app$stop()</code></a> to close the Chromium app.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::datasetApp"</span>, {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"datasetApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(<span class="at">app_dir =</span> app_pth, <span class="at">height =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">800</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app<span class="sc">$</span><span class="fu">get_window_size</span>(), </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">800</span>L, <span class="at">height =</span> <span class="dv">600</span>L))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app<span class="sc">$</span><span class="fu">get_dir</span>(),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> app_pth)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> app_values<span class="sc">$</span>input<span class="sc">$</span><span class="st">`</span><span class="at">dataset-dataset</span><span class="st">`</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected =</span> <span class="st">"attitude"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">stop</span>()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exporting-test-values" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="exporting-test-values">Exporting test values</h2>
<p>The <code>shinytest2</code> documentation repeatedly<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> recommends<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> exporting test values from Shiny applications. We’ll use the application stored in <code>inst/dev/selectVarApp/</code> to explore exporting test values.</p>
<p>The application in the <code>inst/dev/selectVarApp/</code> folder of <code>mstsap</code> includes a call to <code>exportTestValues()</code> and the <code>test.mode</code> option set to <code>TRUE</code> in the call to <code>shinyApp()</code>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">selectVarServer</span>(<span class="st">"var"</span>, data, <span class="at">filter =</span> filter)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>out <span class="ot">&lt;-</span> <span class="fu">renderTable</span>(<span class="fu">head</span>(<span class="fu">var</span>()))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>vals <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">reactiveValuesToList</span>(input,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">all.names =</span> <span class="cn">TRUE</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(x)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exportTestValues</span>(</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">var =</span> <span class="fu">var</span>(),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data</span>()</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The test for this application contains the same <code>system.file()</code> call to create the <code>AppDriver</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::selectVarApp"</span>, {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_pth, <span class="at">height =</span> <span class="dv">1200</span>, <span class="at">width =</span> <span class="dv">1000</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After entering <code>app$view()</code> in the <strong>Console</strong>, the application opens in the Chromium headless browser again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">view</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see <code>selectVarApp</code> has been launched in showcase mode, so the <code>README</code> and code files are displayed in the UI.</p>
<div class="page-columns page-full">
<div id="fig-app_view_selectVarApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-app_view_selectVarApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_view_selectVarApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="img/app_view_selectVarApp.png" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-app_view_selectVarApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_view_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app_view_selectVarApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: View <code>selectVarApp()</code> application with <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
<p>In our test file, we’ll use <code>app$set_values()</code> to change the <code>$`data-dataset`</code> and <code>$`var-var`</code> inputs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-19"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-19-1"><a href="#annotated-cell-19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::selectVarApp"</span>, {</span>
<span id="annotated-cell-19-2"><a href="#annotated-cell-19-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="annotated-cell-19-3"><a href="#annotated-cell-19-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_pth, <span class="at">height =</span> <span class="dv">1200</span>, <span class="at">width =</span> <span class="dv">1000</span>)</span>
<span id="annotated-cell-19-4"><a href="#annotated-cell-19-4" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-19" data-target-annotation="1">1</button><span id="annotated-cell-19-5" class="code-annotation-target"><a href="#annotated-cell-19-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<span id="annotated-cell-19-6"><a href="#annotated-cell-19-6" aria-hidden="true" tabindex="-1"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="5" data-code-annotation="1">Change <code>$`data-dataset`</code> to <code>mtcars</code></span>
</dd>
</dl>
</div>
</div>
<p>We’ll also change the variable input from <code>mpg</code> to <code>wt</code> and verify the output in the UI:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-20"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-20-1"><a href="#annotated-cell-20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::selectVarApp"</span>, {</span>
<span id="annotated-cell-20-2"><a href="#annotated-cell-20-2" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="annotated-cell-20-3"><a href="#annotated-cell-20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>,</span>
<span id="annotated-cell-20-4"><a href="#annotated-cell-20-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">package =</span> <span class="st">"mstsap"</span></span>
<span id="annotated-cell-20-5"><a href="#annotated-cell-20-5" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="annotated-cell-20-6"><a href="#annotated-cell-20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">1200</span>,</span>
<span id="annotated-cell-20-7"><a href="#annotated-cell-20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1000</span></span>
<span id="annotated-cell-20-8"><a href="#annotated-cell-20-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1">1</button><span id="annotated-cell-20-9" class="code-annotation-target"><a href="#annotated-cell-20-9" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="2">2</button><span id="annotated-cell-20-10" class="code-annotation-target"><a href="#annotated-cell-20-10" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"wt"</span>)</span>
<span id="annotated-cell-20-11"><a href="#annotated-cell-20-11" aria-hidden="true" tabindex="-1"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="9" data-code-annotation="1">Change <code>$`data-dataset`</code> to <code>mtcars</code></span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="10" data-code-annotation="2">Change <code>$`var-var`</code> to <code>wt</code></span>
</dd>
</dl>
</div>
</div>
<p>The printed <code>reactiveValuesToList()</code> is updated UI when the <code>selectInput()</code> changes:</p>
<div class="page-columns page-full">
<div id="fig-selectVarApp_changes" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-selectVarApp_changes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-selectVarApp_changes" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-selectVarApp_changes" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-selectVarApp_changes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="img/selectVarApp_changes.gif" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-selectVarApp_changes">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-selectVarApp_changes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Set <code>data-dataset</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-selectVarApp_changes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: View <code>selectVarApp()</code> after setting <code>data-dataset</code> and <code>var-var</code> with <code>app$set_inputs()</code>
</figcaption>
</figure>
</div>
</div>
<section id="getting-values" class="level3">
<h3 class="anchored" data-anchor-id="getting-values">Getting values</h3>
<p>We’ll use <code>app$get_values()</code> to store the exported <code>input</code>, <code>output</code>, and <code>export</code> test values in <code>app_values</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-21"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-21-1"><a href="#annotated-cell-21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::selectVarApp"</span>, {</span>
<span id="annotated-cell-21-2"><a href="#annotated-cell-21-2" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="annotated-cell-21-3"><a href="#annotated-cell-21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>,</span>
<span id="annotated-cell-21-4"><a href="#annotated-cell-21-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">package =</span> <span class="st">"mstsap"</span></span>
<span id="annotated-cell-21-5"><a href="#annotated-cell-21-5" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="annotated-cell-21-6"><a href="#annotated-cell-21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">1200</span>,</span>
<span id="annotated-cell-21-7"><a href="#annotated-cell-21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1000</span></span>
<span id="annotated-cell-21-8"><a href="#annotated-cell-21-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="annotated-cell-21-9"><a href="#annotated-cell-21-9" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="1">1</button><span id="annotated-cell-21-10" class="code-annotation-target"><a href="#annotated-cell-21-10" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="2">2</button><span id="annotated-cell-21-11" class="code-annotation-target"><a href="#annotated-cell-21-11" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"wt"</span>)</span>
<span id="annotated-cell-21-12"><a href="#annotated-cell-21-12" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="3">3</button><span id="annotated-cell-21-13" class="code-annotation-target"><a href="#annotated-cell-21-13" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="annotated-cell-21-14"><a href="#annotated-cell-21-14" aria-hidden="true" tabindex="-1"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-21" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="10" data-code-annotation="1">Change <code>$`data-dataset`</code> to <code>mtcars</code></span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="11" data-code-annotation="2">Change <code>$`var-var`</code> to <code>wt</code></span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="13" data-code-annotation="3">Assign to <code>app_values</code> list</span>
</dd>
</dl>
</div>
</div>
<p><code>app_values</code> is a list (similar to the <code>.json</code> snapshot file), but now we’ve explicitly exported values from the server in <code>selectVarApp()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(app_values<span class="sc">$</span>export)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[1]</span> <span class="st">"data"</span> <span class="st">"var"</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="expectations" class="level3">
<h3 class="anchored" data-anchor-id="expectations">Expectations</h3>
<p>We can use <code>app_values</code> to verify the structure of each exported object:</p>
<ul>
<li><code>data</code> should be a <code>data.frame()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">expect_true</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> <span class="fu">is.data.frame</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>data)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>var</code> should be a numeric vector:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> <span class="fu">is.numeric</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>var)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once again, we end the test with a call to <code>app$stop()</code>. The completed test for <code>selectVarApp()</code> is below:</p>
<div class="cell">
<details class="code-fold">
<summary>show/hide mstsap::selectVarApp test</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"mstsap::selectVarApp"</span>, {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"selectVarApp"</span>, <span class="at">package =</span> <span class="st">"mstsap"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_pth, <span class="at">height =</span> <span class="dv">1200</span>, <span class="at">width =</span> <span class="dv">1000</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># app$view()</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(app<span class="sc">$</span><span class="fu">get_window_size</span>(), </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">1000</span>L, <span class="at">height =</span> <span class="dv">1200</span>L))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(app<span class="sc">$</span><span class="fu">get_dir</span>(), app_pth)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"mtcars"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"wt"</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> <span class="fu">is.data.frame</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>data))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> <span class="fu">is.numeric</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>var))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">stop</span>()</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="testing-complex-outputs" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="testing-complex-outputs">Testing complex outputs</h2>
<p>The <code>msst2ap</code> branch has the <a href="https://mastering-shiny.org/scaling-modules.html#case-study-histogram"><code>histogramApp()</code> from Mastering Shiny</a> in <code>inst/dev/histogramApp/</code>, and a <code>ggplot2</code> version of the <code>histogramApp()</code> in the <code>inst/dev/ggHistApp/</code> folder (view contents <a href="https://github.com/mjfrigaard/sapkgs/tree/msst2ap/inst/dev/ggHistApp">here</a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">inst</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> dev</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> ggHistApp</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── DESCRIPTION</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── R</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   │   └── modules.R</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   ├── README.md</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── app.R</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> histogramApp</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> DESCRIPTION</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> R</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">│</span>   └── modules.R</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> README.md</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> app.R</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span> directories, 8 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div data-layout="[49,-2,49]" data-layout-valign="top">
<div id="fig-sbs_histogramApp_ggHistApp" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sbs_histogramApp_ggHistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-sbs_histogramApp_ggHistApp" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sbs_histogramApp" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-sbs_histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/sbs_histogramApp.png" class="img-fluid figure-img" data-ref-parent="fig-sbs_histogramApp_ggHistApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sbs_histogramApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>histogramApp()</code>
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-sbs_histogramApp_ggHistApp" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-sbs_ggHistApp" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-sbs_ggHistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/sbs_ggHistApp.png" class="img-fluid figure-img" data-ref-parent="fig-sbs_histogramApp_ggHistApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-sbs_ggHistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) <code>ggHistApp()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sbs_histogramApp_ggHistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: <code>histogramApp()</code> vs.&nbsp;<code>ggHistApp()</code>
</figcaption>
</figure>
</div>
</div>
<section id="testing-reactive-values" class="level3">
<h3 class="anchored" data-anchor-id="testing-reactive-values">Testing reactive values</h3>
<p>The module server functions in <code>histogramApp()</code> return two values: <code>data</code> and <code>x</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide values in msst2ap::histogramApp() server</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">selectVarServer</span>(<span class="st">"var"</span>, data)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">histogramServer</span>(<span class="st">"hist"</span>, x)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remaining code omitted</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>data</code> is returned reactive from <code>datasetServer()</code> and becomes an input parameter for <code>selectVarServer()</code>, and <code>x</code> is the returned reactive.</p>
<p>Both of these are reactive values, but they aren’t treated like returned values from the <code>reactive()</code> function (i.e., they don’t have parentheses). These are passed in the server as reactive <em>expressions</em>, which we can confirm using <code>exportTestValues()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide msst2ap::histogramApp() server</summary>
<div class="sourceCode cell-code" id="annotated-cell-29"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-29-1"><a href="#annotated-cell-29-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="annotated-cell-29-2"><a href="#annotated-cell-29-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<span id="annotated-cell-29-3"><a href="#annotated-cell-29-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">selectVarServer</span>(<span class="st">"var"</span>, data)</span>
<span id="annotated-cell-29-4"><a href="#annotated-cell-29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">histogramServer</span>(<span class="st">"hist"</span>, x)</span>
<span id="annotated-cell-29-5"><a href="#annotated-cell-29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-29-6"><a href="#annotated-cell-29-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remaining code omitted</span></span>
<span id="annotated-cell-29-7"><a href="#annotated-cell-29-7" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="1">1</button><span id="annotated-cell-29-8" class="code-annotation-target"><a href="#annotated-cell-29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exportTestValues</span>(</span>
<span id="annotated-cell-29-9"><a href="#annotated-cell-29-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="annotated-cell-29-10"><a href="#annotated-cell-29-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x</span>
<span id="annotated-cell-29-11"><a href="#annotated-cell-29-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-29-12"><a href="#annotated-cell-29-12" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-29" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="8,11" data-code-annotation="1">We’ve also added <code>options(shiny.testmode = TRUE)</code> to the top of the <code>app.R</code> file.</span>
</dd>
</dl>
</div>
</div>
<p>In the test for <code>histogramApp()</code>, we’ll create the app with <code>AppDriver$new()</code> and change the three inputs using <code>app$set_inputs()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide msst2ap::histogramApp() server</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"{shinytest2} recording: histogramApp"</span>, {</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"histogramApp"</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">package =</span> <span class="st">"msst2ap"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_pth, <span class="at">height =</span> <span class="dv">750</span>, <span class="at">width =</span> <span class="dv">1200</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"privileges"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">15</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(app_values)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="sourceCode" id="cb27"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>[1] "data" "x"  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ll test is these are reactive functions by combining <code>rlang::is_function()</code> and <code>shiny::is.reactive()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide msst2ap::histogramApp() values</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"{shinytest2} recording: histogramApp"</span>, {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"histogramApp"</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">package =</span> <span class="st">"msst2ap"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_pth, <span class="at">height =</span> <span class="dv">750</span>, <span class="at">width =</span> <span class="dv">1200</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"privileges"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">15</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  app_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(app_values)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    rlang<span class="sc">::</span><span class="fu">is_function</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>data),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">is.reactive</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>data))</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    rlang<span class="sc">::</span><span class="fu">is_function</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>x),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">is.reactive</span>(app_values<span class="sc">$</span>export<span class="sc">$</span>x))</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="using-app-logs" class="level3">
<h3 class="anchored" data-anchor-id="using-app-logs">Using app logs</h3>
<p><code>shinytest2</code> also has the handy <code>get_logs()</code> that allows us to check the logs for specific functionality. Below is the output from <code>get_logs()</code> from <code>histogramApp()</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide msst2ap::histogramApp() logs</summary>
<div class="sourceCode cell-code" id="annotated-cell-33"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-33-1"><a href="#annotated-cell-33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"{shinytest2} recording: histogramApp"</span>, {</span>
<span id="annotated-cell-33-2"><a href="#annotated-cell-33-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"histogramApp"</span>,</span>
<span id="annotated-cell-33-3"><a href="#annotated-cell-33-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">package =</span> <span class="st">"msst2ap"</span>)</span>
<span id="annotated-cell-33-4"><a href="#annotated-cell-33-4" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_pth, <span class="at">height =</span> <span class="dv">750</span>, <span class="at">width =</span> <span class="dv">1200</span>)</span>
<span id="annotated-cell-33-5"><a href="#annotated-cell-33-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="annotated-cell-33-6"><a href="#annotated-cell-33-6" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"privileges"</span>)</span>
<span id="annotated-cell-33-7"><a href="#annotated-cell-33-7" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">15</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="1">1</button><span id="annotated-cell-33-8" class="code-annotation-target"><a href="#annotated-cell-33-8" aria-hidden="true" tabindex="-1"></a>  app_logs <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_logs</span>()</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="2">2</button><span id="annotated-cell-33-9" class="code-annotation-target"><a href="#annotated-cell-33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>(app_logs)</span>
<span id="annotated-cell-33-10"><a href="#annotated-cell-33-10" aria-hidden="true" tabindex="-1"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-33" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="8" data-code-annotation="1">Create app logs</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="9" data-code-annotation="2">View log structure</span>
</dd>
</dl>
</div>
</div>
<div class="sourceCode" id="cb29"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Classes ‘shinytest2_log’ and 'data.frame':  56 obs. of  5 variables:</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a> $ workerid : chr  NA NA NA NA ...</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a> $ timestamp: POSIXct, format: "2024-03-31 04:47:41" "2024-03-31 04:47:41" ...</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a> $ location : chr  "shinytest2" "shinytest2" "shinytest2" "shinytest2" ...</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a> $ level    : chr  "info" "info" "info" "info" ...</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a> $ message  : chr  "Start AppDriver initialization" "Starting Shiny app" "Creating "..</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After changing the three inputs with <code>set_inputs()</code>, we can check the output to see these actions were included in the logs:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide msst2ap::histogramApp() logs</summary>
<div class="sourceCode cell-code" id="annotated-cell-35"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-35-1"><a href="#annotated-cell-35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"{shinytest2} recording: histogramApp"</span>, {</span>
<span id="annotated-cell-35-2"><a href="#annotated-cell-35-2" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"histogramApp"</span>,</span>
<span id="annotated-cell-35-3"><a href="#annotated-cell-35-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">package =</span> <span class="st">"msst2ap"</span>)</span>
<span id="annotated-cell-35-4"><a href="#annotated-cell-35-4" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_pth, <span class="at">height =</span> <span class="dv">750</span>, <span class="at">width =</span> <span class="dv">1200</span>)</span>
<span id="annotated-cell-35-5"><a href="#annotated-cell-35-5" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"attitude"</span>)</span>
<span id="annotated-cell-35-6"><a href="#annotated-cell-35-6" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"privileges"</span>)</span>
<span id="annotated-cell-35-7"><a href="#annotated-cell-35-7" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">15</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="1">1</button><span id="annotated-cell-35-8" class="code-annotation-target"><a href="#annotated-cell-35-8" aria-hidden="true" tabindex="-1"></a>  app_logs <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_logs</span>()</span>
<span id="annotated-cell-35-9"><a href="#annotated-cell-35-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># str(app_logs)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="2">2</button><span id="annotated-cell-35-10" class="code-annotation-target"><a href="#annotated-cell-35-10" aria-hidden="true" tabindex="-1"></a>  ds_msg <span class="ot">&lt;-</span> <span class="fu">subset</span>(app_logs,</span>
<span id="annotated-cell-35-11"><a href="#annotated-cell-35-11" aria-hidden="true" tabindex="-1"></a>                   message <span class="sc">==</span> <span class="st">"Setting inputs: 'data-dataset'"</span>)</span>
<span id="annotated-cell-35-12"><a href="#annotated-cell-35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ds_msg), <span class="dv">1</span>L)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="3">3</button><span id="annotated-cell-35-13" class="code-annotation-target"><a href="#annotated-cell-35-13" aria-hidden="true" tabindex="-1"></a>  var_msg <span class="ot">&lt;-</span> <span class="fu">subset</span>(app_logs,</span>
<span id="annotated-cell-35-14"><a href="#annotated-cell-35-14" aria-hidden="true" tabindex="-1"></a>                    message <span class="sc">==</span> <span class="st">"Setting inputs: 'var-var'"</span>)</span>
<span id="annotated-cell-35-15"><a href="#annotated-cell-35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(var_msg), <span class="dv">1</span>L)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="4">4</button><span id="annotated-cell-35-16" class="code-annotation-target"><a href="#annotated-cell-35-16" aria-hidden="true" tabindex="-1"></a>  hist_msg <span class="ot">&lt;-</span> <span class="fu">subset</span>(app_logs,</span>
<span id="annotated-cell-35-17"><a href="#annotated-cell-35-17" aria-hidden="true" tabindex="-1"></a>                     message <span class="sc">==</span> <span class="st">"Setting inputs: 'hist-bins'"</span>)</span>
<span id="annotated-cell-35-18"><a href="#annotated-cell-35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(hist_msg), <span class="dv">1</span>L)</span>
<span id="annotated-cell-35-19"><a href="#annotated-cell-35-19" aria-hidden="true" tabindex="-1"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-35" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="8" data-code-annotation="1">Create app logs<br>
</span>
</dd>
<dt data-target-cell="annotated-cell-35" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="10,11,12" data-code-annotation="2">Create and test dataset<br>
</span>
</dd>
<dt data-target-cell="annotated-cell-35" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="13,15" data-code-annotation="3">Create and test variable<br>
</span>
</dd>
<dt data-target-cell="annotated-cell-35" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="16,18" data-code-annotation="4">Create and test bins</span>
</dd>
</dl>
</div>
</div>
<p>Logs can also be passed from the test to the application using <a href="https://rstudio.github.io/shinytest2/reference/AppDriver.html#method-log-message-"><code>log_message()</code></a>.</p>
</section>
<section id="verify-initial-inputs" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="verify-initial-inputs">Verify initial <span style="font-size: 1.10em; font-weight: bold;"><code>input</code></span>s</h3>
<p>The <code>ggHistApp()</code> app is similar to <code>histogramApp()</code>, but instead of passing a reactive vector to <code>hist()</code>, <code>ggHistServer()</code> passes a reactive one-column <code>data.frame</code> (<code>x()</code>) to the <code>ggplot2</code> functions. We’ll add <code>exportTestValues()</code> to a development version of <code>ggHistServer()</code> in <code>inst/dev/</code>: <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide ggHistServer()</summary>
<div class="sourceCode cell-code" id="annotated-cell-36"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-36-1"><a href="#annotated-cell-36-1" aria-hidden="true" tabindex="-1"></a>ggHistServer <span class="ot">&lt;-</span> <span class="cf">function</span>(id, x, <span class="at">title =</span> <span class="fu">reactive</span>(<span class="st">"Histogram"</span>)) {</span>
<span id="annotated-cell-36-2"><a href="#annotated-cell-36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.reactive</span>(x))</span>
<span id="annotated-cell-36-3"><a href="#annotated-cell-36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.reactive</span>(title))</span>
<span id="annotated-cell-36-4"><a href="#annotated-cell-36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-36-5"><a href="#annotated-cell-36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="annotated-cell-36-6"><a href="#annotated-cell-36-6" aria-hidden="true" tabindex="-1"></a>    </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="1">1</button><span id="annotated-cell-36-7" class="code-annotation-target"><a href="#annotated-cell-36-7" aria-hidden="true" tabindex="-1"></a>    gg2_plot <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-36-8"><a href="#annotated-cell-36-8" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="annotated-cell-36-9"><a href="#annotated-cell-36-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span></span>
<span id="annotated-cell-36-10"><a href="#annotated-cell-36-10" aria-hidden="true" tabindex="-1"></a>            ggplot2<span class="sc">::</span><span class="fu">aes</span>(purrr<span class="sc">::</span><span class="fu">as_vector</span>(<span class="fu">x</span>()))</span>
<span id="annotated-cell-36-11"><a href="#annotated-cell-36-11" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="annotated-cell-36-12"><a href="#annotated-cell-36-12" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> input<span class="sc">$</span>bins) <span class="sc">+</span></span>
<span id="annotated-cell-36-13"><a href="#annotated-cell-36-13" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="annotated-cell-36-14"><a href="#annotated-cell-36-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">paste0</span>(<span class="fu">title</span>(), <span class="st">" [bins = "</span>, input<span class="sc">$</span>bins, <span class="st">"]"</span>),</span>
<span id="annotated-cell-36-15"><a href="#annotated-cell-36-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="annotated-cell-36-16"><a href="#annotated-cell-36-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="fu">names</span>(<span class="fu">x</span>())</span>
<span id="annotated-cell-36-17"><a href="#annotated-cell-36-17" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="annotated-cell-36-18"><a href="#annotated-cell-36-18" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="annotated-cell-36-19"><a href="#annotated-cell-36-19" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="annotated-cell-36-20"><a href="#annotated-cell-36-20" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="2">2</button><span id="annotated-cell-36-21" class="code-annotation-target"><a href="#annotated-cell-36-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">observe</span>({</span>
<span id="annotated-cell-36-22"><a href="#annotated-cell-36-22" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>hist <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({<span class="fu">gg2_plot</span>()}, <span class="at">res =</span> <span class="dv">124</span>)</span>
<span id="annotated-cell-36-23"><a href="#annotated-cell-36-23" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> </span>
<span id="annotated-cell-36-24"><a href="#annotated-cell-36-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bindEvent</span>(<span class="fu">c</span>(<span class="fu">x</span>(), <span class="fu">title</span>(), input<span class="sc">$</span>bins))</span>
<span id="annotated-cell-36-25"><a href="#annotated-cell-36-25" aria-hidden="true" tabindex="-1"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-36" data-target-annotation="3">3</button><span id="annotated-cell-36-26" class="code-annotation-target"><a href="#annotated-cell-36-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exportTestValues</span>(</span>
<span id="annotated-cell-36-27"><a href="#annotated-cell-36-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">bins =</span> input<span class="sc">$</span>bins,</span>
<span id="annotated-cell-36-28"><a href="#annotated-cell-36-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">x</span>(),</span>
<span id="annotated-cell-36-29"><a href="#annotated-cell-36-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">title</span>()</span>
<span id="annotated-cell-36-30"><a href="#annotated-cell-36-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-36-31"><a href="#annotated-cell-36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-36-32"><a href="#annotated-cell-36-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remaining code omitted</span></span>
<span id="annotated-cell-36-33"><a href="#annotated-cell-36-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-36-34"><a href="#annotated-cell-36-34" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="annotated-cell-36-35"><a href="#annotated-cell-36-35" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-36" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="7,19" data-code-annotation="1">Build <code>ggplot2</code> graph</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="21,24" data-code-annotation="2">Render plot<br>
</span>
</dd>
<dt data-target-cell="annotated-cell-36" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-36" data-code-lines="26,30" data-code-annotation="3">Export bins, <code>x()</code> and <code>title()</code></span>
</dd>
</dl>
</div>
</div>
<p>The version of <code>ggHistServer()</code> above replaces the <code>ggHistServer()</code> used in the standalone app function).<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> The remaining modules from <code>mstsap</code> are explicitly namespaced. The code below identifies the location of each module in <code>ggHistApp()</code>: <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide ggHistApp()</summary>
<div class="sourceCode cell-code" id="annotated-cell-37"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-37-1"><a href="#annotated-cell-37-1" aria-hidden="true" tabindex="-1"></a>ggHistApp <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="annotated-cell-37-2"><a href="#annotated-cell-37-2" aria-hidden="true" tabindex="-1"></a>  ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="annotated-cell-37-3"><a href="#annotated-cell-37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="annotated-cell-37-4"><a href="#annotated-cell-37-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sidebarPanel</span>(</span>
<span id="annotated-cell-37-5"><a href="#annotated-cell-37-5" aria-hidden="true" tabindex="-1"></a>        mstsap<span class="sc">::</span><span class="fu">datasetInput</span>(<span class="st">"data"</span>, is.data.frame),</span>
<span id="annotated-cell-37-6"><a href="#annotated-cell-37-6" aria-hidden="true" tabindex="-1"></a>        mstsap<span class="sc">::</span><span class="fu">selectVarInput</span>(<span class="st">"var"</span>),</span>
<span id="annotated-cell-37-7"><a href="#annotated-cell-37-7" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="annotated-cell-37-8"><a href="#annotated-cell-37-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mainPanel</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="1">1</button><span id="annotated-cell-37-9" class="code-annotation-target"><a href="#annotated-cell-37-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">histogramOutput</span>(<span class="st">"hist"</span>),</span>
<span id="annotated-cell-37-10"><a href="#annotated-cell-37-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">code</span>(<span class="st">"app vals"</span>),</span>
<span id="annotated-cell-37-11"><a href="#annotated-cell-37-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">verbatimTextOutput</span>(<span class="st">"vals"</span>)</span>
<span id="annotated-cell-37-12"><a href="#annotated-cell-37-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="annotated-cell-37-13"><a href="#annotated-cell-37-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-37-14"><a href="#annotated-cell-37-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="annotated-cell-37-15"><a href="#annotated-cell-37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-37-16"><a href="#annotated-cell-37-16" aria-hidden="true" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="annotated-cell-37-17"><a href="#annotated-cell-37-17" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> mstsap<span class="sc">::</span><span class="fu">datasetServer</span>(<span class="st">"data"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="2">2</button><span id="annotated-cell-37-18" class="code-annotation-target"><a href="#annotated-cell-37-18" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">ggSelectVarServer</span>(<span class="st">"var"</span>, data)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="3">3</button><span id="annotated-cell-37-19" class="code-annotation-target"><a href="#annotated-cell-37-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggHistServer</span>(<span class="st">"hist"</span>, x)</span>
<span id="annotated-cell-37-20"><a href="#annotated-cell-37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-37-21"><a href="#annotated-cell-37-21" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>vals <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="annotated-cell-37-22"><a href="#annotated-cell-37-22" aria-hidden="true" tabindex="-1"></a>        x <span class="ot">&lt;-</span> <span class="fu">reactiveValuesToList</span>(input,</span>
<span id="annotated-cell-37-23"><a href="#annotated-cell-37-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">all.names =</span> <span class="cn">TRUE</span>)</span>
<span id="annotated-cell-37-24"><a href="#annotated-cell-37-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(x, <span class="at">width =</span> <span class="dv">30</span>, <span class="at">max.levels =</span> <span class="cn">NULL</span>)},</span>
<span id="annotated-cell-37-25"><a href="#annotated-cell-37-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">30</span>)</span>
<span id="annotated-cell-37-26"><a href="#annotated-cell-37-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-37-27"><a href="#annotated-cell-37-27" aria-hidden="true" tabindex="-1"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="4">4</button><span id="annotated-cell-37-28" class="code-annotation-target"><a href="#annotated-cell-37-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exportTestValues</span>(</span>
<span id="annotated-cell-37-29"><a href="#annotated-cell-37-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">x</span>(),</span>
<span id="annotated-cell-37-30"><a href="#annotated-cell-37-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">data</span>(),</span>
<span id="annotated-cell-37-31"><a href="#annotated-cell-37-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">react_x =</span> x,</span>
<span id="annotated-cell-37-32"><a href="#annotated-cell-37-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">react_data =</span> data</span>
<span id="annotated-cell-37-33"><a href="#annotated-cell-37-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-37-34"><a href="#annotated-cell-37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-37-35"><a href="#annotated-cell-37-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shinyApp</span>(ui, server)</span>
<span id="annotated-cell-37-36"><a href="#annotated-cell-37-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-37-37"><a href="#annotated-cell-37-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggHistApp</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-37" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="9" data-code-annotation="1">From <code>R/histogramOutput.R</code><br>
</span>
</dd>
<dt data-target-cell="annotated-cell-37" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="18" data-code-annotation="2">From <code>R/ggSelectVarServer.R</code><br>
</span>
</dd>
<dt data-target-cell="annotated-cell-37" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="19" data-code-annotation="3">From <code>inst/dev/ggHistApp/R/modules.R</code></span>
</dd>
<dt data-target-cell="annotated-cell-37" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="28,33" data-code-annotation="4">Exported test values</span>
</dd>
</dl>
</div>
</div>
<p>In the <code>test-shinytest2-ggHistApp.R</code> test file, I’ll verify the <a href="https://vdiffr.r-lib.org/"><code>vdiffr</code> package</a> is installed, then create the <code>AppDriver</code> object with a call to <code>system.file()</code> and set the <code>height</code> and <code>width</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"{shinytest2}: ggHistApp"</span>, {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skip_if_not_installed</span>(<span class="st">"vdiffr"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  app_pth <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"dev"</span>, <span class="st">"ggHistApp"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">package =</span> <span class="st">"msst2ap"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  app <span class="ot">&lt;-</span> AppDriver<span class="sc">$</span><span class="fu">new</span>(app_pth,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">height =</span> <span class="dv">750</span>, <span class="at">width =</span> <span class="dv">1200</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View the application in the Chromium browser by running <code>app$view()</code> in the <strong>Console</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">view</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="page-columns page-full">
<div id="fig-app_view_ggHistApp" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_ggHistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-columns page-full">
<div class="quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-app_view_ggHistApp" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app_view_ggHistApp" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-app_view_ggHistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="img/app_view_ggHistApp.png" class="img-fluid figure-img column-body-outset-right" data-ref-parent="fig-app_view_ggHistApp">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-app_view_ggHistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app_view_ggHistApp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: View <code>ggHistApp()</code> application with <code>app$view()</code>
</figcaption>
</figure>
</div>
</div>
<p>The first expectations in the example test the default <code>input</code> values with <strong><code>app$get_value(input = )</code></strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initial values----</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># verify initial values </span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>init_ds <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">'data-dataset'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>init_var <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">'var-var'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># is the variable from the dataset?</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  init_var <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">get</span>(init_ds, <span class="st">"package:datasets"</span>))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>init_bins <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">'hist-bins'</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(init_bins))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-and-verify-export" class="level3">
<h3 class="anchored" data-anchor-id="set-and-verify-export">Set and verify <span style="font-size: 1.10em; font-weight: bold;"><code>export</code></span></h3>
<p>Next, we check chamging the input values with <strong><code>app$set_values(id-inputId)</code></strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set values ----</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'mtcars'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">"data-dataset"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify new data</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(<span class="at">object =</span> new_data,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">expected =</span> <span class="st">"mtcars"</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'disp'</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>new_var <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">input =</span> <span class="st">"var-var"</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify new variable</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(<span class="at">object =</span> new_var,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">expected =</span> <span class="st">"disp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="verify-exports" class="level3">
<h3 class="anchored" data-anchor-id="verify-exports">Verify <span style="font-size: 1.10em; font-weight: bold;"><code>export</code></span>s</h3>
<p>Finally, we’ll test the exported values by creating <strong><code>app$get_values()$export</code></strong> and checking it’s contents:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exported objects ----</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>exp_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()<span class="sc">$</span>export</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check reactives/functions</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(shiny<span class="sc">::</span><span class="fu">is.reactive</span>(exp_values<span class="sc">$</span>react_data))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(shiny<span class="sc">::</span><span class="fu">is.reactive</span>(exp_values<span class="sc">$</span>react_x))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(rlang<span class="sc">::</span><span class="fu">is_function</span>(exp_values<span class="sc">$</span>react_data))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(rlang<span class="sc">::</span><span class="fu">is_function</span>(exp_values<span class="sc">$</span>react_x))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># check data </span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(exp_values<span class="sc">$</span>data))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_true</span>(<span class="fu">ncol</span>(exp_values<span class="sc">$</span>x) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(exp_values<span class="sc">$</span>data, mtcars)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(exp_values<span class="sc">$</span>x, mtcars[<span class="st">'disp'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="verify-plot-with-vdiffr" class="level3">
<h3 class="anchored" data-anchor-id="verify-plot-with-vdiffr">Verify plot with <span style="font-size: 1.10em; font-weight: bold;"><code>vdiffr</code></span></h3>
<p>Now we verify the plot with the exported <code>plot_obj</code> (in the <code>hist</code> module) with <code>expect_doppelganger()</code> from the <code>vdiffr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-43"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-43-1"><a href="#annotated-cell-43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify plot ----</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-43" data-target-annotation="1">1</button><span id="annotated-cell-43-2" class="code-annotation-target"><a href="#annotated-cell-43-2" aria-hidden="true" tabindex="-1"></a>gg2_plot <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_value</span>(<span class="at">output =</span> <span class="st">"hist-hist"</span>)</span>
<span id="annotated-cell-43-3"><a href="#annotated-cell-43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(gg2_plot<span class="sc">$</span>alt, <span class="st">"Plot object"</span>)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-43" data-target-annotation="2">2</button><span id="annotated-cell-43-4" class="code-annotation-target"><a href="#annotated-cell-43-4" aria-hidden="true" tabindex="-1"></a>vdiffr<span class="sc">::</span><span class="fu">expect_doppelganger</span>(</span>
<span id="annotated-cell-43-5"><a href="#annotated-cell-43-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"mtcars_disp_plot"</span>,</span>
<span id="annotated-cell-43-6"><a href="#annotated-cell-43-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fig =</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> exp_values<span class="sc">$</span>data,</span>
<span id="annotated-cell-43-7"><a href="#annotated-cell-43-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span></span>
<span id="annotated-cell-43-8"><a href="#annotated-cell-43-8" aria-hidden="true" tabindex="-1"></a>            ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> disp)</span>
<span id="annotated-cell-43-9"><a href="#annotated-cell-43-9" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="annotated-cell-43-10"><a href="#annotated-cell-43-10" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="annotated-cell-43-11"><a href="#annotated-cell-43-11" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="annotated-cell-43-12"><a href="#annotated-cell-43-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">paste0</span>(exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-title</span><span class="st">`</span>, </span>
<span id="annotated-cell-43-13"><a href="#annotated-cell-43-13" aria-hidden="true" tabindex="-1"></a>                           <span class="st">" [bins = "</span>,</span>
<span id="annotated-cell-43-14"><a href="#annotated-cell-43-14" aria-hidden="true" tabindex="-1"></a>                           exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span>, <span class="st">"]"</span>),</span>
<span id="annotated-cell-43-15"><a href="#annotated-cell-43-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="annotated-cell-43-16"><a href="#annotated-cell-43-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="fu">names</span>(exp_values<span class="sc">$</span>x)</span>
<span id="annotated-cell-43-17"><a href="#annotated-cell-43-17" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="annotated-cell-43-18"><a href="#annotated-cell-43-18" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="annotated-cell-43-19"><a href="#annotated-cell-43-19" aria-hidden="true" tabindex="-1"></a>    )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-43" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-43" data-code-lines="2,3" data-code-annotation="1">Check the rendered plot object<br>
</span>
</dd>
<dt data-target-cell="annotated-cell-43" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-43" data-code-lines="4,19" data-code-annotation="2"><code>ggHistApp()</code> renders a <code>ggplot2</code> graph, which makes it easier to demonstrate <a href="https://rstudio.github.io/shinytest2/articles/robust.html#example">this example of checking a plot</a> from the <code>shinytest2</code> package website.</span>
</dd>
</dl>
</div>
</div>
<p><em>I saved the test file and ran the test to confirm the snapshot file was created in <code>tests/testthat/_snaps/</code></em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">──</span> Warning <span class="er">(</span><span class="ex">test-shinytest2-ggHistApp.R:58:3</span><span class="kw">)</span><span class="bu">:</span> {shinytest2}: ggHistApp ─────────</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Adding</span> new file snapshot: <span class="st">'tests/testthat/_snaps/mtcars_disp_plot.svg'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-get-expect" class="level3">
<h3 class="anchored" data-anchor-id="set-get-expect">Set, get, expect</h3>
<p>The process above is repeated with new values passed to <strong><code>app$set_inputs()</code></strong> and verified with <strong><code>app$get_values()</code></strong>:</p>
<ul>
<li>The <code>data-dataset</code>, <code>var-var</code>, and <code>hist-bins</code> are updated again with new values.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># verify usaarrests_plot ---- </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"USArrests"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'UrbanPop'</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The updated values are exported automatically with <code>exportTestValues()</code> and stored in <code>exp_values</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export values </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>exp_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()<span class="sc">$</span>export</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The new plot is verified again with <code>expect_doppelganger()</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>vdiffr<span class="sc">::</span><span class="fu">expect_doppelganger</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"usaarrests_plot"</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig =</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> exp_values<span class="sc">$</span>data,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> UrbanPop)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">paste0</span>(exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-title</span><span class="st">`</span>, </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">" [bins = "</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                         exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span>, <span class="st">"]"</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">names</span>(exp_values<span class="sc">$</span>x)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have a template, we can set, get, and expect multiple plot snapshots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SET -----</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">data-dataset</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"sleep"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">var-var</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'extra'</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  app<span class="sc">$</span><span class="fu">set_inputs</span>(<span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">8</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># GET ----</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  exp_values <span class="ot">&lt;-</span> app<span class="sc">$</span><span class="fu">get_values</span>()<span class="sc">$</span>export</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># EXPECT ----</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  vdiffr<span class="sc">::</span><span class="fu">expect_doppelganger</span>(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"sleep_extra_plot"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fig =</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> exp_values<span class="sc">$</span>data,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>            ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> extra)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span>) <span class="sc">+</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">paste0</span>(exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-title</span><span class="st">`</span>, </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>                           <span class="st">" [bins = "</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>                           exp_values<span class="sc">$</span><span class="st">`</span><span class="at">hist-bins</span><span class="st">`</span>, <span class="st">"]"</span>),</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="fu">names</span>(exp_values<span class="sc">$</span>x)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>()</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The initial run of this test will save the snapshot file to <code>tests/testthat/_snaps/</code>:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>tests/testthat/_snaps/</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  └── shinytest2-ggHistApp</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>      ├── mtcars-disp-plot.svg</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>      ├── sleep-extra-plot.svg</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>      └── usaarrests-plot.svg</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>2 directories, 3 files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<p>The final results of <code>devtools::test()</code> in <code>msst2ap</code> are below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>ℹ Testing msst2ap</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>Loading required package: shiny</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>✔ | F W  S  OK | Context</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>✔ |          3 | shinytest2-datasetApp [3.5s]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>✔ |         16 | shinytest2-ggHistApp [9.3s]</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>✔ |          5 | shinytest2-histogramApp [3.8s]</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>✔ |          4 | shinytest2-selectVarApp [2.5s]</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>══ Results ═══════════════════</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>Duration: 19.1 s</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>[ FAIL 0 | WARN 0 | SKIP 0 | PASS 28 ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="recap" class="level2">
<h2 class="anchored" data-anchor-id="recap">Recap</h2>
<p>This post has covered creating tests with <code>testthat</code> and <code>shinytest2</code> for an app-package containing a Shiny application. In general, <code>shinytest2</code> is designed for end-to-end testing of Shiny applications. System tests (or regression testing) can capture the state of a Shiny app (input, output, and exported values) during user interactions and compare them with a previous state (i.e., snapshots). As we can see, <code>shinytest2</code> makes it easier to test specific app behaviors and set expectations iteratively with the <code>AppDriver</code> makes.</p>
<p><code>shinytest2</code> tests can also simulate user interaction in a way that <code>testServer()</code> tests can’t, such as waiting for reactive outputs to update after the input changes, clicking on action buttons, etc. <code>shinytest2</code> can also be resource-intensive, so it’s recommended to write these tests after you’ve completed the standard <code>testthat</code> unit tests and <code>testServer()</code> tests.</p>
<p>Other things to consider when writing <code>shinytest2</code> tests include:</p>
<ol type="1">
<li><p><strong>Define What to Test</strong>: Since Shiny apps are interactive, so <code>shinytest2</code> tests should simulate user interaction as much as possible. The tests should focus on key user interactions and the output they should generate. <code>shinytest2</code> provides functions for simulating user clicks, inputs, and other interactions. Not every interaction needs to be tested, but crucial ones and those that handle complex logic should be.</p></li>
<li><p><strong>Organize Your Tests &amp; Use Descriptive Test Names</strong>: Organize your tests into separate files based on the app or feature they test. Each test should have a descriptive name that clarifies what the test is for. Organizing your test files with unambiguous names will make it easier to manage multiple tests, and it will make it easier to understand what’s going wrong when a test fails.</p></li>
<li><p><strong>Create snapshots for expected outputs</strong>: Use snapshot files to verify that an app’s output matches the expected results. <code>AppDriver$expect_values()</code> generates <code>.json</code> and <code>.png</code> snapshot files for the application. The .json file contains <code>input</code>, <code>output</code>, and <code>export</code> values, and the .png file is a <em>debug</em> screenshot, which records how the app looked when the values where captured. These files can then be compared to a baseline snapshot.</p></li>
<li><p><strong>Export app values</strong>: While snapshot files are great for detecting changes, it’s important to remember that “<em>differences in the captured screenshot will never cause test failures.</em>” Manually inspecting the snapshot .png files during test development can also be time-consuming and tedious. Wherever possible, export app values and compare them against expected reference values.</p></li>
</ol>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>“<em>In some cases, it’s useful to snapshot some bits of internal state of an application – state that’s not reflected directly in the inputs or outputs. This can be done by exporting values.</em>” - <a href="https://rstudio.github.io/shinytest2/articles/in-depth.html#exported-values"><code>shinytest2</code> documentation</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>“<em>It cannot be recommended enough to use <code>exportTestValues()</code> to test your Shiny app’s reactive values.</em>” - <a href="https://rstudio.github.io/shinytest2/articles/robust.html#exported-values"><code>shinytest2</code> documentation</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Read more about exporting test values <a href="https://shiny.posit.co/r/reference/shiny/1.0.2/exporttestvalues">here</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>This section replicates these <a href="https://rstudio.github.io/shinytest2/articles/robust.html#example">test examples from <code>shinytest2</code></a> using the <code>ggHistApp()</code>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>This version is loaded from a <code>inst/dev/histogramApp/R/modules.R</code> file.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>This version is loaded from a <code>inst/dev/histogramApp/R/app.R</code> file.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>