<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Frigaard">
<meta name="dcterms.date" content="2023-06-23">

<title>@mjfrigaard - Debugging shiny apps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<meta name="twitter:title" content="@mjfrigaard - Debugging shiny apps">
<meta name="twitter:description" content="Investigating shiny bugs using call stacks, browser(), and tests">
<meta name="twitter:image" content="https://mjfrigaard.github.io/posts/debugging-shiny/image.png">
<meta name="twitter:image-height" content="1604">
<meta name="twitter:image-width" content="1582">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"><span class="citation" data-cites="mjfrigaard">@mjfrigaard</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-blog" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Blog</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-blog">    
        <li>
    <a class="dropdown-item" href="../../posts.html" rel="" target="">
 <span class="dropdown-text">Posts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../series.html" rel="" target="">
 <span class="dropdown-text">Series</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mjfrigaard" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mjfrigaard" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Debugging shiny apps</h1>
            <p class="subtitle lead">Investigating shiny bugs using call stacks, browser(), and tests</p>
                                <div class="quarto-categories">
                <div class="quarto-category">code</div>
                <div class="quarto-category">debugging</div>
                <div class="quarto-category">shiny</div>
                <div class="quarto-category">testing</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Martin Frigaard </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 23, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#bugs" id="toc-bugs" class="nav-link active" data-scroll-target="#bugs">Bugs!</a></li>
  <li><a href="#testserver-app-package" id="toc-testserver-app-package" class="nav-link" data-scroll-target="#testserver-app-package"><code>testServer()</code> app-package</a></li>
  <li><a href="#modules" id="toc-modules" class="nav-link" data-scroll-target="#modules">Modules</a>
  <ul>
  <li><a href="#mod_pkg" id="toc-mod_pkg" class="nav-link" data-scroll-target="#mod_pkg"><code>mod_pkg</code></a></li>
  <li><a href="#mod_ds" id="toc-mod_ds" class="nav-link" data-scroll-target="#mod_ds"><code>mod_ds</code></a></li>
  <li><a href="#mod_cols" id="toc-mod_cols" class="nav-link" data-scroll-target="#mod_cols"><code>mod_cols</code></a></li>
  <li><a href="#mod_plot" id="toc-mod_plot" class="nav-link" data-scroll-target="#mod_plot"><code>mod_plot</code></a></li>
  </ul></li>
  <li><a href="#stack-trace" id="toc-stack-trace" class="nav-link" data-scroll-target="#stack-trace">Stack trace</a>
  <ul>
  <li><a href="#stack-traces-in-r" id="toc-stack-traces-in-r" class="nav-link" data-scroll-target="#stack-traces-in-r">Stack traces in R</a>
  <ul>
  <li><a href="#traceback" id="toc-traceback" class="nav-link" data-scroll-target="#traceback"><code>traceback()</code></a></li>
  <li><a href="#rlanglast_trace" id="toc-rlanglast_trace" class="nav-link" data-scroll-target="#rlanglast_trace"><code>rlang::last_trace()</code></a></li>
  </ul></li>
  <li><a href="#what-did-i-expect" id="toc-what-did-i-expect" class="nav-link" data-scroll-target="#what-did-i-expect">What did I expect?</a></li>
  <li><a href="#what-happened-instead" id="toc-what-happened-instead" class="nav-link" data-scroll-target="#what-happened-instead">What happened instead?</a>
  <ul>
  <li><a href="#check-and-re-check-function" id="toc-check-and-re-check-function" class="nav-link" data-scroll-target="#check-and-re-check-function">Check (and re-check) function</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#using-the-debugger" id="toc-using-the-debugger" class="nav-link" data-scroll-target="#using-the-debugger">Using the debugger</a>
  <ul>
  <li><a href="#inside-the-function" id="toc-inside-the-function" class="nav-link" data-scroll-target="#inside-the-function">Inside the function</a></li>
  <li><a href="#confirmation" id="toc-confirmation" class="nav-link" data-scroll-target="#confirmation">Confirmation!</a></li>
  </ul></li>
  <li><a href="#solution-1" id="toc-solution-1" class="nav-link" data-scroll-target="#solution-1">Solution 1</a></li>
  <li><a href="#solution-2" id="toc-solution-2" class="nav-link" data-scroll-target="#solution-2">Solution 2</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ALERT!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div style="font-size: 1.10em; font-weight: bold; color: #696969;">
<p>This post is currently under development–thank you for your patience.</p>
</div>
</div>
</div>
</div>
<p>This is the fourth post in a <a href="https://mjfrigaard.github.io/#category=testing">series on testing</a> shiny applications. I’ll cover using <code>rlang::trace_back()</code>, <code>browser()</code>, and unit/<code>testServer()</code> tests to debug <code>shiny</code> apps.</p>
<div class="cell">
<details open="">
<summary>show/hide packages</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsap) <span class="co"># app package </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins) <span class="co"># data</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES) <span class="co"># data</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># function</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang) <span class="co"># traceback/stack trace</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt) <span class="co"># tables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>

<div class="no-row-height column-margin column-container"><div class="">
<p><img src="shiny-test-bugs.png" class="img-fluid" style="width:70.0%"></p>
</div></div><section id="bugs" class="level2">
<h2 class="anchored" data-anchor-id="bugs">Bugs!</h2>
<p>In <a href="https://mjfrigaard.github.io/posts/test-shiny-p3/">a previous post</a>, I covered writing tests for module server functions in <a href="https://github.com/mjfrigaard/tsap"><code>tsap</code></a> (<em><code>testServer()</code> app-package</em>). I ended that post noting the bug below when running <code>pkgDataApp()</code>:</p>
<div id="fig-graph_error_gif_intro" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-graph_error_gif_intro" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graph_error.gif" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-graph_error_gif_intro"></p>
<figcaption class="figure-caption">(a) App <code>renderPlot()</code> error</figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;1: Shiny app displaying <code>Error in [[: Column 'race1' not found in '.data'</code></figcaption>
</figure>
</div>
<p>The warning resolves itself without causing the application to crash, but it’s displayed in the UI, so leaving it is not an option. In this post, I’m going to discuss using the stack trace and <code>browse()</code> to debug a shiny app-package.</p>
</section>
<section id="testserver-app-package" class="level2">
<h2 class="anchored" data-anchor-id="testserver-app-package"><code>testServer()</code> app-package</h2>
<p>If you’d like to follow along, you can download <code>tsap</code> <a href="https://github.com/mjfrigaard/tsap/archive/refs/heads/main.zip">here</a> or install it using the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"mjfrigaard/tsap"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">force =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’ll quickly review the contents of <code>tsap</code>. The <a href="https://github.com/mjfrigaard/tsap/tree/main/R"><code>R/</code> folder</a> contains files for the modules:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>R/</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>├── mod_cols.R</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>├── mod_ds.R</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>├── mod_pkg.R</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>└── mod_plot.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Each module file has it’s own utility function file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>R/</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>├── utils_vars.R</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>├── utils_datasets.R</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>├── utils_pkg.R</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>└── utils_scatter.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p>The module functions are split between the <code>appUI()</code> and <code>appServer()</code> functions.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>R/</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>├── appServer.R # &lt;- _server() module functions</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>├── appUI.R # &lt;- _ui() module functions</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>└── pkgDataApp.R # &lt;- standalone app function</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><code>pkgDataApp()</code> is a stand-alone app function, which calls <code>appUI()</code> and <code>appServer()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pkgDataApp &lt;- function() {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    shiny::shinyApp(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      ui = appUI,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      server = appServer)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>pkgDataApp()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
<p>Each of the modules have tests in the <code>tests/testthat/</code> folder:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tests/testthat/</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>├── test-mod_cols_server.R</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>├── test-mod_ds_server.R</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>├── test-mod_pkg_server.R</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>└── test-mod_plot_server.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>As do the module utility functions:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tests/testthat</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>├── test-check_binary_vec.R</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>├── test-check_facet_vec.R</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>├── test-get_col_types.R</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>├── test-make_binary_vec.R</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>├── test-make_facet_vec.R</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>├── test-pull_binary_cols.R</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>├── test-pull_cat_cols.R</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>├── test-pull_facet_cols.R</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>└── test-pull_numeric_cols.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="modules" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="modules">Modules</h2>
<p>I’ve created the figure below to illustrate how the modules in <code>pkgDataApp()</code> work together:</p>
<div class="column-page-inset-right">
<div id="fig-module_flow" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-module_flow" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="module_flow.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-module_flow"></p>
<figcaption class="figure-caption">(a) <code>tsap</code> modules</figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;2: Modules in <code>tsap::pkgDataApp()</code></figcaption>
</figure>
</div>
</div>
<p>As you can see, the modules are connected by a chain of reactive values, and each module returns a slightly more complicated reactive value (<code>character</code> -&gt; <code>data.frame</code>/<code>tibble</code> -&gt; <code>list</code> ).</p>
<section id="mod_pkg" class="level3">
<h3 class="anchored" data-anchor-id="mod_pkg"><code>mod_pkg</code></h3>
<ol type="1">
<li>The <code>mod_pkg</code> module displays the packages with <code>data.frame</code>s or <code>tibble</code>s (and returns the package as a reactive character string, <code>pkg()</code>)</li>
</ol>
<div id="fig-mod_pkg_schema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-mod_pkg_schema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mod_pkg_schema.png" class="img-fluid figure-img" style="width:70.0%" data-ref-parent="fig-mod_pkg_schema"></p>
<figcaption class="figure-caption">(a) <code>mod_pkg</code></figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;3: <code>mod_pkg</code> in <code>pkgDataApp()</code></figcaption>
</figure>
</div>
</section>
<section id="mod_ds" class="level3">
<h3 class="anchored" data-anchor-id="mod_ds"><code>mod_ds</code></h3>
<ol start="2" type="1">
<li><code>mod_ds</code> renames <code>pkg()</code> as <code>pkg_input()</code> and uses it to update the <code>selectInput()</code> options for the selected package datasets (the selected dataset is returned as a reactive <code>dataset()</code>)</li>
</ol>
<div id="fig-mod_ds_schema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-mod_ds_schema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mod_ds_schema.png" class="img-fluid figure-img" style="width:70.0%" data-ref-parent="fig-mod_ds_schema"></p>
<figcaption class="figure-caption">(a) <code>mod_ds</code></figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;4: <code>mod_pkg</code> and <code>mod_ds</code> in <code>pkgDataApp()</code></figcaption>
</figure>
</div>
</section>
<section id="mod_cols" class="level3">
<h3 class="anchored" data-anchor-id="mod_cols"><code>mod_cols</code></h3>
<ol start="3" type="1">
<li><code>mod_cols</code> receives <code>dataset()</code> as <code>ds_input()</code> and updates the <code>selectInput()</code>s with the columns in the <code>ds_input()</code>. Columns are displayed by ‘type’ (i.e., two numeric columns (<code>x</code> and <code>y</code>), binary columns (<code>color</code>), and a <code>facet</code> column. Then <code>ds_input()</code>, the selected columns (<code>x</code>, <code>y</code>, <code>color</code> and <code>facet</code>) and graph aesthetics (<code>size</code> and <code>alpha</code>) are combined and returned as the reactive list <code>plot_values()</code></li>
</ol>
<div id="fig-mod_cols_schema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-mod_cols_schema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mod_cols_schema.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-mod_cols_schema"></p>
<figcaption class="figure-caption">(a) <code>mod_cols</code></figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;5: <code>mod_pkg</code>, <code>mod_ds</code>, and <code>mod_cols</code> in <code>pkgDataApp()</code></figcaption>
</figure>
</div>
</section>
<section id="mod_plot" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="mod_plot"><code>mod_plot</code></h3>
<ol start="4" type="1">
<li><code>mod_plot</code> uses <code>plot_values()</code> as <code>plot_inputs()</code> and a custom <code>ggplot2</code> utility function (<code>gg_color_scatter_facet()</code>) to render the plot</li>
</ol>
<div class="column-body-outset-right">
<div id="fig-mod_plot_schema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-mod_plot_schema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mod_plot_schema.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-mod_plot_schema"></p>
<figcaption class="figure-caption">(a) <code>mod_plot</code> in <code>tsap::pkgDataApp()</code></figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;6: <code>mod_pkg</code>,<code>mod_ds</code>, <code>mod_cols</code>, and <code>mod_plot</code> modules in <code>pkgDataApp()</code></figcaption>
</figure>
</div>
</div>
<p>The <code>ggplot2</code> function used to generate the plot (<code>gg_color_scatter_facet()</code>) is below:</p>
<div class="cell">
<details>
<summary>gg_color_scatter_facet()</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>gg_color_scatter_facet <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x_var, y_var,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">col_var =</span> <span class="cn">NULL</span>, <span class="at">facet_var =</span> <span class="cn">NULL</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                                ...) {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># missing both color and facet vars</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(col_var) <span class="sc">&amp;</span> <span class="fu">is.null</span>(facet_var)) {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> df,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> .data[[x_var]], </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> .data[[y_var]])</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(...) <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add labels</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">make_x_y_title</span>(</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> x_var, <span class="at">y =</span> y_var),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(x_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(y_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no facet, but has color</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(col_var) <span class="sc">&amp;</span> <span class="fu">is.null</span>(facet_var)) {</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> df,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> .data[[x_var]], </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> .data[[y_var]])</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add ... for alpha and size passed to points</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> .data[[col_var]], </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">group =</span> .data[[col_var]]),</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>            ...</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add labels</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">make_x_y_color_title</span>(</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> x_var, <span class="at">y =</span> y_var, <span class="at">color =</span> col_var),</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(x_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(y_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(col_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no color, but has facet</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.null</span>(col_var) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(facet_var)) {</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> df,</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> .data[[x_var]], </span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> .data[[y_var]])</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add ... for alpha and size passed to points</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(...) <span class="sc">+</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add facet layer</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[facet_var]])) <span class="sc">+</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add labels</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="fu">make_x_y_title</span>(</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> x_var, <span class="at">y =</span> y_var),</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(x_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(y_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>      <span class="co"># has both color and facet vars</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> df,</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> .data[[x_var]],</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> .data[[y_var]])</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>        <span class="co"># points layer</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add ... for alpha and size passed to points</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> .data[[col_var]],</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>            <span class="at">group =</span> .data[[col_var]]), ...</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add facet layer</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[facet_var]])) <span class="sc">+</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add labels</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>            <span class="fu">make_x_y_col_facet_title</span>(<span class="at">x =</span> x_var,</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">y =</span> y_var,</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">color =</span> col_var,</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">facets =</span> facet_var),</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(x_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(y_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(col_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>          <span class="at">group =</span> stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>            snakecase<span class="sc">::</span><span class="fu">to_title_case</span>(facet_var), <span class="st">"_"</span>, <span class="st">" "</span></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="stack-trace" class="level2">
<h2 class="anchored" data-anchor-id="stack-trace">Stack trace</h2>
<p>During development, the warning below is printed to the <strong>Console</strong> when I change the package input of <code>tsap::pkgDataApp()</code>:</p>
<div style="font-size: 1.10em; font-weight: bold;">
<p><code># Warning: Error in [[: Column 'race1' not found in '.data'.</code></p>
</div>
<p>Below the warning, the <strong>Console</strong> also prints the following abbreviated numbered list of items:</p>
<div style="font-size: 0.90em;">
<div class="sourceCode" id="cb10"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Warning: Error in [[: Column `race1` not found in `.data`.</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  202: &lt;Anonymous&gt;</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  201: signalCondition</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  200: signal_abort</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  199: abort</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  198: abort_data_pronoun</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  197: data_pronoun_get</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  196: [[.rlang_data_pronoun</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  195: [[</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  194: eval_tidy</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  189: FUN</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  188: lapply</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  185: FUN</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  184: lapply</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  181: combine_vars</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  180: compute_layout</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  179: self$facet$compute_layout</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  178: setup</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  177: layout$setup</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  176: ggplot_build.ggplot</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  174: print.ggplot</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  169: func</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  167: f</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  166: Reduce</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  157: do</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  156: hybrid_chain</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  128: drawPlot</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  114: &lt;reactive:plotObj&gt;</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>   98: drawReactive</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>   85: renderFunc</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>   84: output$plot-graph</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    3: runApp</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    2: print.shiny.appobj</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    1: &lt;Anonymous&gt;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output above is referred to as a <a href="https://en.wikipedia.org/wiki/Stack_trace?oldformat=true">stack trace (or traceback)</a>, which is a report that provides information about a function call (or sequence of calls) at a certain point. The numbered items are ‘frames’, and collectively they’re referred to as the <a href="https://en.wikipedia.org/wiki/Call_stack">‘call stack’ or ‘stack frame’</a>.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stack traces in shiny
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Believe it or not, the output shown above actually isn’t the <em>full</em> stack trace for the error–<code>shiny</code> performs some post-processing to trim it down. If you’d like to view the full stack trace for the warning, try setting <code>options(shiny.fullstacktrace = TRUE)</code> before running your application.</p>
</div>
</div>
</div>
<p>A stack trace is usually generated when an error occurs, and it gives developers a snapshot of the function calls preceding the error.</p>
<section id="stack-traces-in-r" class="level3">
<h3 class="anchored" data-anchor-id="stack-traces-in-r">Stack traces in R</h3>
<p>The output above is automatically returned to the <strong>Console</strong> while if you’re developing a shiny app in RStudio, but I’ll cover two methods for manually creating a stack trace from an error.</p>
<section id="traceback" class="level4">
<h4 class="anchored" data-anchor-id="traceback"><code>traceback()</code></h4>
<p>In base R, you can generate a stack trace by calling the <code>traceback()</code> function directly following the error.</p>
<p>I’ll use <code>gg_color_scatter_facet()</code> in the code chunk below, but I’ve written it to reproduce the error I’m seeing above (i.e., the variable arguments are from the <code>NHANES::NHANES</code> data, but the <code>df</code> argument has been changed to <code>palmerpenguins::penguins</code>).</p>
<p>I’ll pass the <code>gg_color_scatter_facet()</code> call in to the <strong>Console:</strong></p>
<div class="cell">
<details open="">
<summary>ggplot2 error with traceback()</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tsap<span class="sc">::</span><span class="fu">gg_color_scatter_facet</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(palmerpenguins<span class="sc">::</span>penguins),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_var =</span> <span class="st">"poverty"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_var =</span> <span class="st">"weight"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_var =</span> <span class="st">"survey_yr"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">facet_var =</span> <span class="st">"race1"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in `.data[["race1"]]`:</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ! Column `race1` not found in `.data`.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After the error, I call <code>traceback()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">traceback</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output from <code>traceback()</code> is below:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="">
<summary>show/hide traceback() output</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">29:</span> stop<span class="er">(</span><span class="ex">fallback</span><span class="kw">)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">28:</span> signal_abort<span class="er">(</span><span class="ex">cnd,</span> .file<span class="kw">)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">27:</span> abort<span class="er">(</span><span class="ex">msg,</span> <span class="st">"rlang_error_data_pronoun_not_found"</span>, call = call<span class="kw">)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="ex">26:</span> abort_data_pronoun<span class="er">(</span><span class="ex">x,</span> call = y<span class="kw">)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">25:</span> data_pronoun_get<span class="er">(</span><span class="ex">x,</span> i, call = I<span class="er">(</span><span class="ex">call</span><span class="er">(</span><span class="st">"[["</span><span class="ex">,</span> quote<span class="er">(</span><span class="ex">.data</span><span class="kw">)</span><span class="ex">,</span> substitute<span class="er">(</span><span class="ex">i</span><span class="kw">))))</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="ex">24:</span> <span class="kw">`</span><span class="ex">[[.rlang_data_pronoun</span><span class="kw">`</span><span class="er">(</span><span class="ex">.data,</span> <span class="st">"race1"</span><span class="kw">)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="ex">23:</span> .data[<span class="pp">[</span><span class="st">"race1"</span><span class="pp">]</span>]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">22:</span> eval_tidy<span class="er">(</span><span class="ex">facet,</span> mask<span class="kw">)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="ex">21:</span> doTryCatch<span class="er">(</span><span class="cf">return</span><span class="kw">(</span><span class="fu">expr</span><span class="kw">)</span><span class="ex">,</span> name, parentenv, handler<span class="kw">)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="ex">20:</span> tryCatchOne<span class="er">(</span><span class="fu">expr</span>, names, parentenv, handlers[<span class="pp">[</span><span class="ss">1L</span><span class="pp">]</span>]<span class="kw">)</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">19:</span> tryCatchList<span class="er">(</span><span class="fu">expr</span>, classes, parentenv, handlers<span class="kw">)</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="ex">18:</span> tryCatch<span class="er">(</span><span class="ex">eval_tidy</span><span class="er">(</span><span class="ex">facet,</span> mask<span class="kw">)</span><span class="ex">,</span> ggplot2_missing_facet_var = function<span class="er">(</span><span class="ex">e</span><span class="kw">)</span> <span class="ex">NULL</span><span class="kw">)</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="ex">17:</span> FUN<span class="er">(</span><span class="va">X</span><span class="op">[</span>[i<span class="op">]</span><span class="ex">],</span> ...<span class="kw">)</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="ex">16:</span> lapply<span class="er">(</span><span class="ex">facets,</span> eval_facet, data, possible_columns = possible_columns<span class="kw">)</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="ex">15:</span> vapply<span class="er">(</span><span class="ex">x,</span> is.null, logical<span class="er">(</span><span class="ex">1</span><span class="kw">))</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="ex">14:</span> compact<span class="er">(</span><span class="ex">lapply</span><span class="er">(</span><span class="ex">facets,</span> eval_facet, data, possible_columns = possible_columns<span class="kw">))</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="ex">13:</span> FUN<span class="er">(</span><span class="va">X</span><span class="op">[</span>[i<span class="op">]</span><span class="ex">],</span> ...<span class="kw">)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="ex">12:</span> lapply<span class="er">(</span><span class="ex">data,</span> eval_facets, facets = vars, possible_columns = possible_columns<span class="kw">)</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="ex">11:</span> vapply<span class="er">(</span><span class="ex">x,</span> is.null, logical<span class="er">(</span><span class="ex">1</span><span class="kw">))</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="ex">10:</span> compact<span class="er">(</span><span class="ex">lapply</span><span class="er">(</span><span class="ex">data,</span> eval_facets, facets = vars, possible_columns = possible_columns<span class="kw">))</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="ex">9:</span> combine_vars<span class="er">(</span><span class="ex">data,</span> params<span class="va">$plot_env</span>, vars, drop = params<span class="va">$drop</span><span class="kw">)</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="ex">8:</span> compute_layout<span class="er">(</span><span class="ex">...,</span> self = self<span class="kw">)</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="ex">7:</span> self<span class="va">$facet$compute_layout</span><span class="er">(</span><span class="ex">data,</span> self<span class="va">$facet_params</span><span class="kw">)</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="ex">6:</span> setup<span class="er">(</span><span class="ex">...,</span> self = self<span class="kw">)</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="ex">5:</span> layout<span class="va">$setup</span><span class="er">(</span><span class="ex">data,</span> plot<span class="va">$data</span>, plot<span class="va">$plot_env</span><span class="kw">)</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="ex">4:</span> ggplot_build.ggplot<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="ex">3:</span> ggplot_build<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="ex">2:</span> print.ggplot<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="ex">1:</span> <span class="er">(</span><span class="kw">function</span> <span class="kw">(</span><span class="ex">x,</span> ...<span class="kw">)</span> </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>   <span class="ex">UseMethod</span><span class="er">(</span><span class="st">"print"</span><span class="kw">))(</span><span class="ex">x</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>The output from <code>traceback()</code> is a <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html#Pairlist-objects">pairlist</a>, and it contains the “<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/traceback.html">stack of the last uncaught errors</a>.”</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Adding <code>traceback()</code> to <code>.Rprofile</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you’d like to view the <code>traceback()</code> output whenever an error occurs, you can add the following to your <code>.Rprofile</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">error =</span> traceback)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read more debugging tips in the <a href="https://support.posit.co/hc/en-us/articles/200713843#using-the-debugger">Posit support documentation</a>.</p>
</div>
</div>
</div>
<p>If the output from <code>traceback()</code> is too large to read in the <strong>Console</strong>, I’ll store it and use <code>grep()</code> or <a href="https://stringr.tidyverse.org/"><code>stringr::str_view_all()</code></a> to explore its contents:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>bug <span class="ot">&lt;-</span> <span class="fu">traceback</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below I’ll narrow the stack trace down to the terms I see in the UI (like <code>.data</code> and <code>race1</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>stringr<span class="sc">::</span><span class="fu">str_view_all</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> <span class="fu">unlist</span>(bug), </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.data|race1"</span>, </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [5] │ data_pronoun_get(x, i, call = I(call("[[", quote(&lt;.data&gt;), substitute(i))))</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [6] │ `[[.rlang_data_pronoun`(&lt;.data&gt;, "&lt;race1&gt;")</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [7] │ &lt;.data&gt;[["&lt;race1&gt;"]]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rlanglast_trace" class="level4">
<h4 class="anchored" data-anchor-id="rlanglast_trace"><code>rlang::last_trace()</code></h4>
<p>When I entered the previous call to <code>gg_color_scatter_facet()</code> in the <strong>Console</strong>, there was a suggestion to run <code>rlang::last_trace()</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Run `rlang::last_trace()` to see where the error occurred.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>last_trace()</code> is similar to <code>traceback()</code>, but prints the stack trace in a hierarchical tree structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">last_trace</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="">
<summary>show/hide rlang::last_trace() output</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>error/rlang_error_data_pronoun_not_found<span class="op">&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span> in <span class="kw">`</span><span class="ex">.data[[</span><span class="st">"race1"</span><span class="ex">]]</span><span class="kw">`</span>:</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ot">! </span><span class="ex">Column</span> <span class="kw">`</span><span class="ex">race1</span><span class="kw">`</span> not found in <span class="kw">`</span><span class="ex">.data</span><span class="kw">`</span>.</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Backtrace:</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>     <span class="ex">▆</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">1.</span> ├─base <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="kw">`</span><span class="op">&lt;</span>fn<span class="op">&gt;</span><span class="kw">`</span><span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">2.</span> ├─ggplot2:::print.ggplot<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">3.</span> │ ├─ggplot2::ggplot_build<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">4.</span> │ └─ggplot2:::ggplot_build.ggplot<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">5.</span> │   └─layout<span class="va">$setup</span><span class="er">(</span><span class="ex">data,</span> plot<span class="va">$data</span>, plot<span class="va">$plot_env</span><span class="kw">)</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">6.</span> │     └─ggplot2 <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="ex">setup</span><span class="er">(</span><span class="ex">...,</span> self = self<span class="kw">)</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">7.</span> │       └─self<span class="va">$facet$compute_layout</span><span class="er">(</span><span class="ex">data,</span> self<span class="va">$facet_params</span><span class="kw">)</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="ex">8.</span> │         └─ggplot2 <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="ex">compute_layout</span><span class="er">(</span><span class="ex">...,</span> self = self<span class="kw">)</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="ex">9.</span> │           └─ggplot2::combine_vars<span class="er">(</span><span class="ex">data,</span> params<span class="va">$plot_env</span>, vars, drop = params<span class="va">$drop</span><span class="kw">)</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a> <span class="ex">10.</span> │             ├─ggplot2:::compact<span class="er">(</span><span class="ex">lapply</span><span class="er">(</span><span class="ex">data,</span> eval_facets, facets = vars, possible_columns = possible_columns<span class="kw">))</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a> <span class="ex">11.</span> │             │ └─base::vapply<span class="er">(</span><span class="ex">x,</span> is.null, logical<span class="er">(</span><span class="ex">1</span><span class="kw">))</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a> <span class="ex">12.</span> │             └─base::lapply<span class="er">(</span><span class="ex">data,</span> eval_facets, facets = vars, possible_columns = possible_columns<span class="kw">)</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a> <span class="ex">13.</span> │               └─ggplot2 <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="ex">FUN</span><span class="er">(</span><span class="va">X</span><span class="op">[</span>[i<span class="op">]</span><span class="ex">],</span> ...<span class="kw">)</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a> <span class="ex">14.</span> │                 ├─ggplot2:::compact<span class="er">(</span><span class="ex">lapply</span><span class="er">(</span><span class="ex">facets,</span> eval_facet, data, possible_columns = possible_columns<span class="kw">))</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a> <span class="ex">15.</span> │                 │ └─base::vapply<span class="er">(</span><span class="ex">x,</span> is.null, logical<span class="er">(</span><span class="ex">1</span><span class="kw">))</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a> <span class="ex">16.</span> │                 └─base::lapply<span class="er">(</span><span class="ex">facets,</span> eval_facet, data, possible_columns = possible_columns<span class="kw">)</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a> <span class="ex">17.</span> │                   └─ggplot2 <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="ex">FUN</span><span class="er">(</span><span class="va">X</span><span class="op">[</span>[i<span class="op">]</span><span class="ex">],</span> ...<span class="kw">)</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a> <span class="ex">18.</span> │                     ├─base::tryCatch<span class="er">(</span><span class="ex">eval_tidy</span><span class="er">(</span><span class="ex">facet,</span> mask<span class="kw">)</span><span class="ex">,</span> ggplot2_missing_facet_var = function<span class="er">(</span><span class="ex">e</span><span class="kw">)</span> <span class="ex">NULL</span><span class="kw">)</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a> <span class="ex">19.</span> │                     │ └─base <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="ex">tryCatchList</span><span class="er">(</span><span class="fu">expr</span>, classes, parentenv, handlers<span class="kw">)</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a> <span class="ex">20.</span> │                     │   └─base <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="ex">tryCatchOne</span><span class="er">(</span><span class="fu">expr</span>, names, parentenv, handlers[<span class="pp">[</span><span class="ss">1L</span><span class="pp">]</span>]<span class="kw">)</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a> <span class="ex">21.</span> │                     │     └─base <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="ex">doTryCatch</span><span class="er">(</span><span class="cf">return</span><span class="kw">(</span><span class="fu">expr</span><span class="kw">)</span><span class="ex">,</span> name, parentenv, handler<span class="kw">)</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a> <span class="ex">22.</span> │                     └─rlang::eval_tidy<span class="er">(</span><span class="ex">facet,</span> mask<span class="kw">)</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a> <span class="ex">23.</span> ├─race1</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a> <span class="ex">24.</span> ├─rlang:::<span class="kw">`</span><span class="ex">[[.rlang_data_pronoun</span><span class="kw">`</span><span class="er">(</span><span class="ex">.data,</span> <span class="st">"race1"</span><span class="kw">)</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a> <span class="ex">25.</span> │ └─rlang:::data_pronoun_get<span class="er">(</span><span class="ex">...</span><span class="kw">)</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a> <span class="ex">26.</span> └─rlang:::abort_data_pronoun<span class="er">(</span><span class="ex">x,</span> call = y<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Both <code>traceback()</code> and <code>last_trace()</code> print each preceding function call before the error. I prefer using <code>rlang::last_trace()</code> because I find the tree output to be easier to read. However, I usually follow the second piece of advice from the <strong>Console</strong> output and set <code>drop</code> to <code>FALSE</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Run rlang::last_trace(drop = FALSE) to see 1 hidden frame.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, <code>last_trace()</code> will <code>drop</code> technical function calls, but I like to see <em>all</em> of the calls in a stack trace, so I usually change <code>drop</code> to <code>FALSE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">last_trace</span>(<span class="at">drop =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After changing <code>drop</code> to <code>FALSE</code> I can see one additional frame in the stack (I’ve omitted frames <code>1.</code> through <code>22.</code>, but you can see frame <code>27.</code> has been added below).</p>
<div style="font-size: 0.90em;">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>error/rlang_error_data_pronoun_not_found<span class="op">&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span> in <span class="kw">`</span><span class="ex">.data[[</span><span class="st">"race1"</span><span class="ex">]]</span><span class="kw">`</span>:</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ot">! </span><span class="ex">Column</span> <span class="kw">`</span><span class="ex">race1</span><span class="kw">`</span> not found in <span class="kw">`</span><span class="ex">.data</span><span class="kw">`</span>.</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Backtrace:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>     <span class="ex">▆</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">23.</span> ├─race1</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a> <span class="ex">24.</span> ├─rlang:::<span class="kw">`</span><span class="ex">[[.rlang_data_pronoun</span><span class="kw">`</span><span class="er">(</span><span class="ex">.data,</span> <span class="st">"race1"</span><span class="kw">)</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a> <span class="ex">25.</span> │ └─rlang:::data_pronoun_get<span class="er">(</span><span class="ex">...</span><span class="kw">)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">26.</span> └─rlang:::abort_data_pronoun<span class="er">(</span><span class="ex">x,</span> call = y<span class="kw">)</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a> <span class="ex">27.</span>   └─rlang::abort<span class="er">(</span><span class="ex">msg,</span> <span class="st">"rlang_error_data_pronoun_not_found"</span>, call = call<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="what-did-i-expect" class="level3">
<h3 class="anchored" data-anchor-id="what-did-i-expect">What did I expect?</h3>
<p>I generally try to write code that executes without errors, so the output from <code>traceback()</code> or <code>last_trace()</code> is always a little bewildering. I never know <em>exactly</em> what I’m looking for in the stack trace (if so, I would’ve written the code to avoid encountering it), but I like to start with a clear understanding of the behavior I’m expecting the function to perform.</p>
<p>In this case, I’m expecting the data (in <code>mod_ds</code>) and columns (in <code>mod_cols</code>) to update in <code>plot_values()</code> when I change the package input to <code>palmerpenguins</code>:</p>
<div id="fig-mods_pkg_ds_cols" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-mods_pkg_ds_cols" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mods_pkg_ds_cols.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-mods_pkg_ds_cols"></p>
<figcaption class="figure-caption">(a) Changes to package, data and columns</figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;7: Updating package input, data, and columns</figcaption>
</figure>
</div>
<p>The updated <code>plot_values()</code> reactive list is passed to the <code>plot_inputs</code> argument <code>mod_plot</code> (where the graph is rendered).</p>
<p>I’ve included the call to <code>renderPlot()</code> with <code>gg_color_scatter_facet()</code> in the code block below for reference:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a> output<span class="sc">$</span>graph <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPlot</span>({</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gg_color_scatter_facet</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">df =</span> <span class="fu">plot_inputs</span>()<span class="sc">$</span>df,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x_var =</span> <span class="fu">plot_inputs</span>()<span class="sc">$</span>x_var,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y_var =</span> <span class="fu">plot_inputs</span>()<span class="sc">$</span>y_var,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_var =</span> <span class="fu">plot_inputs</span>()<span class="sc">$</span>col_var,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">facet_var =</span> <span class="fu">plot_inputs</span>()<span class="sc">$</span>facet_var,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">alpha =</span> <span class="fu">plot_inputs</span>()<span class="sc">$</span>alpha,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fu">plot_inputs</span>()<span class="sc">$</span>size)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>   })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-happened-instead" class="level3">
<h3 class="anchored" data-anchor-id="what-happened-instead">What happened instead?</h3>
<p>The error I’m seeing is telling me there is something wrong with the facet variable in <code>mod_plot</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="st">`</span><span class="at">.data[["race1"]]</span><span class="st">`</span><span class="sc">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span> Column <span class="st">`</span><span class="at">race1</span><span class="st">`</span> not found <span class="cf">in</span> <span class="st">`</span><span class="at">.data</span><span class="st">`</span>.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>race1</code> is the facet variable from the <code>NHANES</code> data, so I am assuming the <code>plot_inputs()</code> list isn’t updating when I change <code>input$pkg</code> in <code>mod_pkg</code> to <code>palmerpenguins</code>.</p>
<div id="fig-default_nhanes_vars" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-default_nhanes_vars" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="default_nhanes_vars.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-default_nhanes_vars"></p>
<figcaption class="figure-caption">(a) Default <code>NHANES::NHANES</code> data and columns</figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;8: <code>pkgDataApp()</code> automatically loads with <code>NHANES::NHANES</code></figcaption>
</figure>
</div>
<p>the <code>plot_values()</code> list would contain the updated <code>penguins</code> data (from <code>mod_ds</code>), and the <code>penguins</code> columns (from <code>mod_cols</code>).</p>
<p>If the <code>penguins</code> data is updated in <code>plot_values()</code> <em>before</em> the columns and graph aesthetics, then why is the facet variable causing the error?</p>
<div id="fig-mods_pkg_ds_cols_warn_plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-mods_pkg_ds_cols_warn_plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mods_pkg_ds_cols_warn_plot.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-mods_pkg_ds_cols_warn_plot"></p>
<figcaption class="figure-caption">(a) Possible location of bug in <code>pkgDataApp()</code></figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;9: Location of bug in <code>pkgDataApp()</code>?</figcaption>
</figure>
</div>
<p>There are hints to what is causing the warning/error in the call stack. Frame <code>1.</code> through <code>.6</code> of show the initialization of the <code>ggplot2</code> graph, but frame <code>.7</code> references the facet layout:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Backtrace:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>     <span class="ex">▆</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">1.</span> ├─base <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="kw">`</span><span class="op">&lt;</span>fn<span class="op">&gt;</span><span class="kw">`</span><span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">2.</span> ├─ggplot2:::print.ggplot<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">3.</span> │ ├─ggplot2::ggplot_build<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">4.</span> │ └─ggplot2:::ggplot_build.ggplot<span class="er">(</span><span class="ex">x</span><span class="kw">)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">5.</span> │   └─layout<span class="va">$setup</span><span class="er">(</span><span class="ex">data,</span> plot<span class="va">$data</span>, plot<span class="va">$plot_env</span><span class="kw">)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">6.</span> │     └─ggplot2 <span class="er">(</span><span class="bu">local</span><span class="kw">)</span> <span class="ex">setup</span><span class="er">(</span><span class="ex">...,</span> self = self<span class="kw">)</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">7.</span> │       └─self<span class="va">$facet$compute_layout</span><span class="er">(</span><span class="ex">data,</span> self<span class="va">$facet_params</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Frame <code>.7</code> is a hint because it tells me where/when the facet layer is referenced in the call stack.</p>
<p>If I look down to frame <code>23.</code>, I see <code>race1</code> (the facet variable) and the data masking method used to find the facet variable in the custom <code>ggplot2</code> function (<code>.data[[facet_var]]</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Backtrace:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>     <span class="ex">▆</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">22.</span> │                     └─rlang::eval_tidy<span class="er">(</span><span class="ex">facet,</span> mask<span class="kw">)</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">23.</span> ├─race1</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">24.</span> ├─rlang:::<span class="kw">`</span><span class="ex">[[.rlang_data_pronoun</span><span class="kw">`</span><span class="er">(</span><span class="ex">.data,</span> <span class="st">"race1"</span><span class="kw">)</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">25.</span> │ └─rlang:::data_pronoun_get<span class="er">(</span><span class="ex">...</span><span class="kw">)</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a> <span class="ex">26.</span> └─rlang:::abort_data_pronoun<span class="er">(</span><span class="ex">x,</span> call = y<span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The stack ends in a call to <code>rlang::abort_data_pronoun()</code> (because <code>race1</code> isn’t in <code>.data</code>).</p>
<section id="check-and-re-check-function" class="level4">
<h4 class="anchored" data-anchor-id="check-and-re-check-function">Check (and re-check) function</h4>
<p>The order of the frames in the stack trace is counter-intuitive, because the facet variable (<code>.data[[facet_var]]</code>) is added to the <code>ggplot2</code> graph <em>after</em> the x, y, and color variables (<em>I’ve included this portion of <code>gg_color_scatter_facet()</code> below</em>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># has both color and facet vars</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> df,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> .data[[x_var]],</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> .data[[y_var]])</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># points layer</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add ... for alpha and size passed to points</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>          ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">colour =</span> .data[[col_var]],</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">group =</span> .data[[col_var]]), ...</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add facet layer</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(ggplot2<span class="sc">::</span><span class="fu">vars</span>(.data[[facet_var]])) <span class="sc">+</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add labels </span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>The <code>x</code> and <code>y</code> are in the initial <code>aes()</code> layer<br>
</li>
<li>The <code>colour</code> layer is added with the <code>geom_point()</code><br>
</li>
<li>Finally, the facet variable is added in the <code>facet_wrap()</code> layer</li>
</ol>
<p>When I change the package input in <code>mod_pkg</code>, I’m assuming the <code>plot_values()</code> list is updated with the <code>penguins</code> data, followed by the column arguments from <code>mod_cols</code>.</p>
<p>But the column values are still from the <code>NHANES</code> data, which is triggering the warning. The warning/error is eventually resolved when the <code>penguins</code> column inputs make their way from <code>mod_cols</code> to <code>mod_plot</code> (where the plot is rendered).</p>
</section>
</section>
</section>
<section id="using-the-debugger" class="level2">
<h2 class="anchored" data-anchor-id="using-the-debugger">Using the debugger</h2>
<p>Now I’m ready to experiment with <code>plot_values</code> and <code>gg_color_scatter_facet()</code> in the debugger:</p>
<ol type="1">
<li><p>Below I’ve create <code>plot_values_test</code>, with <code>penguins</code> assigned to <code>df</code>, and the <code>NHANES</code> columns assigned to the column arguments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>plot_values_test <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data from palmerpenguins::penguins</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(palmerpenguins<span class="sc">::</span>penguins),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># columns from NHANES::NHANES</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_var =</span> <span class="st">"poverty"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_var =</span> <span class="st">"weight"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_var =</span> <span class="st">"survey_yr"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">facet_var =</span> <span class="st">"race1"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> 2L,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.75</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>I’ll pass the <code>plot_values_test</code> list to the <code>gg_color_scatter_facet()</code> function, but with a call to <code>browser()</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"~/tsap/R/utils_scatter.R"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>Called from<span class="sc">:</span> <span class="fu">gg_color_scatter_facet</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> plot_values_test<span class="sc">$</span>df, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_var =</span> plot_values_test<span class="sc">$</span>x_var, </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_var =</span> plot_values_test<span class="sc">$</span>y_var, </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_var =</span> plot_values_test<span class="sc">$</span>col_var, </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">facet_var =</span> plot_values_test<span class="sc">$</span>facet_var, </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> plot_values_test<span class="sc">$</span>alpha, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> plot_values_test<span class="sc">$</span>size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ol>
<section id="inside-the-function" class="level3">
<h3 class="anchored" data-anchor-id="inside-the-function">Inside the function</h3>
<p>The first few steps take me through the control flow in <code>gg_color_scatter_facet()</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># are both col_var and facet_var NULL?</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> n</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>debug at <span class="sc">~</span><span class="er">/</span>tsap<span class="sc">/</span>R<span class="sc">/</span>utils_scatter.R<span class="co">#452: if (is.null(col_var) &amp; is.null(facet_var)) {</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># facet_var NULL? </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> n</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>debug at <span class="sc">~</span><span class="er">/</span>tsap<span class="sc">/</span>R<span class="sc">/</span>utils_scatter.R<span class="co">#452: if (!is.null(col_var) &amp; is.null(facet_var)) {</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At this step, I can see the values for <code>col_var</code> and <code>facet_var</code> are present in the function <strong>Environment</strong>:</p>
<div id="fig-env_vars_col_facet" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-env_vars_col_facet" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="env_vars_col_facet.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-env_vars_col_facet"></p>
<figcaption class="figure-caption">(a) Function variables in <code>gg_color_scatter_facet()</code></figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;10: Color and facet variables in <code>gg_color_scatter_facet()</code></figcaption>
</figure>
</div>
<p>I continue stepping through the control flow until I arrive at the <code>ggplot2</code> function:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># col_var NULL?</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> n</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>debug at <span class="sc">~</span><span class="er">/</span>tsap<span class="sc">/</span>R<span class="sc">/</span>utils_scatter.R<span class="co">#452: if (is.null(col_var) &amp; !is.null(facet_var)) {</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When I arrive at the <code>ggplot2</code> functions, I’ll see this code highlighted in the <strong>Source</strong> pane,</p>
<div id="fig-debugger_ggplot2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-debugger_ggplot2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="debugger_ggplot2.png" class="img-fluid figure-img" style="width:75.0%" data-ref-parent="fig-debugger_ggplot2"></p>
<figcaption class="figure-caption">(a) Function variables in <code>gg_color_scatter_facet()</code></figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;11: <code>ggplot2</code> code in <code>gg_color_scatter_facet()</code></figcaption>
</figure>
</div>
<p>When I attempt to execute this step, I see the error:</p>
</section>
<section id="confirmation" class="level3">
<h3 class="anchored" data-anchor-id="confirmation">Confirmation!</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>Browse[<span class="dv">2</span>]<span class="sc">&gt;</span> n</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="st">`</span><span class="at">.data[["race1"]]</span><span class="st">`</span><span class="sc">:</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span> Column <span class="st">`</span><span class="at">race1</span><span class="st">`</span> not found <span class="cf">in</span> <span class="st">`</span><span class="at">.data</span><span class="st">`</span>.</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>Run <span class="st">`</span><span class="at">rlang::last_trace()</span><span class="st">`</span> to see where the error occurred.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The error in the debugger tells me that when I update the package in <code>mod_pkg</code>, the dataset (from <code>mod_ds</code>) is updated in <code>plot_values()</code> <em>before</em> the column values (from <code>mod_cols</code>).</p>
<p>This explains why the error I’m seeing is referring to data masking (<code>.data[["race1"]]</code>), because in <code>gg_color_scatter_facet()</code>, when <code>.data</code> changes to <code>penguins</code>, the <code>facet_var</code> is still <code>race1</code>.</p>
</section>
</section>
<section id="solution-1" class="level2">
<h2 class="anchored" data-anchor-id="solution-1">Solution 1</h2>
<p>I have a few options for dealing with this warning. I can rewrite the custom <code>ggplot2</code> function to only execute if all of the column arguments are present in <code>.data</code>. This can be implemented using something like <code>graph_check()</code> below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>graph_check <span class="ot">&lt;-</span> <span class="cf">function</span>(df, x_var, y_var, <span class="at">col_var =</span> <span class="cn">NULL</span>, <span class="at">facet_var =</span> <span class="cn">NULL</span>, ...)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">c</span>(x_var, y_var, col_var, facet_var) <span class="sc">%in%</span> <span class="fu">names</span>(df)) <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  cli<span class="sc">::</span><span class="fu">cli_alert_success</span>(<span class="st">"Plot renders"</span>) </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  cli<span class="sc">::</span><span class="fu">cli_alert_warning</span>(<span class="st">"Columns not in .data"</span>) </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>graph_check()</code> will search the names of <code>df</code> to confirm the values provided in the column arguments are present.</p>
<p>I can confirm this with <code>plot_values_test</code> (the list with <code>penguins</code> data and <code>NHANES</code> columns) and <code>plot_values</code> (a list with <code>NHANES</code> data and columns).</p>
<ul>
<li><p>Check mismatched data and columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">graph_check</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> plot_values_test<span class="sc">$</span>df,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_var =</span> plot_values_test<span class="sc">$</span>x_var,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_var =</span> plot_values_test<span class="sc">$</span>y_var,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_var =</span> plot_values_test<span class="sc">$</span>col_var,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">facet_var =</span> plot_values_test<span class="sc">$</span>facet_var,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> plot_values_test<span class="sc">$</span>alpha,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> plot_values_test<span class="sc">$</span>size</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>! Columns not in .data</code></pre>
<ul>
<li>Create correct <code>plot_values</code> list:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plot_values <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(NHANES<span class="sc">::</span>NHANES),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_var =</span> <span class="st">"poverty"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_var =</span> <span class="st">"weight"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_var =</span> <span class="st">"survey_yr"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">facet_var =</span> <span class="st">"race1"</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> 2L,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.75</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Confirm <code>graph_check()</code>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">graph_check</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> plot_values<span class="sc">$</span>df,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_var =</span> plot_values<span class="sc">$</span>x_var,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_var =</span> plot_values<span class="sc">$</span>y_var,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_var =</span> plot_values<span class="sc">$</span>col_var,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">facet_var =</span> plot_values<span class="sc">$</span>facet_var,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> plot_values<span class="sc">$</span>alpha,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> plot_values<span class="sc">$</span>size</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>✔ Plot renders</code></pre></li>
</ul>
<p>I can also separate the graph aesthetic <em>variables</em> (<code>x_var</code>, <code>y_var</code>, <code>col_var</code>, and <code>facet_var</code>) from the two graph aesthetic <em>values</em> (<code>alpha</code> and <code>size</code>). I’ve implemented this solution in the <code>mod_vars</code> and <code>mod_graph</code> modules, which you can view below:</p>
<div class="cell">
<details>
<summary>show/hide mod_vars</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>mod_vars_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">NS</span>(id)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">tagList</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">fluidRow</span>(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">column</span>(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">selectInput</span>(</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">inputId =</span> <span class="fu">ns</span>(<span class="st">"x"</span>),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"X variable:"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">choices =</span> <span class="cn">NULL</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">selectInput</span>(</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">inputId =</span> <span class="fu">ns</span>(<span class="st">"y"</span>),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"Y variable:"</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">choices =</span> <span class="cn">NULL</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">column</span>(</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        <span class="dv">6</span>,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">selectInput</span>(</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">inputId =</span> <span class="fu">ns</span>(<span class="st">"col"</span>),</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"Color variable:"</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">choices =</span> <span class="cn">NULL</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">selectInput</span>(</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">inputId =</span> <span class="fu">ns</span>(<span class="st">"facet"</span>),</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"Facet variable:"</span>,</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">choices =</span> <span class="cn">NULL</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>mod_vars_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, ds_input) {</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    pkg_data <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactive</span>({</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>      janitor<span class="sc">::</span><span class="fu">clean_names</span>(<span class="fu">ds_input</span>())</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">ds_input</span>(),</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>      num_vars <span class="ot">&lt;-</span> <span class="fu">pull_numeric_cols</span>(<span class="at">df =</span> <span class="fu">pkg_data</span>())</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">updateSelectInput</span>(session,</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"x"</span>,</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">choices =</span> num_vars,</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">selected =</span> num_vars[<span class="dv">1</span>]</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">pkg_data</span>(),</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>      num_vars <span class="ot">&lt;-</span> <span class="fu">pull_numeric_cols</span>(<span class="at">df =</span> <span class="fu">pkg_data</span>())</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">updateSelectInput</span>(session,</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"y"</span>,</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">choices =</span> num_vars,</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">selected =</span> num_vars[<span class="dv">2</span>]</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">pkg_data</span>(),</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>      col_vars <span class="ot">&lt;-</span> <span class="fu">pull_binary_cols</span>(<span class="at">df =</span> <span class="fu">pkg_data</span>())</span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">updateSelectInput</span>(session,</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"col"</span>,</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>        <span class="at">choices =</span> col_vars,</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">selected =</span> col_vars[<span class="dv">1</span>]</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">pkg_data</span>(),</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>        <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>      facet_vars <span class="ot">&lt;-</span> <span class="fu">pull_facet_cols</span>(<span class="at">df =</span> <span class="fu">pkg_data</span>())</span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">updateSelectInput</span>(session,</span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"facet"</span>,</span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">choices =</span> facet_vars,</span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">selected =</span> facet_vars[<span class="dv">1</span>]</span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">pkg_data</span>(),</span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>    df_vars <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">reactive</span>({</span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>      cols <span class="ot">&lt;-</span> <span class="fu">c</span>(input<span class="sc">$</span>x, input<span class="sc">$</span>y, input<span class="sc">$</span>col, input<span class="sc">$</span>facet)</span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">sum</span>(cols <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">pkg_data</span>())) <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a>          <span class="at">.data =</span> <span class="fu">pkg_data</span>(),</span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(</span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a>            input<span class="sc">$</span>x, input<span class="sc">$</span>y,</span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>            input<span class="sc">$</span>col, input<span class="sc">$</span>facet</span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a>          ))</span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">bindEvent</span>(</span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(</span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a>          <span class="fu">pkg_data</span>(),</span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a>          input<span class="sc">$</span>x, input<span class="sc">$</span>y,</span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a>          input<span class="sc">$</span>col, input<span class="sc">$</span>facet</span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a>        <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">reactive</span>({</span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a>        cols <span class="ot">&lt;-</span> <span class="fu">c</span>(input<span class="sc">$</span>x, input<span class="sc">$</span>y, input<span class="sc">$</span>col, input<span class="sc">$</span>facet)</span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">sum</span>(cols <span class="sc">%in%</span> <span class="fu">names</span>(<span class="fu">pkg_data</span>())) <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a>            <span class="at">.data =</span> <span class="fu">pkg_data</span>(),</span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(</span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a>              input<span class="sc">$</span>x, input<span class="sc">$</span>y,</span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a>              input<span class="sc">$</span>col, input<span class="sc">$</span>facet</span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a>      }) <span class="sc">|&gt;</span></span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">bindEvent</span>(</span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pkg_data</span>(),</span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a>            input<span class="sc">$</span>x, input<span class="sc">$</span>y,</span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a>            input<span class="sc">$</span>col, input<span class="sc">$</span>facet</span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a>          <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span></span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>show/hide mod_graph</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>mod_graph_ui <span class="ot">&lt;-</span> <span class="cf">function</span>(id) {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  ns <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">NS</span>(id)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">tagList</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">fluidRow</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">column</span>(</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">sliderInput</span>(</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">inputId =</span> <span class="fu">ns</span>(<span class="st">"alpha"</span>),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"Point opacity:"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>, <span class="at">step =</span> <span class="fl">0.1</span>,</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> <span class="fl">0.7</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">column</span>(</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">sliderInput</span>(</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">inputId =</span> <span class="fu">ns</span>(<span class="st">"size"</span>),</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">label =</span> <span class="st">"Point size:"</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">5</span>,</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">step =</span> <span class="fl">0.2</span>,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">value =</span> <span class="dv">3</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">fluidRow</span>(</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>      shiny<span class="sc">::</span><span class="fu">column</span>(</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">plotOutput</span>(<span class="at">outputId =</span> <span class="fu">ns</span>(<span class="st">"graph"</span>))</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>mod_graph_server <span class="ot">&lt;-</span> <span class="cf">function</span>(id, graph_inputs) {</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">moduleServer</span>(id, <span class="cf">function</span>(input, output, session) {</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>vals <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPrint</span>({</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(input<span class="sc">$</span>alpha, input<span class="sc">$</span>size)</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>           }) <span class="sc">|&gt;</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>          shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">graph_inputs</span>(),</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>          shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>              output<span class="sc">$</span>graph <span class="ot">&lt;-</span> shiny<span class="sc">::</span><span class="fu">renderPlot</span>({</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">gg_scatter_color_facet</span>(</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">df =</span> <span class="fu">graph_inputs</span>(),</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x_var =</span> <span class="fu">names</span>(<span class="fu">graph_inputs</span>())[<span class="dv">1</span>],</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y_var =</span> <span class="fu">names</span>(<span class="fu">graph_inputs</span>())[<span class="dv">2</span>],</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_var =</span> <span class="fu">names</span>(<span class="fu">graph_inputs</span>())[<span class="dv">3</span>],</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>                     <span class="at">facet_var =</span> <span class="fu">names</span>(<span class="fu">graph_inputs</span>())[<span class="dv">4</span>],</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> input<span class="sc">$</span>alpha,</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> input<span class="sc">$</span>size)</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>              }) <span class="sc">|&gt;</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>             shiny<span class="sc">::</span><span class="fu">bindEvent</span>(<span class="fu">graph_inputs</span>(),</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>                              input<span class="sc">$</span>alpha, input<span class="sc">$</span>size,</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ignoreNULL =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These are added to <code>appUI()</code> and <code>appServer()</code> the same way I used the <code>mod_cols</code> and <code>mod_plot</code> modules, and results in the following:</p>
<div id="fig-mod_vars_graph" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="fig-mod_vars_graph" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="mod_vars_graph.gif" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-mod_vars_graph"></p>
<figcaption class="figure-caption">(a) <code>mod_vars</code> and <code>mod_graph</code> in <code>pkgDataApp()</code> error</figcaption>
</figure>
</div>
<figcaption class="figure-caption">Figure&nbsp;12: Shiny app displaying <code>mod_vars</code> and <code>mod_graph</code></figcaption>
</figure>
</div>
<p>I can see the warning/error is no longer displayed in UI or the <strong>Console.</strong></p>
</section>
<section id="solution-2" class="level2">
<h2 class="anchored" data-anchor-id="solution-2">Solution 2</h2>
<p>A second option is using the <a href="https://github.com/ColinFay/gargoyle"><code>gargoyle</code> package</a> from Colin Fay. This package is designed to provide ‘Event-Based Structures for Shiny’, and it works like so:</p>
<p>In <code>appServer()</code>, I use <code>gargoyle::init()</code> to initiate a series of ‘trigger flags’ and a environment (<code>env_vars</code>) to store the function values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>gargoyle<span class="sc">::</span><span class="fu">init</span>(<span class="st">"tf_ds"</span>, <span class="st">"tf_cols"</span>, <span class="st">"tf_plot"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>env_vars <span class="ot">&lt;-</span> <span class="fu">new.env</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then I use <code>gargoyle::trigger()</code> and <code>gargoyle::watch()</code> to link the modules together in a ‘reactive daisy-chain’:</p>
<div class="cell">
<details open="">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pkg module ----</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  env_vars<span class="sc">$</span>pkg <span class="ot">&lt;-</span> <span class="fu">mod_pkg_server</span>(<span class="st">"pkg"</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(env_vars<span class="sc">$</span>pkg)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  gargoyle<span class="sc">::</span><span class="fu">trigger</span>(<span class="st">"tf_ds"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">bindEvent</span>(env_vars)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset module ----</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  env_vars<span class="sc">$</span>dataset <span class="ot">&lt;-</span> <span class="fu">mod_ds_server</span>(<span class="st">"ds"</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">pkg_input =</span> env_vars<span class="sc">$</span>pkg</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(env_vars<span class="sc">$</span>dataset)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  gargoyle<span class="sc">::</span><span class="fu">trigger</span>(<span class="st">"tf_cols"</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">bindEvent</span>(</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    gargoyle<span class="sc">::</span><span class="fu">watch</span>(<span class="st">"tf_ds"</span>)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># column select module ----</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  env_vars<span class="sc">$</span>plot_values <span class="ot">&lt;-</span> <span class="fu">mod_cols_server</span>(</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="st">"cols"</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">ds_input =</span> env_vars<span class="sc">$</span>dataset</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(env_vars<span class="sc">$</span>plot_values)</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  gargoyle<span class="sc">::</span><span class="fu">trigger</span>(<span class="st">"tf_plot"</span>)</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">bindEvent</span>(</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    gargoyle<span class="sc">::</span><span class="fu">watch</span>(<span class="st">"tf_cols"</span>)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a><span class="co"># plot module ----</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mod_plot_server</span>(<span class="st">"plot"</span>,</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">ds_input =</span> env_vars<span class="sc">$</span>dataset,</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_inputs =</span> env_vars<span class="sc">$</span>plot_values</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>  shiny<span class="sc">::</span><span class="fu">bindEvent</span>(</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>    gargoyle<span class="sc">::</span><span class="fu">watch</span>(<span class="st">"tf_plot"</span>)</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I’ve deployed a version of this application <a href="https://mjfrigaard.shinyapps.io/gartsap/">here in showcase mode</a> so you can review the modules, ui, and server.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>