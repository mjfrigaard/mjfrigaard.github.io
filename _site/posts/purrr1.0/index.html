<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Frigaard">
<meta name="dcterms.date" content="2023-04-05">

<title>purrr updates (v1.0.0) – @mjfrigaard</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-7246a90fd7fce57841499c4ef90837f1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"><span class="citation" data-cites="mjfrigaard">@mjfrigaard</span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../series.html"> 
<span class="menu-text">Series</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../books.html"> 
<span class="menu-text">Books</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../articles.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../code.html"> 
<span class="menu-text">Code</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mjfrigaard"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/mjfrigaard"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">purrr updates (v1.0.0)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">iteration</div>
                <div class="quarto-category">code</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Martin Frigaard </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 5, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#refresher-functions-and-objects" id="toc-refresher-functions-and-objects" class="nav-link active" data-scroll-target="#refresher-functions-and-objects"><strong>Refresher</strong>: functions and objects</a>
  <ul>
  <li><a href="#generic-functions-s3-objects" id="toc-generic-functions-s3-objects" class="nav-link" data-scroll-target="#generic-functions-s3-objects">Generic functions &amp; S3 objects</a></li>
  <li><a href="#fp-oop" id="toc-fp-oop" class="nav-link" data-scroll-target="#fp-oop">FP + OOP</a></li>
  <li><a href="#iteration-problems" id="toc-iteration-problems" class="nav-link" data-scroll-target="#iteration-problems">Iteration problems</a></li>
  </ul></li>
  <li><a href="#the-for-loop" id="toc-the-for-loop" class="nav-link" data-scroll-target="#the-for-loop"><strong>The <code>for</code> loop</strong></a></li>
  <li><a href="#base-r" id="toc-base-r" class="nav-link" data-scroll-target="#base-r"><strong>Base R</strong></a>
  <ul>
  <li><a href="#lapply" id="toc-lapply" class="nav-link" data-scroll-target="#lapply"><code>lapply()</code></a></li>
  <li><a href="#sapply" id="toc-sapply" class="nav-link" data-scroll-target="#sapply"><code>sapply()</code></a></li>
  <li><a href="#anonmymous-functions" id="toc-anonmymous-functions" class="nav-link" data-scroll-target="#anonmymous-functions">Anonmymous functions</a></li>
  <li><a href="#vapply" id="toc-vapply" class="nav-link" data-scroll-target="#vapply"><code>vapply()</code></a></li>
  </ul></li>
  <li><a href="#purrr" id="toc-purrr" class="nav-link" data-scroll-target="#purrr"><strong><code>purrr</code></strong></a>
  <ul>
  <li><a href="#do-it-for-one-element" id="toc-do-it-for-one-element" class="nav-link" data-scroll-target="#do-it-for-one-element">1. Do it for one element</a></li>
  <li><a href="#turn-it-into-a-recipe" id="toc-turn-it-into-a-recipe" class="nav-link" data-scroll-target="#turn-it-into-a-recipe">2. Turn it into a recipe</a></li>
  <li><a href="#map-it-across-all-elements" id="toc-map-it-across-all-elements" class="nav-link" data-scroll-target="#map-it-across-all-elements">3. <code>map()</code> it across all elements</a></li>
  </ul></li>
  <li><a href="#version-1.0.0-updates" id="toc-version-1.0.0-updates" class="nav-link" data-scroll-target="#version-1.0.0-updates"><strong>Version 1.0.0 updates</strong></a>
  <ul>
  <li><a href="#map-updates" id="toc-map-updates" class="nav-link" data-scroll-target="#map-updates"><code>map()</code> updates</a>
  <ul>
  <li><a href="#map_vec" id="toc-map_vec" class="nav-link" data-scroll-target="#map_vec"><code>map_vec()</code></a></li>
  </ul></li>
  <li><a href="#anonymous-functions" id="toc-anonymous-functions" class="nav-link" data-scroll-target="#anonymous-functions">Anonymous functions</a></li>
  </ul></li>
  <li><a href="#worked-examples" id="toc-worked-examples" class="nav-link" data-scroll-target="#worked-examples">Worked Examples</a>
  <ul>
  <li><a href="#downloading-files" id="toc-downloading-files" class="nav-link" data-scroll-target="#downloading-files">Downloading files</a>
  <ul>
  <li><a href="#return-invisibly" id="toc-return-invisibly" class="nav-link" data-scroll-target="#return-invisibly">Return invisibly</a></li>
  <li><a href="#side-effects" id="toc-side-effects" class="nav-link" data-scroll-target="#side-effects">Side-effects</a></li>
  <li><a href="#purrr-progress-bars" id="toc-purrr-progress-bars" class="nav-link" data-scroll-target="#purrr-progress-bars"><code>purrr</code> progress bars</a></li>
  </ul></li>
  <li><a href="#copying-a-directory-of-files" id="toc-copying-a-directory-of-files" class="nav-link" data-scroll-target="#copying-a-directory-of-files">Copying a directory of files</a></li>
  <li><a href="#import-multiple-datasets" id="toc-import-multiple-datasets" class="nav-link" data-scroll-target="#import-multiple-datasets">Import multiple datasets</a>
  <ul>
  <li><a href="#list_rbind" id="toc-list_rbind" class="nav-link" data-scroll-target="#list_rbind"><code>list_rbind()</code></a></li>
  </ul></li>
  <li><a href="#export-multiple-datasets" id="toc-export-multiple-datasets" class="nav-link" data-scroll-target="#export-multiple-datasets">Export multiple datasets</a>
  <ul>
  <li><a href="#group_walk" id="toc-group_walk" class="nav-link" data-scroll-target="#group_walk"><code>group_walk()</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#recap-purrr-and-iteration" id="toc-recap-purrr-and-iteration" class="nav-link" data-scroll-target="#recap-purrr-and-iteration">Recap: <code>purrr</code> and iteration</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<!--
https://mjfrigaard.github.io/posts/vanilla-shiny/

https://mjfrigaard.github.io/posts/my-pkg-app/

https://mjfrigaard.github.io/posts/my-golem-app/

https://mjfrigaard.github.io/posts/my-leprechaun-app/

https://mjfrigaard.github.io/posts/my-rhino-app/
-->
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("tidyverse/purrr", </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                   force = TRUE, quiet = TRUE)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sloop)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(snakecase)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(waldo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>This post is going to cover the recent updates to the <a href="https://purrr.tidyverse.org/"><code>purrr</code> package</a>. The release of <a href="https://www.tidyverse.org/blog/2022/12/purrr-1-0-0/">version 1.0.0</a> (and dev version <a href="https://github.com/tidyverse/purrr/blob/main/NEWS.md#purrr-101">v1.0.1</a>) had some breaking changes, which I will cover below. But first, I’ll dive into some attributes of R’s functions and objects that make <code>purrr</code> particularly useful, and I’ll work through iteration problems I’ve encountered (and solved with <code>purrr</code>).</p>
<section id="refresher-functions-and-objects" class="level1">
<h1><strong>Refresher</strong>: functions and objects</h1>
<p>If you’re like me, you’ve never been a big fan of <code>for</code> loops. They’re an important concept to grasp, but if you’ve ever had to debug what’s happening in multiple nested <code>for</code> loops, you’ve probably found yourself asking if there’s a better way to iterate.</p>
<p>In a functional programming language like R, it’s nice when to have functions perform a lot of the work I’d have to write into a <code>for</code> loop.</p>
<section id="generic-functions-s3-objects" class="level2">
<h2 class="anchored" data-anchor-id="generic-functions-s3-objects">Generic functions &amp; S3 objects</h2>
<p>R’s syntax avoids explicit iteration by allowing certain <em>generic</em> functions to be used across different types (or objects). For example, the base <code>plot()</code> and <code>summary()</code> functions are S3 generic function:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(plot)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "S3"      "generic"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(summary)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "S3"      "generic"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Which means <code>plot()</code> can be applied to S3 objects, like time-series (<code>ts</code>) and rectangular datasets (<code>data.frame</code>):</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(datasets<span class="sc">::</span>LakeHuron)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "S3"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(datasets<span class="sc">::</span>LakeHuron)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "ts"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(datasets<span class="sc">::</span>chickwts)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "S3"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(datasets<span class="sc">::</span>chickwts)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "data.frame"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datasets<span class="sc">::</span>LakeHuron)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   576.0   578.1   579.1   579.0   579.9   581.9</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(datasets<span class="sc">::</span>chickwts)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      weight             feed   </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  Min.   :108.0   casein   :12  </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1st Qu.:204.5   horsebean:10  </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  Median :258.0   linseed  :12  </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  Mean   :261.3   meatmeal :11  </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  3rd Qu.:323.5   soybean  :14  </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  Max.   :423.0   sunflower:12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(datasets<span class="sc">::</span>LakeHuron)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(datasets<span class="sc">::</span>chickwts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Time-series plot"><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672" alt="Time-series plot"></a></p>
<figcaption>Time-series plot</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-3-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Scatter Plot"><img src="index_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672" alt="Scatter Plot"></a></p>
<figcaption>Scatter Plot</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p><code>summary()</code> is a particularly versatile function, because it can be used on <code>data.frame</code>s, a single column in a <code>data.frame</code>, model outputs, and more.</p>
<div style="font-size: 0.90em; color: #696969;">
<p><em>Click <strong>Code</strong> below to view an example using <code>summary()</code></em></p>
</div>
<div style="font-size: 0.90em;">
<div class="cell">
<details class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get summary of columns ----------------------------------------------------</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars<span class="sc">$</span>hp)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    52.0    96.5   123.0   146.7   180.0   335.0</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars<span class="sc">$</span>mpg)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   10.40   15.43   19.20   20.09   22.80   33.90</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># store model output  -------------------------------------------------------</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>lm_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> mpg <span class="sc">~</span> hp, <span class="at">data =</span> mtcars)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>lm_mod</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = mpg ~ hp, data = mtcars)</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept)           hp  </span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="do">##    30.09886     -0.06823</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># get summary of model output -----------------------------------------------</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_mod)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="do">## lm(formula = mpg ~ hp, data = mtcars)</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Residuals:</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="do">## -5.7121 -2.1122 -0.8854  1.5819  8.2360 </span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="do">##             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) 30.09886    1.63392  18.421  &lt; 2e-16 ***</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="do">## hp          -0.06823    0.01012  -6.742 1.79e-07 ***</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="do">## Residual standard error: 3.863 on 30 degrees of freedom</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Multiple R-squared:  0.6024, Adjusted R-squared:  0.5892 </span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="do">## F-statistic: 45.46 on 1 and 30 DF,  p-value: 1.788e-07</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co"># pass the output from one S3 generic to another S3 generic -----------------</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">summary</span>(lm_mod))</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="do">##                Estimate Std. Error   t value     Pr(&gt;|t|)</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="do">## (Intercept) 30.09886054  1.6339210 18.421246 6.642736e-18</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="do">## hp          -0.06822828  0.0101193 -6.742389 1.787835e-07</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="fp-oop" class="level2">
<h2 class="anchored" data-anchor-id="fp-oop">FP + OOP</h2>
<blockquote class="blockquote">
<p><em>Functional programming is complementary to object-oriented programming, which has been the dominant programming paradigm for the last several decades.</em> - Advanced R, 2nd edition</p>
</blockquote>
<p><code>plot()</code> and <code>summary()</code> are parametric polymorphic (generic) functions, which means they have slightly different behaviors based on the objects passed into them.</p>
<p>As I can see, generic functions are flexible and efficient because of not having to re-define a new function for each input object–outputs from generic functions will automatically change (in part) depending on the structure of the object provided to them.</p>
<p>The relationship between functions and objects is what makes <code>purrr</code> (and other tools for iteration) extremely helpful for solving iteration problems we commonly encounter when working with data. Similar to generic functions, these functions allow us to express iterative behavior using a complete and consistent set of tools.</p>
</section>
<section id="iteration-problems" class="level2">
<h2 class="anchored" data-anchor-id="iteration-problems">Iteration problems</h2>
<p>In programming, iteration refers to defining an input and applying an operation over every part of it. Some examples of problems that iteration can solve include:</p>
<ol type="1">
<li><p>You have a list of objects and you’d like to apply a function (or a series of functions) over the elements in the list</p></li>
<li><p>You have a folder full of files you’d like to rename or copy to a new directory</p></li>
<li><p>You’d like to download a collection of files from separate URLS</p></li>
<li><p>You have several years of data, and each year is contained in separate file. You’d like to read these data into R, combine them into a single dataset</p></li>
<li><p>You have a non-rectangular (i.e., list) of datasets you’d like to split into individual <code>data.frame</code>s, then export these into separate file paths.</p></li>
</ol>
<p>These are all problems I’ve personally encountered that required a variety of iteration tools to tackle. I’ll start with the first example because the principles remain the same (regardless of the size/scope of the problem):</p>
</section>
</section>
<section id="the-for-loop" class="level1">
<h1><strong>The <code>for</code> loop</strong></h1>
<p><code>for</code> loops are ubiquitous in programming, and (for the most part) they describe the types of problems they’re solving:</p>
<blockquote class="blockquote">
<p>“<em>for each <code>item</code> in <code>object</code>, do <code>operation</code></em>”</p>
</blockquote>
<p>I have a list (<code>my_list</code>), with items in various cases:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>my_list</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## $words</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "MOvE"     "tHURsDAy" "SISter"   "jOiN"     "lASt"    </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $sentences</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "THe tHefT oF the Pearl PIN WaS kePT SEcrEt."    </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] "iT snOWed, RAINEd, AND HaIled ThE samE MOrNiNG."</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] "IT caUght iTs HINd pAw in a ruSTY tRaP."        </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $letters</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] "W" "G" "T" "q" "X" "S" "O" "P" "u" "L"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>If I try to use the <code>tolower()</code> on <code>my_list</code>, it returns a vector.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tolower</span>(my_list) <span class="sc">|&gt;</span> <span class="fu">str</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  chr [1:3] "c(\"move\", \"thursday\", \"sister\", \"join\", \"last\")" ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>How can I apply the <code>tolower()</code> function to each item in <code>my_list</code>, and return the original object type? I’ll use <code>my_list</code> and <code>tolower()</code> to demonstrate how I was taught to write <code>for</code> loops:</p>
<ul>
<li><p><strong>First</strong>: define the sequence, ‘<em>for <code>[item]</code> in <code>[items in object]</code></em>’</p>
<ul>
<li>In this case, <code>x</code> is the abstracted <code>[item]</code> taking on the values returned by <code>seq_along(my_list)</code> (the <code>[items in object]</code>)</li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(my_list)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1 2 3</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># take single value of 'x'</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(my_list)[<span class="dv">1</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use this to get 'items in object'</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>my_list[[<span class="fu">seq_along</span>(my_list)[<span class="dv">1</span>]]]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "MOvE"     "tHURsDAy" "SISter"   "jOiN"     "lASt"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div></li>
<li><p><strong>Second</strong>: write the operations the for loop will perform per iteration (i.e.&nbsp;the first iteration is <code>x</code> = <code>tolower(my_list[[1]])</code>; the second iteration is <code>x</code> = <code>tolower(my_list[[2]])</code>; etc.)</p>
<ul>
<li>Test this with a few values if you like</li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tolower</span>(my_list[[<span class="dv">2</span>]])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "the theft of the pearl pin was kept secret."    </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] "it snowed, rained, and hailed the same morning."</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] "it caught its hind paw in a rusty trap."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div></li>
<li><p><strong>Third</strong>: define an (optional) object to capture the results of the loop (<code>lc_list</code>), and make sure it’s the correct size</p>
<ul>
<li>Two methods for creating empty lists</li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">3</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">## NULL</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [[2]]</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">## NULL</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [[3]]</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="do">## NULL</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="cn">NULL</span>, <span class="cn">NULL</span>, <span class="cn">NULL</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [[1]]</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="do">## NULL</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [[2]]</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="do">## NULL</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [[3]]</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="do">## NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div></li>
</ul>
<p>Finally, we put it all together in a <code>for</code> loop</p>
<div style="font-size: 1.0em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define capture object</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>lc_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">3</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># write sequence</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="fu">seq_along</span>(my_list)) {        </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># write operations/capture in object</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  lc_list[[x]] <span class="ot">&lt;-</span> <span class="fu">tolower</span>(my_list[[x]])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clean up container</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(lc_list) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"words"</span>, <span class="st">"sentences"</span>, <span class="st">"letters"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>lc_list</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="do">## $words</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "move"     "thursday" "sister"   "join"     "last"    </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="do">## $sentences</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "the theft of the pearl pin was kept secret."    </span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] "it snowed, rained, and hailed the same morning."</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] "it caught its hind paw in a rusty trap."        </span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="do">## $letters</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] "w" "g" "t" "q" "x" "s" "o" "p" "u" "l"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>This was a simple example, but it demonstrates the basic components in a <code>for</code> loop:</p>
<ol type="1">
<li>The sequence to index
<ul>
<li><code>for (x in seq_along(my_list))</code><br>
</li>
</ul></li>
<li>The operations to iterate
<ul>
<li><code>tolower(my_list[[x]])</code><br>
</li>
</ul></li>
<li>The object to capture the results
<ul>
<li><code>lc_list &lt;- vector(mode = "list", length = 3)</code> and<br>
</li>
<li><code>lc_list[[x]]</code></li>
</ul></li>
</ol>
</section>
<section id="base-r" class="level1">
<h1><strong>Base R</strong></h1>
<p>base R has the <code>_apply</code> family of functions (<code>apply()</code>, <code>lapply()</code>, <code>sapply()</code>, <code>vapply()</code>, etc.) that remove a lot of the ‘book keeping’ code we had to write in the <code>for</code> loop.</p>
<section id="lapply" class="level2">
<h2 class="anchored" data-anchor-id="lapply"><code>lapply()</code></h2>
<p>Sticking with the <code>my_list</code> and <code>tolower()</code> example, the <code>apply</code> function I want is <code>lapply()</code> (pronounced ‘l-apply’), and the <code>l</code> stands for list.</p>
<p><code>lapply()</code> has only two required arguments:</p>
<ul>
<li><p><code>X</code> the object we want to iterate over</p></li>
<li><p><code>FUN</code> being the function we want iterated</p></li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="at">X =</span> my_list, <span class="at">FUN =</span> tolower)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="do">## $words</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "move"     "thursday" "sister"   "join"     "last"    </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $sentences</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "the theft of the pearl pin was kept secret."    </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] "it snowed, rained, and hailed the same morning."</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] "it caught its hind paw in a rusty trap."        </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $letters</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] "w" "g" "t" "q" "x" "s" "o" "p" "u" "l"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="sapply" class="level2">
<h2 class="anchored" data-anchor-id="sapply"><code>sapply()</code></h2>
<p><code>sapply()</code> attempts to simplify the result depending on the <code>X</code> argument. If <code>X</code> is a list containing vectors where every element has the same length (and it’s greater than 1), then <code>sapply()</code> returns a matrix:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(my_list[<span class="dv">1</span>])</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## List of 1</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ words: chr [1:5] "MOvE" "tHURsDAy" "SISter" "jOiN" ...</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="at">X =</span> my_list[<span class="dv">1</span>], <span class="at">FUN =</span> tolower)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">##      words     </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] "move"    </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] "thursday"</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] "sister"  </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,] "join"    </span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [5,] "last"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>If a vector is passed to <code>X</code> where every element is length 1, then a vector is returned:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(my_list[[<span class="dv">1</span>]])</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  chr [1:5] "MOvE" "tHURsDAy" "SISter" "jOiN" "lASt"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="at">X =</span> my_list[[<span class="dv">1</span>]], <span class="at">FUN =</span> tolower) </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="do">##       MOvE   tHURsDAy     SISter       jOiN       lASt </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     "move" "thursday"   "sister"     "join"     "last"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Finally, if <code>X</code> is a list where elements have a length greater than 1, then a list is returned (making it identical to <code>lapply()</code></p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>waldo<span class="sc">::</span><span class="fu">compare</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">sapply</span>(<span class="at">X =</span> my_list, <span class="at">FUN =</span> tolower), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">lapply</span>(<span class="at">X =</span> my_list, <span class="at">FUN =</span> tolower)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ✔ No differences</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>This is because <code>sapply</code> is a wrapper around <code>lapply</code>, but has <code>simplify</code> and <code>USE.NAMES</code> set to <code>FALSE</code> (see what happens below when I change them to <code>TRUE</code>)</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>waldo<span class="sc">::</span><span class="fu">compare</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">lapply</span>(<span class="at">X =</span> my_list[[<span class="dv">1</span>]], <span class="at">FUN =</span> tolower), </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">sapply</span>(<span class="at">X =</span> my_list[[<span class="dv">1</span>]], <span class="at">FUN =</span> tolower, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">simplify =</span> <span class="cn">TRUE</span>, <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="do">## `old` is a list</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="do">## `new` is a character vector ('move', 'thursday', 'sister', 'join', 'last')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="anonmymous-functions" class="level2">
<h2 class="anchored" data-anchor-id="anonmymous-functions">Anonmymous functions</h2>
<p>The <code>FUN</code> argument can also take anonymous (undefined) functions. For example, if I wanted to access the second elements in <code>my_list</code>, I could pass an anonymous function the <code>FUN</code> (with the index):</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="at">X =</span> my_list, <span class="at">FUN =</span> <span class="cf">function</span>(x) x[[<span class="dv">2</span>]])</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="do">## $words</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "tHURsDAy"</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $sentences</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "iT snOWed, RAINEd, AND HaIled ThE samE MOrNiNG."</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $letters</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "G"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="vapply" class="level2">
<h2 class="anchored" data-anchor-id="vapply"><code>vapply()</code></h2>
<p>Finally <code>vapply()</code> is unique in that it always simplifies the returned output. If we repeat the example above, we see the returned value is character vector:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(<span class="at">X =</span> my_list, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x) x[[<span class="dv">2</span>]], </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="do">##                                             words </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="do">##                                        "tHURsDAy" </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="do">##                                         sentences </span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="do">## "iT snOWed, RAINEd, AND HaIled ThE samE MOrNiNG." </span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="do">##                                           letters </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="do">##                                               "G"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>The <code>apply</code> functions get us much further than writing <code>for</code> loops because we can 1) iterate over vectors and lists, 2) control the output objects, and 3) <strong>write less code.</strong> Unlike generic functions, <code>apply</code> functions are designed to work with specific object types, and return values depending on these objects.</p>
<p>One downside of apply functions is they don’t play well with <code>data.frame</code>s or <code>tibble</code>s. However, we can control their return values (and manually supply these to <code>tibble::tibble()</code> or <code>data.frame()</code></p>
<div style="font-size: 0.90em;">
<div class="cell">
<details class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">words =</span> <span class="fu">vapply</span>(<span class="at">X =</span> my_list[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN =</span> <span class="st">`</span><span class="at">[</span><span class="st">`</span>, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">1</span>)),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sentences =</span> <span class="fu">vapply</span>(<span class="at">X =</span> my_list[[<span class="dv">2</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">FUN =</span> <span class="st">`</span><span class="at">[</span><span class="st">`</span>, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">1</span>)),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">letters =</span> <span class="fu">vapply</span>(<span class="at">X =</span> my_list[[<span class="dv">3</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">FUN =</span> <span class="st">`</span><span class="at">[</span><span class="st">`</span>, </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Another downside of the <code>apply</code> functions is they’re not very uniform. Each function has slight variations in their arguments and rules for return values. This is where <code>purrr</code> comes in…</p>
</section>
</section>
<section id="purrr" class="level1">
<h1><strong><code>purrr</code></strong></h1>
<p>If you’re new to <code>purrr</code>, a great way to start using it’s functions is with a recipe covered in <a href="https://posit.co/resources/videos/happy-r-users-purrr-tutorial/">Charlotte Wickham’s tutorial</a></p>
<ol type="1">
<li><p>Do it for one element</p></li>
<li><p>Turn it into a recipe</p></li>
<li><p>Use <code>purrr::map()</code> to do it for all elements</p></li>
</ol>
<p>I’ll work through these three steps below using <code>my_list</code> and <code>tolower()</code></p>
<section id="do-it-for-one-element" class="level2">
<h2 class="anchored" data-anchor-id="do-it-for-one-element">1. Do it for one element</h2>
<p>The goal with the first step is to get a minimal working example with a single element from the object I want to iterate over (with the function I want to iterate with).</p>
<p>For this example, I need to subset <code>my_list</code> for a single element at position <code>[[1]]</code>, <code>[[2]]</code>, or <code>[[3]]</code> (or using one of the vector names).</p>
<p>I’ll then pass this element to <code>tolower()</code> and make sure it’s the desired behavior:</p>
<div style="font-size: 0.90em;">
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset an element from the list</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>? <span class="ot">&lt;-</span> my_list[[?]]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># apply a function to extracted element</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tolower</span>(?)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p><code>? &lt;- my_list[[?]]</code> = subset element from the list (<code>my_list</code>)</p></li>
<li><p><code>tolower(?)</code> = apply operation (i.e., function) to extracted element.</p></li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>my_words <span class="ot">&lt;-</span> my_list[[<span class="st">'words'</span>]]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tolower</span>(my_words)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "move"     "thursday" "sister"   "join"     "last"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Now that I have a working example for one element, in the next step I’ll abstract these parts into the function arguments.</p>
</section>
<section id="turn-it-into-a-recipe" class="level2">
<h2 class="anchored" data-anchor-id="turn-it-into-a-recipe">2. Turn it into a recipe</h2>
<p>A standard <code>purrr</code> recipe defines <code>.x</code> (the object) and <code>.f</code> (the function), followed by any additional function arguments.</p>
<ul>
<li><p><code>.x</code> = a list or atomic vector</p></li>
<li><p><code>.f</code> = the function we want to apply over every element in <code>.x</code></p></li>
</ul>
<div style="font-size: .90em;">
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>.x <span class="ot">=</span> my_list, .f <span class="ot">=</span> tolower</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="map-it-across-all-elements" class="level2">
<h2 class="anchored" data-anchor-id="map-it-across-all-elements">3. <code>map()</code> it across all elements</h2>
<p>In <code>purrr::map()</code>, the <code>.x</code> argument is the object (list or atomic vector) I want to iterate over, and <code>.f</code> is the function (i.e., operation) I want applied to every element of <code>.x</code></p>
<p>If I want to convert the case of every element in <code>my_list</code> to lowercase with <code>tolower()</code> I would use the following standard <code>purrr::map()</code> format:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> my_list, <span class="at">.f =</span> tolower)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="do">## $words</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "move"     "thursday" "sister"   "join"     "last"    </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $sentences</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "the theft of the pearl pin was kept secret."    </span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] "it snowed, rained, and hailed the same morning."</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] "it caught its hind paw in a rusty trap."        </span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $letters</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] "w" "g" "t" "q" "x" "s" "o" "p" "u" "l"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>And there you have it! <code>map()</code> is the core function and workhorse of the <code>purrr</code> package. It’s important to note that <code>purrr::map()</code> always returns a list, regardless of the object supplied to <code>.x</code>.</p>
</section>
</section>
<section id="version-1.0.0-updates" class="level1">
<h1><strong>Version 1.0.0 updates</strong></h1>
<p>Now I’ll cover some of the updates in <code>purrr</code> 1.0.0. I’ll be using <code>mixed_list</code>, a list with five different types of vectors.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mixed_list</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">## $booleans</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  TRUE FALSE  TRUE FALSE</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $integers</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  4  7  8  1 10</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $doubles</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2.909 2.938 2.853 2.755 2.990</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="do">## $strings</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "second" "commit" "red"    "except" "fire"  </span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="do">## $dates</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "2023-12-06" "2023-10-27" "2023-09-07"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<section id="map-updates" class="level2">
<h2 class="anchored" data-anchor-id="map-updates"><code>map()</code> updates</h2>
<p>As noted above, by default <code>purrr::map()</code> returns a list. If I’d like to return a vector, I can use one of the <code>map_</code> variations (there’s one for each vector type).</p>
<ul>
<li><p>By mapping the <code>is.&lt;type&gt;()</code> functions the elements in <code>mixed_list</code>, I can test which elements in <code>mixed_list</code> return <code>TRUE</code>:</p>
<ul>
<li><code>map_lgl()</code>: returns a logical vector</li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mixed_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map_lgl</span>(\(x) <span class="fu">is.logical</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>booleans integers  doubles  strings    dates 
    TRUE    FALSE    FALSE    FALSE    FALSE </code></pre>
</div>
</div>
</div>
<ul>
<li><code>map_int()</code>: returns an integer vector</li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mixed_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map_int</span>(\(x) <span class="fu">is.integer</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>booleans integers  doubles  strings    dates 
       0        1        0        0        0 </code></pre>
</div>
</div>
</div>
<ul>
<li><code>map_dbl()</code>: returns a double vector</li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mixed_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(\(x) <span class="fu">is.double</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>booleans integers  doubles  strings    dates 
       0        0        1        0        1 </code></pre>
</div>
</div>
</div>
<ul>
<li><code>map_chr()</code>: returns a character vector</li>
</ul>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mixed_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(\(x) <span class="fu">is.character</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Automatic coercion from logical to character was deprecated in purrr 1.0.0.
ℹ Please use an explicit call to `as.character()` within `map_chr()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>booleans integers  doubles  strings    dates 
 "FALSE"  "FALSE"  "FALSE"   "TRUE"  "FALSE" </code></pre>
</div>
</div>
</div></li>
</ul>
<p>When we test for characters in <code>mixed_list</code>, we see the following warning:</p>
<div style="font-size: 0.90em;">
<blockquote class="blockquote">
<p><code>Warning: Automatic coercion from logical to character was deprecated in purrr</code> <code>1.0.0. Please use an explicit call to as.character() within map_chr() instead</code></p>
</blockquote>
</div>
<p>As we can see from the output above, the logical return values from <code>is.character()</code> are coerced to characters (this behavior is now deprecated).</p>
<section id="map_vec" class="level3">
<h3 class="anchored" data-anchor-id="map_vec"><code>map_vec()</code></h3>
<p><br></p>
<p>However, the previous <code>purrr::map_raw()</code> function has been replaced with <code>purrr::map_vec()</code>, which “<em>simplifies to the common type of the output.</em>” I’ll demonstrate below with the characters in <code>mixed_list</code>:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mixed_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map_vec</span>(\(x) <span class="fu">is.character</span>(x))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="do">## booleans integers  doubles  strings    dates </span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    FALSE    FALSE    FALSE     TRUE    FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Notice the difference in output? The results are the same as above, but output is not commented (<code>##</code>). The same is true when I test the dates in <code>mixed_list</code> using <code>lubridate::is.Date()</code>:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>mixed_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map_vec</span>(\(x) lubridate<span class="sc">::</span><span class="fu">is.Date</span>(x))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="do">## booleans integers  doubles  strings    dates </span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    FALSE    FALSE    FALSE    FALSE     TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
<section id="anonymous-functions" class="level2">
<h2 class="anchored" data-anchor-id="anonymous-functions">Anonymous functions</h2>
<p>R introduced the shorthand anonymous function syntax in version <a href="https://cran.r-project.org/doc/manuals/r-devel/NEWS.html">4.1.0</a>:</p>
<blockquote class="blockquote">
<p>“<em><code>\(x) x + 1</code> is parsed as <code>function(x) x + 1</code>.</em>”</p>
</blockquote>
<p>Below is a comparison of an anonymous (unnamed) function and the updated shorthand syntax:</p>
<ul>
<li><p>Standard anonymous function</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>(<span class="cf">function</span>(x) <span class="fu">tolower</span>(x))(<span class="st">"pIrAtES Ship"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "pirates ship"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div></li>
<li><p>The updated anonymous syntax is below:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>(\(x) <span class="fu">tolower</span>(x))(<span class="st">"pIrAtES Ship"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "pirates ship"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div></li>
</ul>
<p>Writing the code above using an anonymous function would look like this:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>my_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map</span>(\(x) <span class="fu">tolower</span>(x))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="do">## $words</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "move"     "thursday" "sister"   "join"     "last"    </span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $sentences</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "the theft of the pearl pin was kept secret."    </span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] "it snowed, rained, and hailed the same morning."</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] "it caught its hind paw in a rusty trap."        </span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $letters</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] "w" "g" "t" "q" "x" "s" "o" "p" "u" "l"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Anonymous functions make it <em>easier to understand which arguments belong to which function and will tend to yield better error messages.</em></p>
<p>I’ll confirm the outputs from both methods are identical using <code>waldo::compare()</code>:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>waldo<span class="sc">::</span><span class="fu">compare</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> my_list, <span class="at">.f =</span> tolower), </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> my_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map</span>(\(x) <span class="fu">tolower</span>(x)))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ✔ No differences</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The formula (<code>~ .x + 1</code>)
</div>
</div>
<div class="callout-body-container callout-body">
<p><br></p>
<div style="font-size: 1.10em;">
<p>Prior to <code>purrr</code> v1.0.0, I could also use the formula syntax, but now it’s “<em>only recommended if you require backward compatibility with older versions of R.</em>” I’ll cover the formula syntax briefly because you’re likely to encounter it.</p>
</div>
<div style="font-size: 1.10em;">
<p>The formula syntax is typically used with pipes, so the contents of <code>purrr::map()</code> become the right-hand side of the formula, with the function we want to iterate (<code>&lt;FUNCTION&gt;</code>) and a placeholder (<code>.x</code>) in the appropriate argument.</p>
</div>
<div style="font-size: 1.20em;">
<div class="sourceCode" id="cb41"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>OBJECT<span class="op">&gt;</span> <span class="kw">|</span><span class="op">&gt;</span> purrr::map<span class="kw">(</span><span class="ex">~</span> <span class="op">&lt;</span>FUNCTION<span class="op">&gt;(</span><span class="ex">.x</span><span class="op">)</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="font-size: 1.10em;">
<p>For the example above, <code>my_list</code> is ‘piped’ to <code>purrr::map()</code>, where the formula maps the <code>tolower()</code> function (using the <code>.x</code> placeholder).</p>
</div>
<div style="font-size: 1.00em;">
<div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># written as normal expression</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a> my_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">tolower</span>(.x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="font-size: 1.10em;">
<p>Jenny Bryan offers a great description on <a href="https://jennybc.github.io/purrr-tutorial/ls03_map-function-syntax.html#anonymous_function,_formula">her <code>purrr</code> tutorial</a>,</p>
<blockquote class="blockquote">
<p>“<em>[formula syntax] should start with the <code>~</code> symbol and then look like a typical top-level expression, as you might write in a script. Use <code>.x</code> to refer to the input, i.e.&nbsp;an individual element of the primary vector or list.</em>”</p>
</blockquote>
<p>I can double-check to see that the output from two variations are identical using <code>waldo::compare()</code>.</p>
</div>
<div style="font-size: 1.00em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>waldo<span class="sc">::</span><span class="fu">compare</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> my_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map</span>(\(x) <span class="fu">tolower</span>(x)), </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> my_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">tolower</span>(.x)))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ✔ No differences</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<!--
# map for `data.frame` and `tibble`s

::: {style="font-size: 0.90em;"}

::: {.cell}

```{.r .cell-code}
swdata <- dplyr::select(dplyr::starwars, !where(is.list))
purrr::map_df(.x = swdata, .f = tolower)
## # A tibble: 87 × 11
##    name     height mass  hair_color skin_color eye_color birth_year sex   gender
##    <chr>    <chr>  <chr> <chr>      <chr>      <chr>     <chr>      <chr> <chr> 
##  1 luke sk… 172    77    blond      fair       blue      19         male  mascu…
##  2 c-3po    167    75    <NA>       gold       yellow    112        none  mascu…
##  3 r2-d2    96     32    <NA>       white, bl… red       33         none  mascu…
##  4 darth v… 202    136   none       white      yellow    41.9       male  mascu…
##  5 leia or… 150    49    brown      light      brown     19         fema… femin…
##  6 owen la… 178    120   brown, gr… light      blue      52         male  mascu…
##  7 beru wh… 165    75    brown      light      blue      47         fema… femin…
##  8 r5-d4    97     32    <NA>       white, red red       <NA>       none  mascu…
##  9 biggs d… 183    84    black      light      brown     24         male  mascu…
## 10 obi-wan… 182    77    auburn, w… fair       blue-gray 57         male  mascu…
## # ℹ 77 more rows
## # ℹ 2 more variables: homeworld <chr>, species <chr>
```
:::

:::
-->
</section>
</section>
<section id="worked-examples" class="level1">
<h1>Worked Examples</h1>
<p>In this section, I’ll be working through some of the uses I’ve for <code>purrr</code>’s functions. I’ve tried to choose tasks that are common across <em>most</em> projects so my code can be easily copied and adapted.</p>
<section id="downloading-files" class="level2">
<h2 class="anchored" data-anchor-id="downloading-files">Downloading files</h2>
<blockquote class="blockquote">
<p><em>You’d like to download a collection of files from separate URLS</em></p>
</blockquote>
<p>I have a collection of 30 .csv files from <a href="https://github.com/oreillymedia/doing_data_science">Doing Data Science</a> by Cathy O’Neil and Rachel Schutt (O’Reilly Media) in a <a href="https://github.com/mjfrigaard/dds-data">GitHub repo</a>. Let’s assume I want to download one week of these files into my RStudio session (without downloading the repo).</p>
<p>I’ll navigate to the raw url for the first data file (<code>nyt1.csv</code>), then paste this into a character vector:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>nyt_url <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt1.csv"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Knowing that all of the files on GitHub with have a similar sheme and domain, I can use <code>nyt_url</code> to generate urls for each of the 7 files.</p>
<ol type="1">
<li>First I get the folder of the files on GitHub with <code>fs::path_dir()</code></li>
</ol>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create file urls </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>nyt_dir_url <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">path_dir</span>(nyt_url)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>nyt_dir_url</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https:/raw.githubusercontent.com/mjfrigaard/dds-data/main"</code></pre>
</div>
</div>
</div>
<ol start="2" type="1">
<li>I create a vector with the 7 file names</li>
</ol>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create file names for 7th through 13th</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>nyt_file_nms <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"nyt"</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">13</span>, <span class="st">".csv"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>nyt_file_nms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "nyt7.csv"  "nyt8.csv"  "nyt9.csv"  "nyt10.csv" "nyt11.csv" "nyt12.csv"
[7] "nyt13.csv"</code></pre>
</div>
</div>
</div>
<ol start="3" type="1">
<li>I combine the directory portion of the url with file name in <code>nyt_file_urls</code></li>
</ol>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>nyt_file_urls <span class="ot">&lt;-</span> <span class="fu">paste</span>(nyt_dir_url, nyt_file_nms, <span class="at">sep =</span> <span class="st">"/"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>nyt_file_urls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https:/raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt7.csv" 
[2] "https:/raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt8.csv" 
[3] "https:/raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt9.csv" 
[4] "https:/raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt10.csv"
[5] "https:/raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt11.csv"
[6] "https:/raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt12.csv"
[7] "https:/raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt13.csv"</code></pre>
</div>
</div>
</div>
<p>I’ll need another vector of destination file names on my local machine, which I can do by combining the file names (<code>nyt_file_nms</code>) with the local destination folder (<code>dds-nyt</code>).</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>nyt_local_pths <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"dds-nyt"</span>, nyt_file_nms, <span class="at">sep =</span> <span class="st">"/"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>nyt_local_pths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "dds-nyt/nyt7.csv"  "dds-nyt/nyt8.csv"  "dds-nyt/nyt9.csv" 
[4] "dds-nyt/nyt10.csv" "dds-nyt/nyt11.csv" "dds-nyt/nyt12.csv"
[7] "dds-nyt/nyt13.csv"</code></pre>
</div>
</div>
</div>
<p>After creating the destination folder, I’ll use the <code>download.file()</code> function to test downloading a single <code>.csv</code> files into my local folder (<code>dds-nyt/</code>). <code>download.file()</code> has a progress bar which tells me if the file downloaded successfully.</p>
<div style="font-size: 0.90em;">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do it for one</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_create</span>(<span class="st">"dds-nyt"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> nyt_file_urls[<span class="dv">1</span>], <span class="at">destfile =</span> nyt_local_pths[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="ex">trying</span> URL <span class="st">'https:/raw.githubusercontent.com/mjfrigaard/dds-data/main/nyt1.csv'</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Content</span> type <span class="st">'text/plain; charset=utf-8'</span> length 4920381 bytes <span class="er">(</span><span class="ex">4.7</span> MB<span class="kw">)</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="ex">==================================================</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="ex">downloaded</span> 4.7 MB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>download.file()</code> takes two inputs (<code>url</code> and <code>destfile</code>), which changes the recipe a bit, because I need a <code>purrr</code> function with the following:</p>
<ol type="1">
<li><p><code>.x</code> the input vector of existing url paths</p></li>
<li><p><code>.y</code> the output vector of destination file paths</p></li>
<li><p>Additional arguments passed from <code>download.file()</code> (like <code>quiet = TRUE</code>)</p></li>
</ol>
<p>In this case, I don’t need <code>purrr</code> to return value–I just need the <code>purrr</code> function to iterate over the items and write them to the new location.</p>
<p><code>walk()</code> is ideal for this circumstance:</p>
<blockquote class="blockquote">
<p>“<em><code>walk()</code> returns the input <code>.x</code> (invisibly)</em>” and “<em>The return value of <code>.f()</code> is ignored</em>”</p>
</blockquote>
<p><strong><em>What do ‘return <code>.x</code> invisibly’ and ‘the side-effect of <code>.f</code>’ mean?</em></strong></p>
<section id="return-invisibly" class="level3">
<h3 class="anchored" data-anchor-id="return-invisibly">Return invisibly</h3>
<p>The previous <code>purrr</code> functions I covered varied in the kinds of values they returned (lists vs.&nbsp;vectors), but for some operations I won’t need a return value. If I’m ever curious about whether I should be using <code>map()</code> or <code>walk()</code>, I’ll ask myself, <em>“would it make sense to assign the output from this function to an object?</em>”</p>
<p>If the answer is no, then I probably need to be thinking <code>walk()</code> instead of <code>map()</code></p>
</section>
<section id="side-effects" class="level3">
<h3 class="anchored" data-anchor-id="side-effects">Side-effects</h3>
<p>In the help documentation <code>walk()</code>’s description states, “<em>calls .f for its side-effect</em>”, which can be generally interpreted as, “<em>there’s nothing to assign the output from that function to.</em>”</p>
</section>
<section id="purrr-progress-bars" class="level3">
<h3 class="anchored" data-anchor-id="purrr-progress-bars"><code>purrr</code> progress bars</h3>
<p>I’ll use <code>walk2()</code> below and add <code>.progress = TRUE</code> to view the <code>purrr</code> progress bar (and <code>quiet = TRUE</code> to silence the <code>download.file()</code> progress bar).</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(<span class="at">.x =</span> nyt_file_urls, <span class="at">.y =</span> nyt_local_pths, <span class="at">.f =</span>  download.file, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">.progress =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p><br></p>
<div class="cell" data-layout-align="center" data-fig.asp="0.618">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="purrr-progress.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="purrr-progress.gif" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>I can confirm the download using <code>fs::dir_tree()</code></p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_tree</span>(<span class="st">"dds-nyt"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="do">## dds-nyt</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt10.csv</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt11.csv</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt12.csv</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt13.csv</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt7.csv</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt8.csv</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="do">## └── nyt9.csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
<section id="copying-a-directory-of-files" class="level2">
<h2 class="anchored" data-anchor-id="copying-a-directory-of-files">Copying a directory of files</h2>
<blockquote class="blockquote">
<p><em>You have a folder of files you’d like to rename or copy to a new directory</em></p>
</blockquote>
<p>The collection of 7 .csv files from <a href="https://github.com/oreillymedia/doing_data_science">Doing Data Science</a> by Cathy O’Neil and Rachel Schutt (O’Reilly Media) are now in the <code>dds-nyt/</code> folder.</p>
<p>As with any project, I don’t want to alter the raw data, so I’m going to copy these files into <code>dds-nyt-raw/</code> and <code>dds-nyt-processed/</code>. I also want the processed file names to have a date stamp prefix.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>file_pths <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"dds-nyt"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">".csv$"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>file_pths</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "dds-nyt/nyt10.csv" "dds-nyt/nyt11.csv" "dds-nyt/nyt12.csv"</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [4] "dds-nyt/nyt13.csv" "dds-nyt/nyt7.csv"  "dds-nyt/nyt8.csv" </span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [7] "dds-nyt/nyt9.csv"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I’ll start with the raw data folder. I need to create a vector of the new raw file paths and names: <code>raw_file_pths</code> (the raw data paths will have the original file names)</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do it for one</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">"^dds-nyt"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">replacement =</span> <span class="st">"dds-nyt/raw"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> file_pths[<span class="dv">1</span>])</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "dds-nyt/raw/nyt10.csv"</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># write the recipe</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>file_pths <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(\(x) <span class="fu">gsub</span>(x, </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">pattern =</span> <span class="st">"^dds-nyt"</span>, </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">replacement =</span> <span class="st">"dds-nyt/raw"</span>)) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "dds-nyt/raw/nyt10.csv" "dds-nyt/raw/nyt11.csv" "dds-nyt/raw/nyt12.csv"</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [4] "dds-nyt/raw/nyt13.csv" "dds-nyt/raw/nyt7.csv"  "dds-nyt/raw/nyt8.csv"</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co"># map it across all</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>raw_file_pths <span class="ot">&lt;-</span> file_pths <span class="sc">|&gt;</span> </span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>                  purrr<span class="sc">::</span><span class="fu">map_chr</span>(\(x) <span class="fu">gsub</span>(x, </span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">pattern =</span> <span class="st">"^dds-nyt"</span>, </span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">replacement =</span> <span class="st">"dds-nyt/raw"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Before copying the files, I need to create the destination folder for the raw data (<code>dds-nyt/raw</code>). Then, I’ll make sure I can copy the first element from <code>file_pths</code> into the path in the first element of <code>raw_file_pths</code>:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_create</span>(<span class="st">"dds-nyt/raw"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># do it for one</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">file_copy</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> file_pths[<span class="dv">1</span>], </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_path =</span> raw_file_pths[<span class="dv">1</span>], </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_tree</span>(<span class="st">"dds-nyt/raw"</span>, <span class="at">type =</span> <span class="st">"any"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="do">## dds-nyt/raw</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="do">## └── nyt10.csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I can see this is working, so I can use <code>purrr::walk2()</code> to move all the files from <code>dds-nyt/</code> to <code>dds-nyt/raw/</code></p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk2</span>(<span class="at">.x =</span> file_pths, <span class="at">.y =</span> raw_file_pths, <span class="at">.f =</span> fs<span class="sc">::</span>file_copy, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">.progress =</span> <span class="cn">TRUE</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_tree</span>(<span class="st">"dds-nyt/raw"</span>, <span class="at">type =</span> <span class="st">"any"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="do">## dds-nyt/raw</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt10.csv</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt11.csv</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt12.csv</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt13.csv</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt7.csv</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── nyt8.csv</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="do">## └── nyt9.csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Now that I’ve copied the files into their respective folders, I’ll need to remove the files from their original location in the parent <code>dds-nyt</code> folder.</p>
<p>Fortunately, I have a vector of these files in <code>file_pths</code>, and I can test removal with <code>fs::file_delete()</code>:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">file_delete</span>(file_pths[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Great! Now that I know this will work, I’ll use <code>walk()</code> because I want <code>.x</code> returned invisibly and the side-effect of <code>.f</code>.</p>
<p>But I’ve also deleted the first element in <code>file_pths</code>, so when <code>fs::file_delete()</code> goes looking for that file, it will find nothing and returned an error.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Error</span> in <span class="kw">`</span><span class="fu">map()</span><span class="kw">`</span>:</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ℹ</span> In index: 1.</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Caused</span> by error:</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="ot">! </span><span class="ex">[ENOENT]</span> Failed to remove <span class="st">'dds-nyt/nyt10.csv'</span>: no such file or directory</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I can protect against this by supplying the output from <code>list.files()</code> directly to <code>purrr::walk2()</code>, but include a <code>pattern</code> so it only matches the <code>.csv</code> files.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">:::</span><span class="fu">walk</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># list CURRENT files </span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> <span class="fu">list.files</span>(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">path =</span> <span class="st">"dds-nyt"</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">pattern =</span> <span class="st">".csv$"</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">full.names =</span> <span class="cn">TRUE</span>),</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># map function</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> fs<span class="sc">::</span>file_delete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>And confirm the new folder contents and structure</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_tree</span>(<span class="st">"dds-nyt"</span>, <span class="at">type =</span> <span class="st">"any"</span>, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="do">## dds-nyt</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="do">## └── raw</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt10.csv</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt11.csv</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt12.csv</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt13.csv</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt7.csv</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt8.csv</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="do">##     └── nyt9.csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="import-multiple-datasets" class="level2">
<h2 class="anchored" data-anchor-id="import-multiple-datasets">Import multiple datasets</h2>
<blockquote class="blockquote">
<p><em>You have several days of data, and each day is contained in separate file. You’d like to read these data into R, and combine them into a single dataset</em></p>
</blockquote>
<p>Now that I have separate raw and processed folders, I can import the NYT data into R. Below I’ve imported a single file from the <code>raw</code> data folder to examine it’s contents:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>nyt1 <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="at">file =</span> raw_file_pths[<span class="dv">1</span>],</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">delim =</span> <span class="st">","</span>, </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(nyt1)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="do">## spc_tbl_ [452,766 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ Age        : num [1:452766] 59 0 19 44 30 33 41 41 0 23 ...</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ Gender     : num [1:452766] 1 0 0 1 1 1 0 0 0 1 ...</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ Impressions: num [1:452766] 4 7 5 5 4 3 1 3 9 1 ...</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ Clicks     : num [1:452766] 0 1 0 0 0 0 0 0 1 0 ...</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ Signed_In  : num [1:452766] 1 0 1 1 1 1 1 1 0 1 ...</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  - attr(*, "spec")=</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. cols(</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Age = col_double(),</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Gender = col_double(),</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Impressions = col_double(),</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Clicks = col_double(),</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Signed_In = col_double(),</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   .delim = ","</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. )</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  - attr(*, "problems")=&lt;externalptr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Each <code>nyt</code> file contains daily ads shown and clicks recorded on the New York Times home page. The rows represent users, and the variables are: <code>Age</code>, <code>Gender</code> (0 = female, 1 = male), <code>Impressions</code> (number impressions), <code>Clicks</code> (number clicks), and a binary indicator for signed in or not <code>Signed_in</code>.</p>
<p>I’ll add some hypothetical wrangling steps to make this example more realistic.</p>
<ol type="1">
<li><p>Create <code>age_group</code>, an ordered factor which contains six levels of Age (“&lt;18”, “18-24”, “25-34”, “35-44”, “45-54”, “55-64”, and “65+”)</p></li>
<li><p>Create <code>ctr_rate</code> or click-through rate, calculated as the number of clicks / the number of impressions. Round it to 3 digits.</p></li>
<li><p>Create <code>female</code>, a factor version of <code>Gender</code>, where when <code>Gender</code> = <code>0</code>, then <code>female</code> = <code>"yes"</code>, and when <code>Gender</code> = <code>1</code>, then <code>female</code> = <code>"no"</code></p></li>
<li><p>Create <code>signed_in</code>, a factor variable with levels <code>"no"</code> and <code>"yes"</code> from the <code>Signed_In</code> = <code>0</code> and <code>1</code></p></li>
</ol>
<p>I’ve bundled all of these steps into a function (<code>nyt_data_processing()</code>) that I can pass each dataset through:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>nyt_data_processing <span class="ot">&lt;-</span> <span class="cf">function</span>(nyt_csv) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  orig_nms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"Gender"</span>, <span class="st">"Impressions"</span>, <span class="st">"Clicks"</span>, <span class="st">"Signed_In"</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  nyt_nms <span class="ot">&lt;-</span> <span class="fu">names</span>(nyt_csv)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">isFALSE</span>(<span class="fu">identical</span>(<span class="at">x =</span> orig_nms, <span class="at">y =</span> nyt_nms))) {</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    cli<span class="sc">::</span><span class="fu">cli_abort</span>(<span class="st">"these data don't have the correct columns!"</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    nyt_proc <span class="ot">&lt;-</span> nyt_csv <span class="sc">|&gt;</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create age_group variable</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">age_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>          Age <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"&lt;18"</span>,</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>          Age <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="st">"18-24"</span>,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>          Age <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">"25-34"</span>,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>          Age <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"35-44"</span>,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>          Age <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">55</span> <span class="sc">~</span> <span class="st">"45-54"</span>,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>          Age <span class="sc">&gt;=</span> <span class="dv">55</span> <span class="sc">&amp;</span> Age <span class="sc">&lt;</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">"55-64"</span>,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>          Age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">"65+"</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># factor age_group (ordered)</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">age_group =</span> <span class="fu">factor</span>(age_group,</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"&lt;18"</span>, <span class="st">"18-24"</span>, <span class="st">"25-34"</span>,</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">"35-44"</span>, <span class="st">"45-54"</span>, <span class="st">"55-64"</span>, <span class="st">"65+"</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create CTR variable</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">ctr_rate =</span> <span class="fu">round</span>(<span class="at">x =</span> Clicks <span class="sc">/</span> Impressions, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create new Female variable</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">female =</span> <span class="fu">case_when</span>(</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>          Gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"yes"</span>,</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>          Gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"no"</span>,</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># factor female (un-ordered)</span></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">female =</span> <span class="fu">factor</span>(female,</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>)</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">Signed_In =</span> <span class="fu">case_when</span>(</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>          Signed_In <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"no"</span>, </span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>          Signed_In <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"yes"</span>, </span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>),</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># factor Signed_In (un-ordered) </span></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">Signed_In =</span> <span class="fu">factor</span>(Signed_In, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"yes"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>      <span class="co"># format columns</span></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>      janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(nyt_proc)</span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I’ll do some quick checks to make sure it only works with the raw data columns:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>nyt1_proc <span class="ot">&lt;-</span> <span class="fu">nyt_data_processing</span>(nyt1)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(nyt1_proc)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="do">## spc_tbl_ [452,766 × 8] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ age        : num [1:452766] 59 0 19 44 30 33 41 41 0 23 ...</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ gender     : num [1:452766] 1 0 0 1 1 1 0 0 0 1 ...</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ impressions: num [1:452766] 4 7 5 5 4 3 1 3 9 1 ...</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ clicks     : num [1:452766] 0 1 0 0 0 0 0 0 1 0 ...</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ signed_in  : Factor w/ 2 levels "no","yes": 2 1 2 2 2 2 2 2 1 2 ...</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ age_group  : Ord.factor w/ 7 levels "&lt;18"&lt;"18-24"&lt;..: 6 1 2 4 3 3 4 4 1 2 ...</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ ctr_rate   : num [1:452766] 0 0.143 0 0 0 0 0 0 0.111 0 ...</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ female     : Factor w/ 2 levels "no","yes": 1 2 2 1 1 1 2 2 2 1 ...</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  - attr(*, "spec")=</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. cols(</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Age = col_double(),</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Gender = col_double(),</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Impressions = col_double(),</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Clicks = col_double(),</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   Signed_In = col_double(),</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..   .delim = ","</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. )</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  - attr(*, "problems")=&lt;externalptr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I’ll run <code>nyt_data_processing()</code> against a processed data file (<code>nyt1_proc</code>)</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nyt_data_processing</span>(nyt1_proc)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in `nyt_data_processing()`:</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ! these data don't have the correct columns!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Now I’m ready to write the import step. First I’ll store the raw file paths in <code>raw_data_pths</code></p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>raw_data_pths <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"dds-nyt/raw"</span>, <span class="at">pattern =</span> <span class="st">".csv$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>We’ll test <code>purrr::map()</code> and <code>vroom::vroom()</code> to import the <code>.csv</code> files in <code>raw_data_pths</code> into a list. I also add <code>utils::head()</code> and <code>dplyr::glimpse()</code> to limit the output.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>raw_data_pths <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># import</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    vroom<span class="sc">::</span>vroom, </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  utils<span class="sc">::</span><span class="fu">head</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="do">## List of 2</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ : spc_tbl_ [452,766 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Age        : num [1:452766] 59 0 19 44 30 33 41 41 0 23 ...</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Gender     : num [1:452766] 1 0 0 1 1 1 0 0 0 1 ...</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Impressions: num [1:452766] 4 7 5 5 4 3 1 3 9 1 ...</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Clicks     : num [1:452766] 0 1 0 0 0 0 0 0 1 0 ...</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Signed_In  : num [1:452766] 1 0 1 1 1 1 1 1 0 1 ...</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "spec")=</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. cols(</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Age = col_double(),</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Gender = col_double(),</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Impressions = col_double(),</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Clicks = col_double(),</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Signed_In = col_double(),</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   .delim = ","</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. )</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "problems")=&lt;externalptr&gt; </span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ : spc_tbl_ [478,066 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Age        : num [1:478066] 28 51 29 20 19 0 58 42 35 44 ...</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Gender     : num [1:478066] 1 0 1 1 0 0 0 0 1 0 ...</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Impressions: num [1:478066] 8 5 2 4 5 3 5 6 8 4 ...</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Clicks     : num [1:478066] 0 0 0 0 0 1 1 0 0 0 ...</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Signed_In  : num [1:478066] 1 1 1 1 1 0 1 1 1 1 ...</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "spec")=</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. cols(</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Age = col_double(),</span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Gender = col_double(),</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Impressions = col_double(),</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Clicks = col_double(),</span></span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Signed_In = col_double(),</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   .delim = ","</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. )</span></span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "problems")=&lt;externalptr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>This returns a list, but you may have noticed I don’t have a great way for keeping track of the data files in the list–this is where <code>purrr::set_names()</code> comes in handy.</p>
<p><code>purrr::set_names()</code> works a lot like <code>names()</code>, but <code>purrr::set_names()</code> will automatically set the names of <code>x</code> to <code>as.character(x)</code> if no names are provided to <code>nm</code>. See below:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>raw_data_pths <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">set_names</span>()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   dds-nyt/raw/nyt10.csv   dds-nyt/raw/nyt11.csv   dds-nyt/raw/nyt12.csv </span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="do">## "dds-nyt/raw/nyt10.csv" "dds-nyt/raw/nyt11.csv" "dds-nyt/raw/nyt12.csv" </span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   dds-nyt/raw/nyt13.csv    dds-nyt/raw/nyt7.csv    dds-nyt/raw/nyt8.csv </span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="do">## "dds-nyt/raw/nyt13.csv"  "dds-nyt/raw/nyt7.csv"  "dds-nyt/raw/nyt8.csv" </span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    dds-nyt/raw/nyt9.csv </span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  "dds-nyt/raw/nyt9.csv"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Now the imported file will have their file path and name associated with the dataset:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>raw_data_pths <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names </span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># import  </span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>      vroom<span class="sc">::</span>vroom, </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  utils<span class="sc">::</span><span class="fu">head</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="do">## List of 2</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ dds-nyt/raw/nyt10.csv: spc_tbl_ [452,766 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Age        : num [1:452766] 59 0 19 44 30 33 41 41 0 23 ...</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Gender     : num [1:452766] 1 0 0 1 1 1 0 0 0 1 ...</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Impressions: num [1:452766] 4 7 5 5 4 3 1 3 9 1 ...</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Clicks     : num [1:452766] 0 1 0 0 0 0 0 0 1 0 ...</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Signed_In  : num [1:452766] 1 0 1 1 1 1 1 1 0 1 ...</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "spec")=</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. cols(</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Age = col_double(),</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Gender = col_double(),</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Impressions = col_double(),</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Clicks = col_double(),</span></span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Signed_In = col_double(),</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   .delim = ","</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. )</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "problems")=&lt;externalptr&gt; </span></span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ dds-nyt/raw/nyt11.csv: spc_tbl_ [478,066 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Age        : num [1:478066] 28 51 29 20 19 0 58 42 35 44 ...</span></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Gender     : num [1:478066] 1 0 1 1 0 0 0 0 1 0 ...</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Impressions: num [1:478066] 8 5 2 4 5 3 5 6 8 4 ...</span></span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Clicks     : num [1:478066] 0 0 0 0 0 1 1 0 0 0 ...</span></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ Signed_In  : num [1:478066] 1 1 1 1 1 0 1 1 1 1 ...</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "spec")=</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. cols(</span></span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Age = col_double(),</span></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Gender = col_double(),</span></span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Impressions = col_double(),</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Clicks = col_double(),</span></span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Signed_In = col_double(),</span></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   .delim = ","</span></span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. )</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "problems")=&lt;externalptr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>To add the wrangling function, I can pipe in another call to <code>purrr::map()</code>, and add <code>nyt_data_processing()</code>.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>raw_data_pths <span class="sc">|&gt;</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names </span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># import </span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>      vroom<span class="sc">::</span>vroom, </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle </span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.f =</span> nyt_data_processing) <span class="sc">|&gt;</span> </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  utils<span class="sc">::</span><span class="fu">head</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="do">## List of 2</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ dds-nyt/raw/nyt10.csv: spc_tbl_ [452,766 × 8] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ age        : num [1:452766] 59 0 19 44 30 33 41 41 0 23 ...</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ gender     : num [1:452766] 1 0 0 1 1 1 0 0 0 1 ...</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ impressions: num [1:452766] 4 7 5 5 4 3 1 3 9 1 ...</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ clicks     : num [1:452766] 0 1 0 0 0 0 0 0 1 0 ...</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ signed_in  : Factor w/ 2 levels "no","yes": 2 1 2 2 2 2 2 2 1 2 ...</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ age_group  : Ord.factor w/ 7 levels "&lt;18"&lt;"18-24"&lt;..: 6 1 2 4 3 3 4 4 1 2 ...</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ ctr_rate   : num [1:452766] 0 0.143 0 0 0 0 0 0 0.111 0 ...</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ female     : Factor w/ 2 levels "no","yes": 1 2 2 1 1 1 2 2 2 1 ...</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "spec")=</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. cols(</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Age = col_double(),</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Gender = col_double(),</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Impressions = col_double(),</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Clicks = col_double(),</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Signed_In = col_double(),</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   .delim = ","</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. )</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "problems")=&lt;externalptr&gt; </span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="do">##  $ dds-nyt/raw/nyt11.csv: spc_tbl_ [478,066 × 8] (S3: spec_tbl_df/tbl_df/tbl/data.frame)</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ age        : num [1:478066] 28 51 29 20 19 0 58 42 35 44 ...</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ gender     : num [1:478066] 1 0 1 1 0 0 0 0 1 0 ...</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ impressions: num [1:478066] 8 5 2 4 5 3 5 6 8 4 ...</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ clicks     : num [1:478066] 0 0 0 0 0 1 1 0 0 0 ...</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ signed_in  : Factor w/ 2 levels "no","yes": 2 2 2 2 2 1 2 2 2 2 ...</span></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ age_group  : Ord.factor w/ 7 levels "&lt;18"&lt;"18-24"&lt;..: 3 5 3 2 2 1 6 4 4 4 ...</span></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ ctr_rate   : num [1:478066] 0 0 0 0 0 0.333 0.2 0 0 0 ...</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..$ female     : Factor w/ 2 levels "no","yes": 1 2 1 1 2 2 2 2 1 2 ...</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "spec")=</span></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. cols(</span></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Age = col_double(),</span></span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Gender = col_double(),</span></span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Impressions = col_double(),</span></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Clicks = col_double(),</span></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   Signed_In = col_double(),</span></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. ..   .delim = ","</span></span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a><span class="do">##   .. .. )</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a><span class="do">##   ..- attr(*, "problems")=&lt;externalptr&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<section id="list_rbind" class="level3">
<h3 class="anchored" data-anchor-id="list_rbind"><code>list_rbind()</code></h3>
<p>For the final step, I’ll bind all the data into a <code>data.frame</code> with the updated <code>purrr::list_rbind()</code> function (set <code>names_to = "id"</code>).</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>raw_data_pths <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names </span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># import </span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>      vroom<span class="sc">::</span>vroom, </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle </span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.f =</span> nyt_data_processing) <span class="sc">|&gt;</span> </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bind</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">list_rbind</span>(<span class="at">names_to =</span> <span class="st">"id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 3,488,345</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 9</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="do">## $ id          &lt;chr&gt; "dds-nyt/raw/nyt10.csv", "dds-nyt/raw/nyt10.csv", "dds-nyt…</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age         &lt;dbl&gt; 59, 0, 19, 44, 30, 33, 41, 41, 0, 23, 28, 34, 0, 17, 33, 6…</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="do">## $ gender      &lt;dbl&gt; 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0…</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="do">## $ impressions &lt;dbl&gt; 4, 7, 5, 5, 4, 3, 1, 3, 9, 1, 4, 4, 7, 3, 7, 6, 6, 2, 7, 2…</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="do">## $ clicks      &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="do">## $ signed_in   &lt;fct&gt; yes, no, yes, yes, yes, yes, yes, yes, no, yes, yes, yes, …</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age_group   &lt;ord&gt; 55-64, &lt;18, 18-24, 35-44, 25-34, 25-34, 35-44, 35-44, &lt;18,…</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="do">## $ ctr_rate    &lt;dbl&gt; 0.000, 0.143, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.…</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="do">## $ female      &lt;fct&gt; no, yes, yes, no, no, no, yes, yes, yes, no, no, no, yes, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Now that we have a complete recipe, I store the result in <code>nyt_data_proc</code>. I can also confirm all files were imported and wrangled by checking the <code>count()</code> of <code>id</code>.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>nyt_data_proc <span class="ot">&lt;-</span> raw_data_pths <span class="sc">|&gt;</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names </span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># import </span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>      vroom<span class="sc">::</span>vroom, </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle </span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.f =</span> nyt_data_processing) <span class="sc">|&gt;</span> </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bind</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">list_rbind</span>(<span class="at">names_to =</span> <span class="st">"id"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>nyt_data_proc <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">count</span>(id)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 7 × 2</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   id                         n</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                  &lt;int&gt;</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 dds-nyt/raw/nyt10.csv 452766</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 dds-nyt/raw/nyt11.csv 478066</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 dds-nyt/raw/nyt12.csv 396308</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 dds-nyt/raw/nyt13.csv 786044</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 dds-nyt/raw/nyt7.csv  452493</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 dds-nyt/raw/nyt8.csv  463196</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 dds-nyt/raw/nyt9.csv  459472</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
<section id="export-multiple-datasets" class="level2">
<h2 class="anchored" data-anchor-id="export-multiple-datasets">Export multiple datasets</h2>
<blockquote class="blockquote">
<p><em>You have a dataset you’d like to split into individual <code>data.frame</code>s, then export these into separate file paths</em></p>
</blockquote>
<p>I have a processed dataset with seven data files (<code>nyt_data_proc</code>), and I want to export these into seven processed data files in a <code>dds-nyt/processed/</code> folder.</p>
<p>Creating a vector of processed data file paths is a little more involved because I wanted to add a date prefix to the exported files, and because I want to add this path as a variable <em>in the <code>nyt_data_proc</code> dataset</em>.</p>
<p>Below I create a new <code>file_nm</code> and <code>proc_file_pth</code> column to <code>nyt_data_proc</code>:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create file names </span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>nyt_data_proc <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">.data =</span> nyt_data_proc,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">file_nm =</span> tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>(base<span class="sc">::</span><span class="fu">basename</span>(id)),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">proc_file_pth =</span> <span class="fu">paste0</span>(<span class="st">"dds-nyt/processed/"</span>, </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">as.character</span>(<span class="fu">Sys.Date</span>()), <span class="st">"-"</span>, </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                        file_nm))</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>nyt_data_proc <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">count</span>(proc_file_pth)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 7 × 2</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   proc_file_pth                           n</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                               &lt;int&gt;</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 dds-nyt/processed/2023-12-16-nyt10 452766</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 dds-nyt/processed/2023-12-16-nyt11 478066</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 dds-nyt/processed/2023-12-16-nyt12 396308</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 dds-nyt/processed/2023-12-16-nyt13 786044</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 dds-nyt/processed/2023-12-16-nyt7  452493</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 dds-nyt/processed/2023-12-16-nyt8  463196</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 dds-nyt/processed/2023-12-16-nyt9  459472</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Note that I don’t include the file extension in <code>proc_file_pth</code>, because I might want to use different file types when I’m exporting.</p>
<p>I’ll cover two methods for exporting datasets from a list.</p>
<p>In this first method, I’ll use the <code>base::split()</code> function to split <code>nyt_data_proc</code> by the <code>proc_file_pth</code> variable into a list of data frames. I’ll also use <code>utils::head()</code>, <code>purrr::walk()</code>, and <code>dplyr::glimpse()</code> to view the output.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">split</span>(<span class="at">x =</span> nyt_data_proc, <span class="at">f =</span> nyt_data_proc<span class="sc">$</span>proc_file_pth) <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  utils<span class="sc">::</span><span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">walk</span>(<span class="at">.f =</span> glimpse)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 452,766</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 11</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="do">## $ id            &lt;chr&gt; "dds-nyt/raw/nyt10.csv", "dds-nyt/raw/nyt10.csv", "dds-n…</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age           &lt;dbl&gt; 59, 0, 19, 44, 30, 33, 41, 41, 0, 23, 28, 34, 0, 17, 33,…</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $ gender        &lt;dbl&gt; 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0,…</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="do">## $ impressions   &lt;dbl&gt; 4, 7, 5, 5, 4, 3, 1, 3, 9, 1, 4, 4, 7, 3, 7, 6, 6, 2, 7,…</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $ clicks        &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="do">## $ signed_in     &lt;fct&gt; yes, no, yes, yes, yes, yes, yes, yes, no, yes, yes, yes…</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age_group     &lt;ord&gt; 55-64, &lt;18, 18-24, 35-44, 25-34, 25-34, 35-44, 35-44, &lt;1…</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="do">## $ ctr_rate      &lt;dbl&gt; 0.000, 0.143, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, …</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="do">## $ female        &lt;fct&gt; no, yes, yes, no, no, no, yes, yes, yes, no, no, no, yes…</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="do">## $ file_nm       &lt;chr&gt; "nyt10", "nyt10", "nyt10", "nyt10", "nyt10", "nyt10", "n…</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="do">## $ proc_file_pth &lt;chr&gt; "dds-nyt/processed/2023-12-16-nyt10", "dds-nyt/processed…</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 478,066</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 11</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="do">## $ id            &lt;chr&gt; "dds-nyt/raw/nyt11.csv", "dds-nyt/raw/nyt11.csv", "dds-n…</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age           &lt;dbl&gt; 28, 51, 29, 20, 19, 0, 58, 42, 35, 44, 62, 20, 0, 0, 43,…</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a><span class="do">## $ gender        &lt;dbl&gt; 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a><span class="do">## $ impressions   &lt;dbl&gt; 8, 5, 2, 4, 5, 3, 5, 6, 8, 4, 6, 4, 5, 4, 4, 5, 3, 2, 5,…</span></span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a><span class="do">## $ clicks        &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2,…</span></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a><span class="do">## $ signed_in     &lt;fct&gt; yes, yes, yes, yes, yes, no, yes, yes, yes, yes, yes, ye…</span></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age_group     &lt;ord&gt; 25-34, 45-54, 25-34, 18-24, 18-24, &lt;18, 55-64, 35-44, 35…</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a><span class="do">## $ ctr_rate      &lt;dbl&gt; 0.000, 0.000, 0.000, 0.000, 0.000, 0.333, 0.200, 0.000, …</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a><span class="do">## $ female        &lt;fct&gt; no, yes, no, no, yes, yes, yes, yes, no, yes, yes, yes, …</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a><span class="do">## $ file_nm       &lt;chr&gt; "nyt11", "nyt11", "nyt11", "nyt11", "nyt11", "nyt11", "n…</span></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a><span class="do">## $ proc_file_pth &lt;chr&gt; "dds-nyt/processed/2023-12-16-nyt11", "dds-nyt/processed…</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 396,308</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 11</span></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a><span class="do">## $ id            &lt;chr&gt; "dds-nyt/raw/nyt12.csv", "dds-nyt/raw/nyt12.csv", "dds-n…</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age           &lt;dbl&gt; 29, 0, 27, 0, 69, 0, 0, 39, 53, 27, 0, 13, 26, 63, 79, 0…</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a><span class="do">## $ gender        &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1,…</span></span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a><span class="do">## $ impressions   &lt;dbl&gt; 4, 1, 2, 5, 9, 1, 6, 4, 7, 3, 1, 1, 2, 5, 6, 7, 3, 1, 5,…</span></span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a><span class="do">## $ clicks        &lt;dbl&gt; 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,…</span></span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a><span class="do">## $ signed_in     &lt;fct&gt; yes, no, yes, no, yes, no, no, yes, yes, yes, no, yes, y…</span></span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age_group     &lt;ord&gt; 25-34, &lt;18, 25-34, &lt;18, 65+, &lt;18, &lt;18, 35-44, 45-54, 25-…</span></span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a><span class="do">## $ ctr_rate      &lt;dbl&gt; 0.250, 0.000, 0.000, 0.200, 0.111, 0.000, 0.000, 0.000, …</span></span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a><span class="do">## $ female        &lt;fct&gt; yes, yes, yes, yes, no, yes, yes, no, yes, no, yes, no, …</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a><span class="do">## $ file_nm       &lt;chr&gt; "nyt12", "nyt12", "nyt12", "nyt12", "nyt12", "nyt12", "n…</span></span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a><span class="do">## $ proc_file_pth &lt;chr&gt; "dds-nyt/processed/2023-12-16-nyt12", "dds-nyt/processed…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I can see this is returning a list of data frames as expected, so now I need to pass this list into <code>purrr::walk2()</code> so I can iterate <code>vroom::vroom_write()</code> over the processed data paths in <code>proc_file_pth</code>.</p>
<ol type="1">
<li>First I create the processed data folder (<code>dds-nyt/processed/</code>)</li>
</ol>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_create</span>(<span class="st">"dds-nyt/processed/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<ol start="2" type="1">
<li>Second, I create the <code>.x</code> argument, which is the split list of <code>nyt_data_proc</code> by <code>proc_file_pth</code></li>
</ol>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split nyt_data_proc (.x)</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>by_proc_pths <span class="ot">&lt;-</span> nyt_data_proc <span class="sc">|&gt;</span> </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(nyt_data_proc<span class="sc">$</span>proc_file_pth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<ol start="3" type="1">
<li>Third, I get the unique processed data paths in the <code>proc_file_pth</code> column and store it as a vector for the <code>.y</code></li>
</ol>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get unique processed paths in nyt_data_proc (.y) with .csv extension</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>proc_pths <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">unique</span>(nyt_data_proc<span class="sc">$</span>proc_file_pth), <span class="st">".csv"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>proc_pths</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "dds-nyt/processed/2023-12-16-nyt10.csv"</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] "dds-nyt/processed/2023-12-16-nyt11.csv"</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] "dds-nyt/processed/2023-12-16-nyt12.csv"</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [4] "dds-nyt/processed/2023-12-16-nyt13.csv"</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [5] "dds-nyt/processed/2023-12-16-nyt7.csv" </span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [6] "dds-nyt/processed/2023-12-16-nyt8.csv" </span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [7] "dds-nyt/processed/2023-12-16-nyt9.csv"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Now I can perform <code>purrr::walk2()</code> on <code>by_proc_pths</code> using <code>proc_pths</code> and <code>vroom::vroom_write()</code>:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate with .f</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(<span class="at">.x =</span> by_proc_pths, <span class="at">.y =</span> proc_pths, </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">.f =</span> vroom<span class="sc">::</span>vroom_write, <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># or as an anonymous function </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Or I could write this as an an anonymous function:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>nyt_data_proc <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(nyt_data_proc<span class="sc">$</span>proc_file_pth) <span class="sc">|&gt;</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(<span class="at">.y =</span> proc_pths, </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    \(x, y)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    vroom<span class="sc">::</span><span class="fu">vroom_write</span>(<span class="at">x =</span> x, </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> y,  <span class="at">delim =</span> <span class="st">","</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I’ll want to perform a sanity check on this output with the first exported item in <code>dds-nyt/processed</code> and check it against the <code>nyt1_proc</code> data to evaluate the differences.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>nyt1_proc_check_01 <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="at">file =</span> proc_pths[<span class="dv">1</span>], <span class="co"># grab the first file</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I’ll check the differences with <code>diffobj::diffStr()</code>. Click on Code below to view the differences:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>waldo<span class="sc">::</span><span class="fu">compare</span>(</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">names</span>(nyt1_proc),</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">names</span>(nyt1_proc_check_01), </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_diffs =</span> <span class="dv">20</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="do">##     old           | new                 </span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] "age"         - "id"            [1] </span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] "gender"      - "age"           [2] </span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] "impressions" - "gender"        [3] </span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [4] "clicks"      - "impressions"   [4] </span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [5] "signed_in"   - "clicks"        [5] </span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [6] "age_group"   - "signed_in"     [6] </span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [7] "ctr_rate"    - "age_group"     [7] </span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [8] "female"      - "ctr_rate"      [8] </span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="do">##                   - "female"        [9] </span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="do">##                   - "file_nm"       [10]</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a><span class="do">##                   - "proc_file_pth" [11]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>These are differences I’d expect, given the two data frames will have <em>slightly</em> different columns (<code>id</code>, <code>file_nm</code>, and <code>proc_file_pth</code>)</p>
<section id="group_walk" class="level3">
<h3 class="anchored" data-anchor-id="group_walk"><code>group_walk()</code></h3>
<p>Another option involves the <code>group_walk()</code> function from <code>dplyr</code> (<strong>WARNING:</strong> this is experimental). But I need to remove the processed folder so I’m not confusing myself:</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(<span class="at">.x =</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"dds-nyt/processed"</span>, </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">full.names =</span> <span class="cn">TRUE</span>, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pattern =</span> <span class="st">".csv$"</span>),</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> fs<span class="sc">::</span>file_delete)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_tree</span>(<span class="st">"dds-nyt"</span>, <span class="at">recurse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="do">## dds-nyt</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── processed</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="do">## └── raw</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt10.csv</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt11.csv</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt12.csv</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt13.csv</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt7.csv</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="do">##     ├── nyt8.csv</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="do">##     └── nyt9.csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>The <a href="https://dplyr.tidyverse.org/reference/group_map.html">help file on <code>group_walk()</code></a> gives an example with <code>purrr</code>’s formula syntax (which I’ve adapted below):</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>nyt_data_proc <span class="sc">|&gt;</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(proc_file_pth) <span class="sc">|&gt;</span>   </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_walk</span>( <span class="sc">~</span>vroom<span class="sc">::</span><span class="fu">vroom_write</span>(<span class="at">x =</span> .x, </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">file =</span> <span class="fu">paste0</span>(.y<span class="sc">$</span>proc_file_pth, <span class="st">".csv"</span>),</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">delim =</span> <span class="st">","</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>I’ve also re-written this as an anonymous function (which is more stable, since the formula syntax is no longer recommended).</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now re-create</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_create</span>(<span class="st">"dds-nyt/processed/"</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>nyt_data_proc <span class="sc">|&gt;</span> </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(proc_file_pth) <span class="sc">|&gt;</span>   </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_walk</span>(\(x, y) </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    vroom<span class="sc">::</span><span class="fu">vroom_write</span>(</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x, </span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="fu">paste0</span>(y<span class="sc">$</span>proc_file_pth, <span class="st">".csv"</span>),</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">", "</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_tree</span>(<span class="st">"dds-nyt/processed/"</span>, <span class="at">pattern =</span> <span class="st">"csv$"</span>)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="do">## dds-nyt/processed/</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── 2023-12-16-nyt10.csv</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── 2023-12-16-nyt11.csv</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── 2023-12-16-nyt12.csv</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── 2023-12-16-nyt13.csv</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── 2023-12-16-nyt7.csv</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a><span class="do">## ├── 2023-12-16-nyt8.csv</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="do">## └── 2023-12-16-nyt9.csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Once again, I’ll import the first file in the new processed data folder and check it against the columns <code>nyt1_proc_check_01</code> data to evaluate the differences.</p>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now re-check</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>nyt1_proc_check_02 <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(<span class="at">file =</span> proc_pths[<span class="dv">1</span>], <span class="co"># grab the first file</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div style="font-size: 0.90em;">
<div class="cell">
<details open="" class="code-fold">
<summary>show/hide</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>waldo<span class="sc">::</span><span class="fu">compare</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">names</span>(nyt1_proc_check_01),</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">names</span>(nyt1_proc_check_02), </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_diffs =</span> <span class="dv">20</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="do">## `old[8:11]`: "ctr_rate" "female" "file_nm" "proc_file_pth"</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="do">## `new[8:10]`: "ctr_rate" "female" "file_nm"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
</section>
</section>
<section id="recap-purrr-and-iteration" class="level1">
<h1>Recap: <code>purrr</code> and iteration</h1>
<p>In this post I’ve covered iteration and some of the new additions to the <code>purrr</code> version 1.0. These include:</p>
<ol type="1">
<li><p><code>purrr::map_vec()</code> (replaces <code>map_raw()</code>)</p></li>
<li><p>Progress bars</p></li>
<li><p><code>purrr::list_rbind()</code> (replaces <code>map_dfr()</code>)</p></li>
<li><p>The experimental <code>dplyr::group_walk()</code> function</p></li>
</ol>
<p>For more information, check out the following:</p>
<ul>
<li><p><a href="https://purrr.tidyverse.org/"><code>purrr</code> package website</a></p></li>
<li><p><a href="https://r4ds.hadley.nz/iteration.html">Iteration chapter in R for data science</a></p></li>
<li><p><a href="https://www.tidyverse.org/blog/2022/12/purrr-1-0-0/"><code>purrr</code> version 1.0 blog post</a> and <a href="https://www.youtube.com/watch?v=EGAs7zuRutY">video from Posit</a></p></li>
</ul>
<div style="font-size: 1.10em;">
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
REACP: <code>purrr</code> syntax variations
</div>
</div>
<div class="callout-body-container callout-body">
<div style="font-size: 1.25em;">
<p><strong>Standard</strong></p>
</div>
<div style="font-size: 1.10em;">
<div class="sourceCode" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define .x and .f</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> my_list, <span class="at">.f =</span> tolower)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="font-size: 1.25em;">
<p><strong>Anonymous function</strong></p>
</div>
<div style="font-size: 1.10em;">
<div class="sourceCode" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># anonymous shorthand notation</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>my_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map</span>(\(x) <span class="fu">tolower</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="font-size: 1.25em;">
<p><strong>Formula (deprecated)</strong></p>
</div>
<div style="font-size: 1.10em;">
<div class="sourceCode" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># written as normal expression</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>my_list <span class="sc">|&gt;</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">tolower</span>(.x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mjfrigaard\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>